var Fi=Object.defineProperty;var gt=n=>{throw TypeError(n)};var Li=(n,i,e)=>i in n?Fi(n,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[i]=e;var s=(n,i,e)=>Li(n,typeof i!="symbol"?i+"":i,e),ht=(n,i,e)=>i.has(n)||gt("Cannot "+e);var m=(n,i,e)=>(ht(n,i,"read from private field"),e?e.call(n):i.get(n)),B=(n,i,e)=>i.has(n)?gt("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(n):i.set(n,e),z=(n,i,e,t)=>(ht(n,i,"write to private field"),t?t.call(n,e):i.set(n,e),e);function Gt(){return"v187"}function ve(n,i){return n==null&&i==null?!0:n==null||i==null?!1:n.toLowerCase()===i.toLowerCase()}function Di(n){n.cmd??(n.cmd=[]);const i=[...n.cmd];n.cmd.push=(...e)=>{for(const t of e)t(n);return 0};for(const e of i)e(n)}const Oi=n=>{const i=("; "+document.cookie).split("; "+n+"=");return i.length>=2?i.pop().split(";").shift():null},qt=n=>n!=null&&n.length?` domain=${n};`:"",Bi=(n,i,e)=>{const t=new Date;t.setTime(t.getTime()+e.expires*1e3),document.cookie=`${n}=${i};${qt(e.domain)} path=${e.path}; expires=${t.toUTCString()}`},xi=(n,i)=>{document.cookie=`${n}=;${qt(i.domain)} path=${i.path}; expires=Thu, 01 Jan 1970 00:00:00 GMT`},q={set:Bi,get:Oi,delete:xi},$t=()=>{const n=window.location.hostname,i=n.split(".");return i.length<2?n:`.${i[i.length-2]}.${i[i.length-1]}`};function Mi(){const n=window.location.hostname.toLowerCase(),i=/(^|.)(showcase|externaltest|preview|verify|stable|sandbox-[^.]+)\./.exec(n);if(i&&i.length>2)return i[2];const[e]=n.split(".");return e||null}const Ui="app";function pe(){var n,i;return((i=(n=window.fandomContext)==null?void 0:n.odyssey)==null?void 0:i.platform)??Ui}function De(n){return new URLSearchParams(window.location.search).get(n)}function j(n){const i=De(n);return Ge(n)&&i===""||i==="1"||i==="true"}function Ge(n){return new URLSearchParams(window.location.search).has(n)}const Vi="",Wi=/^(?:(v\d+)-)?(\d{2})$/;function jt(){let n=De("pf_pathfinder_force_bucket")??q.get("exp_bucket");const i=n==null?void 0:n.match(Wi);return i&&i.length>=3&&(n=i[2]),n??Vi}const Ne="adengadinfo",zi="adengadsizeinfo";var G=(n=>(n.SLOT_REQUESTED_INFO="requested_info",n.SLOT_CODE_SERVED_INFO="code_served_info",n.SLOT_RENDERED_INFO="success_info",n.SLOT_COLLAPSE_INFO="collapse",n.SLOT_FORCE_CLOSE_INFO="force-close",n.SLOT_CLICKED="clicked",n.SLOT_HEAVY_AD_INTERVENTION="heavy-ad-intervention",n))(G||{}),Kt=(n=>(n.SLOT_SIZE_ESTABLISHED="size_established",n))(Kt||{}),W=(n=>(n.BIDDER_RESPONSE="bid_response",n))(W||{}),nt=(n=>(n.IDENTITY_INFO="identity_info",n))(nt||{}),Yt=(n=>(n.LABRADOR_KEYVALUES="labrador_keyvalues",n))(Yt||{}),N=(n=>(n.AE_FIRST_LINE_EXEC="ae.firstLineExec",n.AE_AFTER_INIT_PLUGINS="ae.afterInitPlugins",n.AE_AFTER_GPT_WRAPPER_INIT="ae.afterGptWrapperInit",n.AE_AD_ENGINE_INIT="ae.adEngineInit",n.AE_ON_BIDDERS_INIT="ae.onBiddersInit",n.AE_CONFIG_CALLBACK_STARTED="ae.beforeAuction.configCallbackStarted",n.AE_CONFIG_CALLBACK_COMPLETE="ae.beforeAuction.configCallbackComplete",n.AE_AUCTION_START="ae.auctionStart",n.AE_AUCTION_START_A9_START="ae.auctionStart.a9.bidStart",n.AE_AUCTION_END="ae.auctionEnd",n.AE_BEFORE_FIRST_CALL_ADS_REQUEST="ae.beforeFirstCallAdsRequest",n.AE_FIRST_RENDER_CYCLE_COMPLETE="ae.firstRenderCycleComplete",n.AE_GPT_SLOT_REQUESTED_INITIAL="ae.gpt.slotRequested.initial",n.AE_GPT_SLOT_RESPONSE_RECEIVED_INITIAL="ae.gpt.slotResponseReceived.initial",n.AE_GPT_SLOT_RENDERED_ENDED_INITIAL="ae.gpt.slotRenderEnded.initial",n.AE_GPT_SLOT_SLOT_ONLOAD_INITIAL="ae.gpt.slotOnload.initial",n))(N||{}),Qt=(n=>(n.AE_AUCTION_DURATION_A9_BID_TOTAL_TIME="ae.d.auctionDuration.a9.bidTotalTime",n.AE_AUCTION_DURATION="ae.d.auctionDuration",n.AE_DURATION_TO_BID="ae.d.firstLineExec_to_auctionStart",n.AE_CONFIG_CALLBACK_DURATION="ae.d.configCallbackDuration",n))(Qt||{});const y="adengloadtimes";var _=(n=>(n.SLOT_REQUESTED="requested",n.SLOT_RENDERED="rendered",n.AE_INIT="init",n.VENDOR_TIME_UPDATE="vendor_time_update",n.CREATIVE_RENDERED="creative_rendered",n.PERFORMANCE_MARK="performance_mark",n))(_||{}),Xt=(n=>(n.TRACKING_EVENT="trackingevent",n))(Xt||{}),c=(n=>(n.P1="p1",n.P2="p2",n.P3="p3",n.P4="p4",n))(c||{}),T=(n=>(n.ERROR_NO_TIER_PROVIDED="-2",n.ERROR_DISABLED_TIERS="-1",n.TIER_2="2",n.TIER_3="3",n.TIER_4="4",n))(T||{}),qe=(n=>(n.FANDOM_DESKTOP="fandomdesktop",n.FANDOM_MOBILE="fandommobile",n.METACRITIC="metacritic",n.TVGUIDE="tvguide",n))(qe||{});function Jt(n=window.fandomContext??null){var e;const i=(e=n==null?void 0:n.page)==null?void 0:e.monetizationTier;return typeof i=="number"?i.toString():T.ERROR_NO_TIER_PROVIDED}function Hi(){var n;return((n=window.fandomAds)==null?void 0:n.resetCount)??0}const _e=()=>{var n;return window.fandomHost??(window.fandomHost={cmd:[]}),(n=window.fandomHost).cmd??(n.cmd=[]),window.fandomHost};function g(n){_e().cmd.push(i=>{i.issueManager.handleIssue({...n,type:"error"})})}const Gi="E001",qi="E002",Be="E003",$i="E004",ji="E005",Ki="E006",Yi="E007",Qi="E008",Xi="E009",Ji="E010",Zi="E011",Vd="E012",en="E013",tn="E014",nn="E015",rn="E016",on="E018",sn="E019",an="E020",dn="E021",ln="E022",cn="E023",un="E024",gn="E025",hn="E026",pn="E027",mn="E028",fn="E029",bn="E030",Sn="E031",pt="E032",En="E033",_n="E034",An="E040",Tn="E041",yn="E042",In="E045",vn="E046",Nn="D001",kn="D002",Cn="D003",Rn="D004",Pn="D005",wn="D006",Fn="D007",Ln="D008",Dn="D009",On="D010",Bn="D011",xn="D012",Mn="D013",Un="D014",Vn="D015",Wn="D016",zn="D017",Hn="D018",Gn="D019",qn="D020",$n="D025",jn="D026",Kn="D027",Yn="D028";function Qn(n,i){var e;if(typeof i=="string"){const t=document.getElementsByTagName("script")[0];(e=t==null?void 0:t.parentNode)==null||e.insertBefore(n,t)}else(i??document.body).appendChild(n)}const Xn={isAsyncOrDeferOtherwise:!0,node:null,parameters:{},datasets:{}};function Jn(n){const{src:i,isAsyncOrDeferOtherwise:e,node:t,parameters:r,datasets:o}={...Xn,...n},a=document.createElement("script");return a.async=!!e,a.defer=!e,a.src=i,r&&Object.keys(r).forEach(d=>{a.setAttribute(d,r[d])}),o&&Object.keys(o).forEach(d=>{a.dataset[d]=o[d]}),Qn(a,t),a}async function K(n){try{return await new Promise((e,t)=>{const r=Jn(typeof n=="string"?{src:n,node:null}:n);r.onload=o=>e(o),r.onerror=o=>t(o)})}catch(i){throw _e().cmd.push(e=>e.adBlockManager.adBlockSuspected({suspected:!0,reason:"scriptBlocked"})),g({message:"Failed to load script",error:i,priority:c.P3,data:[{srcOrOptions:n}],code:An}),i}}function Zn(){var n,i,e;return window.fandomTrack??(window.fandomTrack={q:[],cmd:[],registry:{}}),(n=window.fandomTrack).q??(n.q=[]),(i=window.fandomTrack).cmd??(i.cmd=[]),(e=window.fandomTrack).registry??(e.registry={}),window.fandomTrack}function p(n,i){Zn().q.push({event:n,payload:i})}async function Ae(n,i){try{p(y,{type:_.VENDOR_TIME_UPDATE,eventName:`${n}_started`,time:performance.now()});const e=await K(i);return p(y,{type:_.VENDOR_TIME_UPDATE,eventName:`${n}_loaded`,time:performance.now()}),e}catch(e){throw p(y,{type:_.VENDOR_TIME_UPDATE,eventName:`${n}_error_loading`,time:performance.now()}),e}}function rt(n,i,e=!1){const t=!n||typeof n!="object",r=!i||typeof i!="object";if(t&&r)return{};if(t)return i;if(r)return n;const o={...n};for(const a in i){const d=n[a],l=i[a];d===void 0?o[a]=l:Array.isArray(d)?o[a]=[...d,...Array.isArray(l)?l:[l]]:typeof d=="object"&&typeof l=="object"?o[a]=rt(d,l,e):e&&(o[a]=l)}return o}function b(n){_e().cmd.push(i=>{i.issueManager.handleIssue({...n,type:"degradation"})})}class er{constructor(){s(this,"storage",{})}get length(){return Object.keys(this.storage).length}key(i){return Object.keys(this.storage)[i]}clear(){this.storage={}}getItem(i){var e;return((e=this.storage)==null?void 0:e[i])??null}removeItem(i){delete this.storage[i]}setItem(i,e){this.storage[i]=e}}function Zt(n){return n instanceof Object&&"expires"in n&&"data"in n&&typeof n.expires=="number"}function tr(n){return Zt(n)&&n.expires?Date.now()>=n.expires:!1}class ei{constructor(i=()=>window.localStorage){s(this,"fallbackStorage",new er);s(this,"provider");try{this.provider=i(),this.isAvailable()||(this.provider=this.fallbackStorage)}catch{this.provider=this.fallbackStorage}}isAvailable(){const i=`__o${Date.now()}__`;try{this.provider.setItem(i,i);const e=this.provider.getItem(i)==i;return this.provider.removeItem(i),e}catch{return!1}}getItem(i,e=!1){try{let t=this.provider.getItem(i);return t===null||e?t:(t=this.parseValue(t),Zt(t)?this.handleTTLItem(i,t):t)}catch{return this.fallbackStorage.getItem(i)}}parseValue(i){try{return JSON.parse(i)}catch{return i}}handleTTLItem(i,e){return tr(e)?(this.removeItem(i),null):e.data}setItemWithTTL(i,e,t){const o={expires:Date.now()+t,data:e};return this.setItem(i,o)}setItem(i,e,t){if(t)return this.setItemWithTTL(i,e,t);const r=e instanceof Object?JSON.stringify(e):e;try{this.provider.setItem(i,r)}catch{this.fallbackStorage.setItem(i,r)}return!0}removeItem(i){try{this.provider.removeItem(i)}catch{this.fallbackStorage.removeItem(i)}}clear(){try{this.provider.clear()}catch{this.fallbackStorage.clear()}}}function de(n,i={maxTries:100,fixedTimeout:0}){return(async()=>{let t=0,r="exponentialTimeout"in i?i.exponentialTimeout:i.fixedTimeout,o=n();for(;!o&&t<i.maxTries;)await new Promise(a=>setTimeout(a,r)),o=n(),"exponentialTimeout"in i&&(r*=2),t++;return o})()}function ir(n,i){return new Promise((e,t)=>{setTimeout(()=>{let r=`Operation timed out after ${n}ms`;i&&(r=`${i} ${r}`),t(new Error(r))},n)})}function Q(n,i,e){const t=ir(i,e);return Promise.race([n,t])}function nr(n=[],i){const e=n.flat().filter(t=>t.status==="rejected");if(e.length>0){for(const r of e)g({message:"Promise rejected",error:r.reason,priority:c.P3,code:Tn});let t=`${e.length} of ${n.length} promises were rejected.`;i!=null&&i.logMessagePrefix&&(t=`${i.logMessagePrefix} ${t}`),g({message:t,priority:(i==null?void 0:i.priority)??c.P3,data:e,code:yn})}}async function mt(n,i,e){const t=await Q(Promise.allSettled(n),i,e==null?void 0:e.logMessagePrefix);return nr(t,e),t}const rr=-1;function or(){var n;return((n=window.RLCONF)==null?void 0:n.wgCityId)??rr}const ft="fandomContextUpdate",sr=(n=window)=>{const i=()=>{var e;return((e=n.fandomContext)==null?void 0:e.tracking)!==void 0&&n.fandomContext.tracking.pvNumber&&n.fandomContext.tracking.pvNumberGlobal&&n.fandomContext.tracking.pvUID};return new Promise(e=>{if(i())return e();const t=()=>{i()&&(n.removeEventListener(ft,t),e())};n.addEventListener(ft,t)})};function ar(){typeof Promise.withResolvers!="function"&&(Promise.withResolvers=()=>{let n,i;return{promise:new Promise((t,r)=>{n=t,i=r}),resolve:n,reject:i}})}const ti=[];function dr(n,i,e=[]){ti.push({time:performance.now(),name:n,params:i,failures:e})}function lr(){return ti}function Z(n,i,...e){const t=[];for(const r of n){const o=r.hooks[i];if(typeof o=="function")try{o.call(r,...e)}catch(a){t.push(r.name),g({code:Sn,message:`Error running hook ${i} in plugin ${r.name}`,priority:c.P2,error:a})}}dr(i,e,t)}var O;class cr{constructor(i){B(this,O);z(this,O,i)}get activePluginList(){return m(this,O).getPlugins().map(i=>i.name).sort()}get hooksLog(){return lr()}get adNodes(){return m(this,O).adNodeManager.getAdNodes()}get adEngineState(){return m(this,O).getDebugState()}get runtimeConfig(){return m(this,O).getRuntimeConfig()}get pluginState(){const i={};return m(this,O).getPlugins().forEach(e=>{i[e.name]={...e.getDebugState(),pluginConfig:e.getDebugPluginConfig()}}),i}}O=new WeakMap;function ur(n){if(j("odyssey_debug"))return new cr(n)}var ne;class gr{constructor(i,e,t=[]){B(this,ne);s(this,"version");s(this,"deploymentEnvironment");s(this,"debug");s(this,"reset");s(this,"disableAdRendering");s(this,"resetCount",0);var r;this.cmd=t,z(this,ne,i),this.deploymentEnvironment=((r=window.fandomAds)==null?void 0:r.deploymentEnvironment)??"unknown",this.version=Gt(),this.debug=ur(e),this.reset=()=>{this.resetCount+=1,e.reset()},this.disableAdRendering=()=>e.adRenderManager.disableAdRendering(),window.fandomAds=this,Di(this)}getPlugin(i){if(!m(this,ne)[i])throw new Error(`Plugin ${i} does not exist`);return m(this,ne)[i].api}}ne=new WeakMap;const hr=(function(){const i=typeof document<"u"&&document.createElement("link").relList;return i&&i.supports&&i.supports("modulepreload")?"modulepreload":"preload"})(),pr=function(n){return"/"+n},bt={},P=function(i,e,t){let r=Promise.resolve();if(e&&e.length>0){let a=function(u){return Promise.all(u.map(f=>Promise.resolve(f).then(A=>({status:"fulfilled",value:A}),A=>({status:"rejected",reason:A}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),l=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));r=a(e.map(u=>{if(u=pr(u),u in bt)return;bt[u]=!0;const f=u.endsWith(".css"),A=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${A}`))return;const k=document.createElement("link");if(k.rel=f?"stylesheet":hr,f||(k.as="script"),k.crossOrigin="",k.href=u,l&&k.setAttribute("nonce",l),document.head.appendChild(k),f)return new Promise((Pi,wi)=>{k.addEventListener("load",Pi),k.addEventListener("error",()=>wi(new Error(`Unable to preload CSS for ${u}`)))})}))}function o(a){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=a,window.dispatchEvent(d),!d.defaultPrevented)throw a}return r.then(a=>{for(const d of a||[])d.status==="rejected"&&o(d.reason);return i().catch(o)})};function mr(){var n,i,e;return((e=(i=(n=window.ads)==null?void 0:n.context)==null?void 0:i.opts)==null?void 0:e.isAdTestWiki)===!0}async function fr(){const n=[];if(Ge("cid")){const{PassCIDPlugin:r}=await P(async()=>{const{PassCIDPlugin:o}=await import("./PassCIDPlugin-C9iykau-.js");return{PassCIDPlugin:o}},[]);n.push(new r({}))}if(j("gpt_debug")){const{GPTDebugPlugin:r}=await P(async()=>{const{GPTDebugPlugin:o}=await import("./GPTDebugPlugin-B2UbE4C9.js");return{GPTDebugPlugin:o}},[]);n.push(new r({}))}if(Ge("wikia_bidder")){const{PrebidWikiaDebugPlugin:r}=await P(async()=>{const{PrebidWikiaDebugPlugin:o}=await import("./PrebidWikiaDebugPlugin-CK_vZeFj.js");return{PrebidWikiaDebugPlugin:o}},[]);n.push(new r({}))}if(j("bidder_debug")){const{BidderDebugPlugin:r}=await P(async()=>{const{BidderDebugPlugin:o}=await import("./BidderDebugPlugin-3Dd0q8i8.js");return{BidderDebugPlugin:o}},[]);n.push(new r({}))}if(mr()){const{TestWikiPlugin:r}=await P(async()=>{const{TestWikiPlugin:o}=await import("./TestWikiPlugin-CYN-SKde.js");return{TestWikiPlugin:o}},[]);n.push(new r({}))}return n}function $e(){var n;return(n=window.icbm)!=null&&n.config?Promise.resolve(window.icbm):new Promise(i=>{const e=()=>{i(window.icbm),window.removeEventListener("instantConfigLoaded",e)};window.addEventListener("instantConfigLoaded",e)})}const ue=class ue{constructor(i,e){s(this,"currentTier");this.adEngine=i,this.config=e,this.readCurrentTier()}reset(){this.readCurrentTier()}readCurrentTier(){if(!this.config.icTieredMonetizationEnabled){b({code:Wn,message:"MonetizationTierEngine: Tiered monetization is not enabled. Defaulting to TIER_4.",priority:c.P4}),this.currentTier=T.TIER_4;return}this.currentTier=Jt(),this.currentTier!==T.TIER_2&&this.currentTier!==T.TIER_3&&this.currentTier!==T.TIER_4&&(g({code:fn,message:`MonetizationTierEngine: Invalid monetization tier value: ${this.currentTier}. Falling back to default tier: ${ue.DEFAULT_MONETIZATION_TIER}.`,priority:c.P4}),this.currentTier=ue.DEFAULT_MONETIZATION_TIER),this.isDemonetized()&&this.adEngine.adRenderManager.disableAdRendering()}filterTieredParamsByCurrentTier(i){if(!i||typeof i!="object"||i===null||Array.isArray(i))return{};const e=T.TIER_3 in i?i[T.TIER_3]:void 0,t=T.TIER_4 in i?i[T.TIER_4]:void 0;if(e===void 0&&t===void 0)return;const r=this.getCurrentTier();if(r===T.TIER_3)return e;if(r===T.TIER_4)return t}isEnabled(){return this.config.icTieredMonetizationEnabled}getCurrentTier(){return this.currentTier}isTier3Or4(){return this.isTier3()||this.isTier4()}isTier2(){return this.getCurrentTier()===T.TIER_2}isTier3(){return this.getCurrentTier()===T.TIER_3}isTier4(){return this.getCurrentTier()===T.TIER_4}isDemonetized(){return!this.isTier3Or4()}};s(ue,"DEFAULT_MONETIZATION_TIER",T.TIER_2);let je=ue;const ke=200,br=1,Sr="https://pubads.g.doubleclick.net/gampad/ads?";function ot(n,i=ke){if(!n)return!1;const{top:e,bottom:t}=n.getBoundingClientRect();return t>-i&&e<window.innerHeight+i}function Er(n){return ot(n,0)}var le=(n=>(n.EXACT="EXACT",n.LESS_THAN="LESS_THAN",n.LESS_THAN_OR_EQUAL="LESS_THAN_OR_EQUAL",n.GREATER_THAN="GREATER_THAN",n.GREATER_THAN_OR_EQUAL="GREATER_THAN_OR_EQUAL",n))(le||{});function _r(n){return Array.isArray(n)&&Array.isArray(n[0])&&Array.isArray(n[0][0])}const Ar={strategy:"once",match:"height",with:"GREATER_THAN"};function ii(n){switch(n){case"EXACT":return(i,e)=>i===e;case"LESS_THAN":return(i,e)=>i<e;case"LESS_THAN_OR_EQUAL":return(i,e)=>i<=e;case"GREATER_THAN":return(i,e)=>i>e;case"GREATER_THAN_OR_EQUAL":return(i,e)=>i>=e;default:throw new Error(`Invalid comparator: ${n}`)}}function ni(n){return Array.isArray(n)&&n.length===2&&typeof n[0]=="number"&&typeof n[1]=="number"}function Tr(n){if(!ni(n))return!1;if(n[0]===0&&n[1]===0)throw new Error("Invalid size to compare [0,0]");return!0}function Ke(n,i,e="EXACT"){if(!ni(n)||!Tr(i))return!1;const t=typeof e=="function"?e:ii(e),[r,o]=n,[a,d]=i;return a===0?t(o,d):d===0?t(r,a):t(r,a)&&t(o,d)}function yr(n,i,e="EXACT"){if(!Array.isArray(n))return n;const t=ii(e);return n.filter(r=>!Ke(r,i,t))}function xe(n,i,e="EXACT"){return n.map(t=>{const[r,o]=t;return[r,yr(o,i,e)]})}function Ir(n,i){for(const e of n)e.length===2&&e[1].push(i);return n}function Ce(n){return n?Array.isArray(n)?n.join("x"):n:""}function Oe(n){return n.flatMap(i=>{const e=i[1];return Array.isArray(e)&&(e.length===1||typeof e[0]!="number")?e.map(Ce):[Ce(e)]})}const vr=/_\d+$/;function ie(n){return n.replace(vr,"")}const St={masterSlotMarker:"<!-- Odyssey Creative Template",collapseAllMarker:'data-premium-takeover="true"',customSizeWidthRange:{min:2,max:20}};var re;class S extends HTMLElement{constructor(e){super();B(this,re);s(this,"adNode");z(this,re,e)}connectedCallback(){this.adNode||this.createAdNode()}disconnectedCallback(){m(this,re).adNodeManager.removeAdNode(this.adNode),this.adNode=void 0}getBaseSlotName(){var e;return((e=this.adNode)==null?void 0:e.getBaseSlotName())??ie(this.id)}getAdUnitPath(){var e;return((e=this.adNode)==null?void 0:e.getAdUnitPath())??null}getTargeting(){var e;return((e=this.adNode)==null?void 0:e.getAllTargeting())??{}}collapse(){var e;(e=this.adNode)==null||e.collapse()}uncollapse(){var e;(e=this.adNode)==null||e.uncollapse()}getParentWrapper(){var e;return((e=this.adNode)==null?void 0:e.getParentWrapper())??null}getAdLabelElement(){var e;return((e=this.adNode)==null?void 0:e.getAdLabelElement())??null}getStickyContainerWrapper(){var e;return((e=this.adNode)==null?void 0:e.getStickyContainerWrapper())??null}createAdNode(){if(this.adNode=m(this,re).adNodeManager.createAdNode(this.id),!this.adNode)throw new Error(`AdNode for element with id[${this.id}] could not be created.`)}}re=new WeakMap,s(S,"ELEMENT_NAME","fandom-ad"),s(S,"WRAPPER_CLASS","fandom-ad-wrapper"),s(S,"LABEL_CLASS","fandom-ad-label"),s(S,"STICKY_CONTAINER_CLASS","fandom-ad-sticky-container");function Nr(n){customElements.get(S.ELEMENT_NAME)||customElements.define(S.ELEMENT_NAME,class extends S{constructor(){super(n)}})}function kr(n){return n?n.style.height==="0px"||n.style.display==="none":!1}function Et(n){n&&(n.style.height="0px",n.style.display="none")}function _t(n){n&&(n.style.height="",n.style.display="")}var ri=(n=>(n.NOT_RENDERED="not-rendered",n.RENDERING="rendering",n.RENDERED="rendered",n))(ri||{}),C;class Cr{constructor(i,e,t){B(this,C);s(this,"renderStatus","not-rendered");s(this,"renderCount",0);s(this,"currentSlotConfig");s(this,"adServerSlot");s(this,"baseSlotName");s(this,"emptyRetryCount",0);s(this,"blocked",!1);s(this,"collapsed",!1);s(this,"takeoverState",null);s(this,"bidderSizes");this.slotName=i,this.slotConfig=e,z(this,C,t),this.currentSlotConfig=structuredClone(e),this.baseSlotName=ie(i),this.bidderSizes=this.filterSizesForBidders(),this.hookAdNodeToGptEvents()}hookAdNodeToGptEvents(){this.enableLimitingSizesIfConfigured(),this.listenToSlotRenderEnded()}enableLimitingSizesIfConfigured(){const i=this.getRefreshConfigRemoveSizes();if(!(i!=null&&i.strategy))return;const e=m(this,C).gptWrapper.addSlotEventListener(this.slotName,"impressionViewable",()=>{this.removeSizesFromSlotElement(),i.strategy==="once"&&e()})}listenToSlotRenderEnded(){m(this,C).gptWrapper.addSlotEventListener(this.slotName,"slotRenderEnded",i=>{i!=null&&i.isEmpty?this.emptyRetryCount+=1:this.emptyRetryCount=0,this.renderCount===1&&this.slotConfig.companion===!0&&this.inspectCreativeForTakeover(i.size),this.handleExactSizesToRemoveAfterRender(),this.renderStatus="rendered"})}inspectCreativeForTakeover(i){var a,d;const{masterSlotMarker:e,collapseAllMarker:t,customSizeWidthRange:r}=St,o=Array.isArray(i)?i[0]:0;if(r.min<=o){const l=((d=(a=this.getIFrameElement())==null?void 0:a.contentDocument)==null?void 0:d.body.innerHTML)??"";l.includes(e)&&(this.takeoverState={isMaster:!0,shouldCollapseAll:l.includes(t)})}}setAdServerSlot(i){this.adServerSlot=i}destroy(){this.adServerSlot=void 0,m(this,C).gptWrapper.destroySlots([this])}reset(){var i;this.currentSlotConfig=structuredClone(this.slotConfig),this.bidderSizes=this.filterSizesForBidders(),this.emptyRetryCount=0,this.renderStatus="not-rendered",this.renderCount=0,this.blocked=!1,this.takeoverState=null,this.isCollapsed()&&this.uncollapse(),((i=this.getRefreshConfigRemoveSizes())==null?void 0:i.strategy)==="once"&&this.enableLimitingSizesIfConfigured()}getSlotName(){return this.slotName}setOutOfPageSlotName(i){this.slotName=i}getBaseSlotName(){return this.baseSlotName}getSlotType(){return this.currentSlotConfig.type??"display"}getSlotConfig(){return this.currentSlotConfig}setSlotConfig(i){this.currentSlotConfig=i}getBidderConfig(i){var e;return(e=this.currentSlotConfig.bidders)==null?void 0:e[i]}setBidderConfig(i,e){var t;(t=this.currentSlotConfig).bidders??(t.bidders={}),this.currentSlotConfig.bidders[i]=e}getTakeoverState(){return this.takeoverState}getElement(){return document.getElementById(this.slotName)??document.getElementById(this.baseSlotName)}getIFrameElement(){var e;const i=(e=this.getElement())==null?void 0:e.getElementsByTagName("iframe");return(i==null?void 0:i[0])??null}getAdUnitPath(){var i;return this.adServerSlot?m(this,C).gptWrapper.getAdUnitPath(this.slotName):((i=this.getElement())==null?void 0:i.dataset.adUnitPath)??null}clearTargeting(i){m(this,C).gptWrapper.clearSlotTargeting(this.slotName,i)}setTargeting(i,e){m(this,C).gptWrapper.setSlotTargeting(this.slotName,i,e)}getTargeting(i){try{return m(this,C).gptWrapper.getSlotTargeting(this.slotName,i)}catch{return[]}}getAllTargeting(){try{return m(this,C).gptWrapper.getAllSlotTargeting(this.slotName)}catch{return{}}}getRenderStatus(){return this.renderStatus}isEligibleToRender(){return!(this.isBlocked()||!this.adServerSlot||this.getRenderStatus()==="rendering"||this.hasEverBeenRequested()&&!this.isRefreshable())}isInViewport(){const i=this.getElement();return i?Er(i):!1}isNearViewport(){const i=this.getElement();return ot(i,ke)}incrementRenderCount(){this.renderCount+=1,this.setTargeting("rv",this.renderCount.toString())}getRenderCount(){return this.renderCount}isRefreshable(){var i;return!!((i=this.currentSlotConfig.refresh)!=null&&i.enabled)&&this.emptyRetryCount<br}isBlocked(){return this.blocked}block(){this.blocked=!0}unblock(){this.blocked=!1}isCollapsed(){return this.collapsed||kr(this.getElement())}getParentWrapper(){var e;const i=(e=this.getElement())==null?void 0:e.parentElement;return i!=null&&i.classList.contains(S.WRAPPER_CLASS)||i!=null&&i.classList.contains("top-ads-container")?i:null}getAdLabelElement(){var r;const i=document.getElementById(`label-${this.slotName}`);if(i)return i;const e=this.getParentWrapper()??((r=this.getElement())==null?void 0:r.parentElement),t=e==null?void 0:e.querySelector(`:scope > .${S.LABEL_CLASS}`);return t||((e==null?void 0:e.querySelector(":scope > .ae-translatable-label"))??null)}getStickyContainerWrapper(){var e;const i=(e=this.getParentWrapper())==null?void 0:e.parentElement;return i&&(i.classList.contains(S.STICKY_CONTAINER_CLASS)||i.classList.contains("top_leaderboard-odyssey-wrapper"))?i:null}collapse(){if(this.isCollapsed())return;this.collapsed=!0,this.blocked=!0;const i=this.getElement();i&&(Et(i),Et(this.getParentWrapper()))}uncollapse(){if(!this.isCollapsed())return;this.collapsed=!1,this.blocked=!1;const i=this.getElement();i&&(_t(i),_t(this.getParentWrapper()))}hasEverBeenRequested(){return this.renderStatus!=="not-rendered"}startRender(){this.renderStatus="rendering",this.takeoverState=null,this.incrementRenderCount()}getSizes(){return this.currentSlotConfig.sizes}setSizes(i){this.currentSlotConfig.sizes=i,this.bidderSizes=this.filterSizesForBidders();try{m(this,C).gptWrapper.updateSizeMapping(this.slotName,this.getSizes())}catch{}}getDefaultSizes(){const e=this.getSizes().flatMap(r=>r[1]);return Array.from(new Set(e.map(r=>JSON.stringify(r)))).map(r=>JSON.parse(r))}removeSizes(i,e=le.EXACT){const t=this.getSizes();if(!Array.isArray(t))return;const r=xe(t,i,e);this.setSizes(r)}getBidderSizes(){return this.bidderSizes}filterSizesForBidders(){const i=St.customSizeWidthRange.max;let e=structuredClone(this.getSizes());e=xe(e,[i,i],le.LESS_THAN_OR_EQUAL);const{doNotEmitSizesForBidders:t}=this.getSlotConfig();return t!=null&&t.length&&t.forEach(r=>{e=xe(e,r,le.EXACT)}),e}getRefreshConfigRemoveSizes(){const{removeSizes:i}=this.currentSlotConfig.refresh??{};if(!(!this.isRefreshable()||!i))return i===!0?Ar:i}removeSizesFromSlotElement(){var o;const i=this.getRefreshConfigRemoveSizes();if(!i)return;const e=(o=this.getElement())==null?void 0:o.querySelector("iframe");if(!e)return;const t=e.getBoundingClientRect(),r=[i.match==="height"?0:t.width,i.match==="width"?0:t.height];this.removeSizes(r,i.with)}handleExactSizesToRemoveAfterRender(){var e;const i=(e=this.currentSlotConfig.refresh)==null?void 0:e.exactSizesToRemove;i&&i.forEach(t=>{this.removeSizes(t)})}}C=new WeakMap;var At="Invariant failed";function E(n,i){if(!n){var e=typeof i=="function"?i():i,t=e?"".concat(At,": ").concat(e):At;throw new Error(t)}}function F(){return window.fandomContext??null}const Rr=1e10;function Pr(){return Math.floor(Math.random()*Rr)+1}function wr(){return["output=xml_vast4","env=vp","gdfp_req=1","impl=s","unviewed_position_start=1",`url=${encodeURIComponent(window.location.href)}`,`description_url=${encodeURIComponent(window.location.href)}`,`correlator=${Pr()}`]}function Fr(){var i,e;const n=(e=(i=F())==null?void 0:i.tracking)==null?void 0:e.ppid;return n?[`ppid=${n}`]:[]}function Lr(n){const i=Oe(n.getSizes());return i.length>0?i.join("|"):"640x480"}function Dr(n){const i={};for(const[e,t]of Object.entries(n))if(Or(e,t))Object.assign(i,t);else{const r=t;(typeof r=="string"||Array.isArray(r))&&(i[e]=r)}return i}function Or(n,i){return(n==="slotTargeting"||n==="pageTargeting")&&typeof i=="object"&&i!==null&&!Array.isArray(i)}var M,Ee;class L extends S{constructor(e){super(e);s(this,"unblocked",Promise.withResolvers());s(this,"consentData");B(this,M);B(this,Ee,Promise.withResolvers());z(this,M,e)}connectedCallback(){var e,t;super.connectedCallback(),$e().then(r=>{r.config.icUAPJWPlayer||this.unblockVideo()}).catch(()=>{g({code:pt,message:`Error retrieving instant config for video ad node: ${this.id}`,priority:c.P2})}),(t=(e=window.fandomAds)==null?void 0:e.cmd)==null||t.push(()=>{m(this,Ee).resolve()})}async getVastUrl(){try{return(await this.requestRender()).vastUrl}catch{g({code:En,message:`Error retrieving VAST URL for video slot name: ${this.id}`,priority:c.P2})}}getMonetizationTier(){return m(this,M).monetizationTierEngine.getCurrentTier()}async requestRender(){return await m(this,Ee).promise,this.consentData=await m(this,M).privacyManager.waitForConsents(),await this.requestBids(),{vastUrl:this.buildVastUrl(),vastParams:this.buildVastParams()}}async getFeaturedMinimumBidFloor(){if(this.id!=="featured")return null;const t=(await $e()).config.icFeaturedVideoBidFloor;return t==null?null:!Number.isFinite(t)||t<0?(g({code:pt,message:`icFeaturedVideoBidFloor value is not allowed: ${t}`,priority:c.P2}),null):Number(t.toFixed(2))}unblockVideo(){this.unblocked.resolve()}buildVastParams(){const e=this.getTargeting()??{},{...t}=m(this,M).gptWrapper.getAllTargeting({raw:!1})??{};return{vpos:"preroll",slotTargeting:e,pageTargeting:t}}buildVastUrl(){return this.adNode?`${Sr}${this.getParams().join("&")}`:""}async requestBids(){this.adNode&&(this.adNode.incrementRenderCount(),await m(this,M).adRenderManager.requestBids([this.adNode]),await this.waitForResolvedState())}waitForResolvedState(){return this.unblocked.promise}getParams(){return[...wr(),...Fr(),...this.getPrivacyParams(),...this.getSlotParams(this.adNode),...this.getCustomParams()].filter(Boolean)}getPrivacyParams(){const{coppa:e,consentApi:t,consentString:r=""}=this.consentData??{},o=[];return t==="usp"?o.push(`us_privacy=${r}`,"gdpr=0"):t==="tcf"&&o.push(`gdpr_consent=${r}`,"gdpr=1"),e&&o.push("tfcd=1"),o}getSlotParams(e){const t=this.getAdUnitPath(),r=Lr(e);return[`iu=${t}`,`sz=${r}`]}getCustomParams(){const e=this.buildVastParams(),t=Dr(e),r=Object.entries(t).map(([o,a])=>`${o}=${Array.isArray(a)?a.join(","):a}`).join("&");return[`cust_params=${encodeURIComponent(r)}`]}}M=new WeakMap,Ee=new WeakMap,s(L,"ELEMENT_NAME","fandom-video-ad"),s(L,"WRAPPER_CLASS","fandom-video-ad-wrapper");function Br(n){customElements.get(L.ELEMENT_NAME)||customElements.define(L.ELEMENT_NAME,class extends L{constructor(){super(n)}})}class xr{constructor(i,e,t){s(this,"adNodes",[]);s(this,"observer");this.adEngine=i,this.slotConfigMap=e,this.hooks=t}reset(){for(const i of this.getAdNodes())this.removeAdNode(i),i.reset(),this.registerAdNode(i)}registerAdNodes(){this.addAllStaticSlots(),this.registerAdNodeComponents()}getSlotConfigMap(){return this.slotConfigMap}getSlotConfig(i){return this.slotConfigMap.baseSlots[i]??this.slotConfigMap.baseSlots[ie(i)]??this.slotConfigMap.videoSlots[i]}createAdNode(i,e){var o,a,d,l;const t=e??this.getSlotConfig(i);if(!t){g({code:bn,message:`Cannot create adNode, no slot config found for slotName=[${i}]`,priority:c.P2});return}if((a=(o=this.hooks).onBeforeAdNodeCreated)==null||a.call(o,i,t),t.enabled===!1)return;const r=new Cr(i,t,this.adEngine);return this.registerAdNode(r),(l=(d=this.hooks).onAdNodeCreated)==null||l.call(d,r),r}registerAdNode(i){this.adNodes.push(i),this.adEngine.gptWrapper.defineSlot(i),this.observer&&this.startObservingElement(i)}removeAdNode(i){const e=i.getElement();e&&this.stopObservingElement(e),this.adNodes=this.adNodes.filter(t=>t.getSlotName()!==i.getSlotName()),i.destroy(),this.hooks.onAdNodeRemoved(i)}getAdNodes(){return this.adNodes}getFirstCallAdNodes(i=!0){return this.adNodes.filter(e=>{const{companion:t=!1,isFirstCall:r}=e.getSlotConfig();return r===!0&&t===i})}getAdNodeByName(i){let e=this.adNodes.find(t=>t.getSlotName()===i);return e??(e=this.adNodes.find(t=>t.getBaseSlotName()===i)),e}getAdNodesByBaseName(i){return this.adNodes.filter(e=>e.getBaseSlotName()===i)}getAdNodeByNameOrFail(i){const e=this.getAdNodeByName(i);return E(e,`adNode is not defined: ${i}`),e}blockSlot(i){this.getAdNodeByNameOrFail(i).block()}unblockSlot(i){this.getAdNodeByNameOrFail(i).unblock()}startRendering(){this.adEngine.adRenderManager.requestRender(this.getFirstCallAdNodes(),!0),this.adEngine.adRenderManager.requestRender(this.getFirstCallAdNodes(!1),!0),this.startIntersectionObserver()}startIntersectionObserver(){this.startObservingSlots(i=>{const e=i.map(t=>{if(t.intersectionRatio>0){const r=this.getAdNodeByName(t.target.id);if(r&&!r.hasEverBeenRequested())return r}}).filter(t=>t!==void 0);this.adEngine.adRenderManager.requestRender([...new Set([...e])])})}startObservingSlots(i){this.observer=new IntersectionObserver(i,{root:null,rootMargin:`${ke}px 0px ${ke}px 0px`,threshold:1}),this.getAdNodes().forEach(e=>{this.startObservingElement(e)})}startObservingElement(i){var t;const e=i.getElement();e&&i.getSlotType()==="display"&&((t=this.observer)==null||t.observe(e))}stopObservingElement(i){var e;(e=this.observer)==null||e.unobserve(i)}registerAdNodeComponents(){Nr(this.adEngine),Br(this.adEngine)}addAllStaticSlots(){const i=this.getSlotConfigMap().baseSlots,e=S.ELEMENT_NAME.toUpperCase();Object.values(i).forEach(t=>{if(t&&!t.dynamic){const r=document.getElementById(t.name);r&&r.tagName!==e&&this.createAdNode(t.name,t)}})}}const Mr="-1",Ur="0",oi="1",si="2",me="0",V="1",Vr="registeredUser",st="notRegistered",Wr="activeEditor";function zr(n){var i;return(i=n==null?void 0:n.site)!=null&&i.top1000?"_top1k_wiki":"_not_a_top1k_wiki"}class Hr{constructor(i){s(this,"SERVER_PREFIX","wka1b");this.gptWrapper=i}buildAdUnitPathForNode(i){const e=F(),t=this.gptWrapper.getGamId(),{group:r}=i.getSlotConfig(),o=i.getSlotName(),a=zr(e),[d="fandom"]=this.gptWrapper.getTargeting("product"),[l="article"]=this.gptWrapper.getTargeting("s2"),[u="all"]=this.gptWrapper.getTargeting("s0"),[f="ucp_desktop"]=this.gptWrapper.getTargeting("skin"),[A="desktop"]=this.gptWrapper.getTargeting("device");return`/${t}/${this.SERVER_PREFIX}.${r}/${o}/${A}/${f}-${d}-${l}/${a}-${u}`}setupPerformanceMarks(i){i.addToCommandQueue(()=>{this.registerEventPerformanceMarkCallback(i,"slotRequested","top_leaderboard"),this.registerEventPerformanceMarkCallback(i,"slotResponseReceived","top_leaderboard"),this.registerEventPerformanceMarkCallback(i,"slotRenderEnded","top_leaderboard"),this.registerEventPerformanceMarkCallback(i,"slotOnload","top_leaderboard")})}registerEventPerformanceMarkCallback(i,e,t){i.addEventListener(e,({slot:r})=>{const o=r.getTargeting("rv");if(o.length>0&&o[0]==="1"&&r.getSlotElementId()===t){const d=this.getInitialSlotPerformanceMarkName(e);d&&performance.mark(d.toString(),{detail:{slotId:t}})}})}getInitialSlotPerformanceMarkName(i){switch(i){case"slotRequested":return N.AE_GPT_SLOT_REQUESTED_INITIAL;case"slotResponseReceived":return N.AE_GPT_SLOT_RESPONSE_RECEIVED_INITIAL;case"slotRenderEnded":return N.AE_GPT_SLOT_RENDERED_ENDED_INITIAL;case"slotOnload":return N.AE_GPT_SLOT_SLOT_ONLOAD_INITIAL}}}function Gr({consentApi:n,optOut:i,coppa:e}){const t=n==="tcf"&&i?V:me,r=n==="usp"&&i?V:me,o=qr(e);return{npa:t,rdp:r,monetization:o}}function qr(n){var i,e;if((e=(i=window.fandomContext)==null?void 0:i.site)!=null&&e.directedAtChildren)return n?"restricted":"regular"}const Tt="fs";class $r{constructor(i,e,t){s(this,"GAM_ID","5441");s(this,"gptPlatformPlugin");this.adEngine=i,this.initialPageTargeting=e,this.hooks=t,this.gptPlatformPlugin=new Hr(this),window.googletag=window.googletag??{cmd:[]},this.gptPlatformPlugin.setupPerformanceMarks(this)}async enableServices(){return new Promise(i=>{this.addToCommandQueue(()=>{googletag.pubads().disableInitialLoad(),googletag.pubads().enableSingleRequest(),googletag.pubads().enableVideoAds();for(const[e,t]of Object.entries(this.initialPageTargeting))this.setTargeting(e,t);googletag.enableServices(),i()})})}reset(){this.clearAllTargeting()}getGamId(){return this.GAM_ID}setConfig(i){this.addToCommandQueue(()=>{googletag.setConfig(i)})}setTargeting(i,e){if(typeof i=="string"){if(typeof e=="string"||Array.isArray(e)){googletag.pubads().setTargeting(i,e);return}b({code:Gn,message:`Targeting value for key "${i}" must be a string or an array of strings, passed ${e}`,priority:c.P3})}else i?googletag.setConfig({targeting:{...i}}):b({code:qn,message:`GPT setTargeting was called with invalid parameters: ${i}, ${e}`,priority:c.P3})}getTargeting(i){return googletag.pubads().getTargeting(i)}getAdUnitPath(i){const e=this.getGPTSlotsBySlotNames([i]);return e.length>=1?e[0].getAdUnitPath():null}getAllTargeting(i={}){const{raw:e=!1}=i,t={},r=googletag.pubads().getTargetingKeys();for(const o of r){const a=this.getTargeting(o);e||a.length>1?t[o]=a:a.length===1&&(t[o]=a[0])}return t}clearTargeting(i){googletag.setConfig({targeting:{[i]:null}})}clearAllTargeting(){googletag.setConfig({targeting:null})}updatePublisherProvidedId(i){i&&this.addToCommandQueue(()=>{this.setTargeting("ppid",i),googletag.pubads().setPublisherProvidedId(i)})}updatePrivacySettings(i){const{npa:e,rdp:t,monetization:r}=Gr(i);this.addToCommandQueue(()=>{r&&this.setTargeting("monetization",r),this.setTargeting("npa",e),this.setTargeting("rdp",t),googletag.pubads().setPrivacySettings({nonPersonalizedAds:e===V,restrictDataProcessing:t===V,childDirectedTreatment:i.coppa===!0})})}defineOutOfPageSlot(i,e,t){const{format:r="INTERSTITIAL"}=t??{},o=googletag.defineOutOfPageSlot(e,googletag.enums.OutOfPageFormat[r]??i.getSlotConfig().name);return o!==null&&i.setOutOfPageSlotName(o==null?void 0:o.getSlotElementId()),o}defineSlot(i){this.addToCommandQueue(()=>{var d;const e=i.getSlotConfig(),t=i.getAdUnitPath()??this.gptPlatformPlugin.buildAdUnitPathForNode(i);let r=null;const o=(d=e.dynamic)==null?void 0:d.outOfPage;if(o?r=this.defineOutOfPageSlot(i,t,o):r=googletag.defineSlot(t,i.getDefaultSizes(),i.getSlotName()),r===null){g({code:_n,message:`GptWrapper: Slot ${i.getSlotName()} could not be defined.`,priority:c.P2,data:i});return}i.setAdServerSlot(r),Object.entries(e.targeting).forEach(([l,u])=>{r.setTargeting(l,u)});const a=i.getSizes();a&&!o&&r.defineSizeMapping(a),r.addService(googletag.pubads()),e.companion&&r.addService(googletag.companionAds())})}getGPTSlotsByAdNodes(i){return this.getGPTSlotsBySlotNames(i.map(e=>e.getSlotName()))}getSlotById(i){return googletag.pubads().getSlots().find(e=>e.getSlotElementId()===i)??null}getGPTSlotsBySlotNames(i){const e=new Set(i),t=googletag.pubads().getSlots().filter(a=>e.has(a.getSlotElementId())),r=t.map(a=>a.getSlotElementId()),o=[...e].filter(a=>!r.includes(a));return o.length>0&&(console.error("Slots missing from googletag:",o),_e().cmd.push(a=>a.adBlockManager.adBlockSuspected({suspected:!0,reason:"nodeMissing"}))),t}addKeyValForTruncationCheck(){this.clearTargeting(Tt),this.setTargeting(Tt,"t")}requestSlots(i){this.hooks.onBeforeAdsRequest(i),this.addKeyValForTruncationCheck(),googletag.pubads().refresh(this.getGPTSlotsByAdNodes(i))}destroySlots(i){i&&googletag.destroySlots(this.getGPTSlotsByAdNodes(i))}clearSlotTargeting(i,e){const[t]=this.getGPTSlotsBySlotNames([i]);E(t,`Slot ${i} not found`),t.clearTargeting(e)}setSlotTargeting(i,e,t){const[r]=this.getGPTSlotsBySlotNames([i]);E(r,`Slot ${i} not found`),r.setTargeting(e,t)}getSlotTargeting(i,e){const[t]=this.getGPTSlotsBySlotNames([i]);return E(t,`Slot ${i} not found`),t.getTargeting(e)}getAllSlotTargeting(i,e={}){const{raw:t=!0}=e,[r]=this.getGPTSlotsBySlotNames([i]);E(r,`Slot ${i} not found`);const o=r.getTargetingKeys();return Object.fromEntries(o.map(a=>{let d=r.getTargeting(a);return!t&&Array.isArray(d)&&d.length===1&&(d=d[0]),[a,d]}))}updateSizeMapping(i,e){const[t]=this.getGPTSlotsBySlotNames([i]);return E(t,`Slot ${i} not found`),t.defineSizeMapping(e)}addToCommandQueue(i){googletag.cmd.push(i)}addEventListener(i,e){googletag.pubads().addEventListener(i,e)}removeEventListener(i,e){googletag.pubads().removeEventListener(i,e)}addSlotEventListener(i,e,t){const r=o=>{o.slot.getSlotElementId()===i&&t(o)};return this.addEventListener(e,r),()=>this.removeEventListener(e,r)}}class jr{constructor(i,e){s(this,"consentData");s(this,"pendingWaitForConsentResolver");s(this,"pendingWaitForBlockingResolver");this.adEngine=i,this.hooks=e,this.consentData=window.fandomCmp,this.startConsentUpdateListener()}startConsentUpdateListener(){const i=()=>{this.fandomCmpReady(window.fandomCmp)&&this.fandomConsentUpdateHandler()};window.addEventListener("fandomConsentUpdate",i),i()}async fandomConsentUpdateHandler(){var i,e;this.consentData=window.fandomCmp,this.updateGptPrivacySettings(),(i=this.pendingWaitForConsentResolver)==null||i.call(this,this.consentData),this.pendingWaitForConsentResolver=void 0,this.consentData.allowed.ads&&((e=this.pendingWaitForBlockingResolver)==null||e.call(this,this.consentData),this.pendingWaitForBlockingResolver=void 0),this.notifyPluginsOfConsentChange()}updateGptPrivacySettings(){this.consentData&&this.adEngine.gptWrapper.updatePrivacySettings(this.consentData)}notifyPluginsOfConsentChange(){E(this.consentData,"Expected window.fandomCmp to have consent data before calling onConsentUpdated"),this.hooks.onConsentUpdated(this.consentData)}fandomCmpReady(i){return(i==null?void 0:i.ready)===!0}async waitForConsents(){return new Promise(i=>{this.consentData!==void 0&&this.fandomCmpReady(this.consentData)&&i(this.consentData),this.pendingWaitForConsentResolver=i})}async waitForAdsAllowed(){return new Promise(i=>{var e,t;((e=this.consentData)==null?void 0:e.ready)===!0&&((t=this.consentData)==null?void 0:t.allowed.ads)===!0&&i(this.consentData),this.pendingWaitForBlockingResolver=i})}}const X=50,yt=2500;class Kr{constructor(i,e,t,r){s(this,"enableBidding",!0);s(this,"enableAdRendering",!0);s(this,"renderCycleCount",0);s(this,"isFirstRenderCycleComplete",!1);this.adEngine=i,this.config=e,this.instantConfig=t,this.hooks=r}async waitForFirstRenderCycleComplete(){const i=await de(()=>this.isFirstRenderCycleComplete,{maxTries:yt/X+1,fixedTimeout:X});return i||b({code:Yn,message:"Timed out waiting for first render cycle to complete. Second ad calls will be unblocked.",priority:c.P2}),i}async finishFirstRenderCycle(i=[]){!await de(()=>i.every(r=>r.getRenderStatus()===ri.RENDERED),{maxTries:yt/X,fixedTimeout:X})&&i.length>0&&b({code:Kn,message:"Timed out waiting for first ad request to complete to finish first render cycle.",priority:c.P2});let t=Ur;for(const r of i){const o=r.getTakeoverState();if(o!=null&&o.isMaster){t=o.shouldCollapseAll?oi:si;break}}this.adEngine.gptWrapper.setTargeting("odyssey_takeover",t),this.hooks.onFirstRenderCycleComplete(this.adEngine,i,t),this.isFirstRenderCycleComplete=!0,performance.mark(N.AE_FIRST_RENDER_CYCLE_COMPLETE)}async waitForSlotsOnFirstRenderCycle(){const{slots:i,timeout:e=5e3}=this.config.waitForSlotsOnFirstRenderCycle??{};i&&i.length>0&&(await de(()=>i.every(r=>!!this.adEngine.adNodeManager.getAdNodeByName(r)),{maxTries:e/X,fixedTimeout:X})||b({code:jn,message:`Timed out waiting for slots [${i.join(", ")}] to be present before first render cycle.`,priority:c.P2}))}disableBidding(){this.enableBidding=!1}isBiddingEnabled(){return this.enableBidding}disableAdRendering(){this.disableBidding(),this.enableAdRendering=!1}isAdRenderingEnabled(){return this.enableAdRendering}getDebugState(){return{enableBidding:this.enableBidding,enableAdRendering:this.enableAdRendering,renderCycleCount:this.renderCycleCount,isFirstRenderCycleComplete:this.isFirstRenderCycleComplete}}async start(){if(this.enableBidding){const i=[];this.hooks.onBiddersInit(this.adEngine,i);try{await mt(i,this.instantConfig.icAdEngineBidderInitTimeoutMS,{logMessagePrefix:"onBiddersInit",priority:c.P3})}catch(e){b({code:zn,message:"onBiddersInit timed out",priority:c.P3,error:e})}performance.mark(N.AE_ON_BIDDERS_INIT)}if(this.enableAdRendering){await this.waitForSlotsOnFirstRenderCycle(),this.adEngine.adNodeManager.startRendering();return}}async reset(){this.isFirstRenderCycleComplete=!1,this.renderCycleCount=0,this.enableAdRendering=!0,this.enableBidding=!0}async requestBids(i,e){if(!this.enableBidding)return;const t={auctionId:crypto.randomUUID(),adNodes:i,pageTargeting:this.adEngine.gptWrapper.getAllTargeting(),renderCycleCount:e},r=(...o)=>{this.hooks.onCreateBidderAdUnit(...o)};try{const o=[];this.hooks.onCreateBiddersRequests(o,t,this.adEngine,r),performance.mark(N.AE_AUCTION_START,{detail:{renderCycleCount:e,auctionId:t.auctionId}}),await mt([...o],this.instantConfig.icAdEngineOnCreateBiddersRequestsTimeoutMS,{logMessagePrefix:`onCreateBiddersRequests [cycle ${e}]`,priority:c.P3}),performance.mark(N.AE_AUCTION_END,{detail:{renderCycleCount:e,auctionId:t.auctionId}})}catch(o){b({code:Hn,message:"Bidders requests timed out",priority:c.P3,error:o})}}async requestRender(i=[],e=!1){if(!this.enableAdRendering)return;const t=[];for(const r of i)(e||r.isEligibleToRender())&&(r.startRender(),t.push(r));t.length&&await this.render(t)}async render(i=[]){this.renderCycleCount++;const e=this.renderCycleCount;await this.requestBids(i,e),e===1&&(this.instantConfig.icAdEngineWaitBeforeFirstAdsRequestMS>0&&await new Promise(t=>setTimeout(t,this.instantConfig.icAdEngineWaitBeforeFirstAdsRequestMS)),this.hooks.onBeforeFirstCallAdsRequest(this.adEngine.gptWrapper,this.adEngine.adNodeManager),performance.mark(N.AE_BEFORE_FIRST_CALL_ADS_REQUEST)),e>1&&!this.isFirstRenderCycleComplete&&await this.waitForFirstRenderCycleComplete(),this.enableAdRendering&&this.adEngine.gptWrapper.requestSlots(i),e===1&&await this.finishFirstRenderCycle(i)}}class Yr{constructor(i,e,t){s(this,"monetizationTierEngine");s(this,"gptWrapper");s(this,"privacyManager");s(this,"adNodeManager");s(this,"adRenderManager");var r;this.runtimeConfig=i,this.plugins=e,this.initialPageTargeting=t,this.adRenderManager=new Kr(this,((r=this.runtimeConfig.managers)==null?void 0:r.AdRenderManager)??{},this.runtimeConfig.instantConfig,{onBiddersInit:this.generateHookCallback("onBiddersInit"),onCreateBiddersRequests:this.generateHookCallback("onCreateBiddersRequests"),onCreateBidderAdUnit:this.generateHookCallback("onCreateBidderAdUnit"),onBeforeFirstCallAdsRequest:this.generateHookCallback("onBeforeFirstCallAdsRequest"),onFirstRenderCycleComplete:this.generateHookCallback("onFirstRenderCycleComplete")}),this.monetizationTierEngine=new je(this,this.runtimeConfig.instantConfig),this.gptWrapper=new $r(this,t,{onBeforeAdsRequest:this.generateHookCallback("onBeforeAdsRequest")}),this.privacyManager=new jr(this,{onConsentUpdated:this.generateHookCallback("onConsentUpdated")}),this.adNodeManager=new xr(this,i.slots,{onAdNodeCreated:this.generateHookCallback("onAdNodeCreated"),onBeforeAdNodeCreated:this.generateHookCallback("onBeforeAdNodeCreated"),onAdNodeRemoved:this.generateHookCallback("onAdNodeRemoved")})}generateHookCallback(i){return(...e)=>this.runHook(i,...e)}runHook(i,...e){Z(this.plugins,i,...e)}async start(){await this.adRenderManager.start()}reset(){this.adRenderManager.reset(),this.monetizationTierEngine.reset(),this.gptWrapper.reset(),this.adNodeManager.reset(),this.runHook("onAdEngineReset",this),this.start()}getDebugState(){return{...this.adRenderManager.getDebugState()}}getRuntimeConfig(){return this.runtimeConfig}getPlugins(){return this.plugins}}async function Qr(){return new Promise(n=>{window.fandomHost=window.fandomHost??{},window.fandomHost.cmd=window.fandomHost.cmd??[],window.fandomHost.cmd.push(n)})}async function Xr(n,i){const e={};Z(i,"onInitPageTargeting",e),Z(i,"onInitSlotConfigMap",n.slots);const t=new Yr(n,i,e);return await Promise.all([t.privacyManager.waitForConsents(),Qr()]),await t.gptWrapper.enableServices(),Z(i,"onAfterGptWrapperInit",t.gptWrapper),performance.mark(N.AE_AFTER_GPT_WRAPPER_INIT),t.adNodeManager.registerAdNodes(),Z(i,"onAfterAdNodeManagerInit",t.adNodeManager,n.slots.baseSlots),await t.privacyManager.waitForAdsAllowed(),Z(i,"onAdEngineInit",t),performance.mark(N.AE_AD_ENGINE_INIT),t}function Jr(n){return!!(n!=null&&n.baseSlots)}function Zr(n){return Jr(n)?{app:n.app,version:n.version,slots:n}:n}async function eo(n){const i=window.fandomAdsSlotsConfig;if(i){const e=Zr(i);return window.fandomAdsSlotsConfig=e,e}else{const{loadConfig:e}=await P(async()=>{const{loadConfig:r}=await import("./handleDynamicConfig-CqP5CIq2.js");return{loadConfig:r}},[]),t=await e(n);return window.fandomAdsSlotsConfig=t,t}}async function to(n,i,e){return{...await eo(e),instantConfig:n,activeLabradorKeyValues:i}}var oe;class h{constructor(i){B(this,oe);s(this,"api");s(this,"hooks",{});this.pluginConfig=i}static isEnabled(i,e){return!!e&&(i==null?void 0:i.enabled)!==!1}getDebugState(){return{}}getDebugPluginConfig(){return this.pluginConfig}setPlugins(i){z(this,oe,i)}usePlugin(i){var e,t;return(t=(e=m(this,oe))==null?void 0:e.get(i))==null?void 0:t.api}useExperiment(i){var e,t;return(t=(e=m(this,oe))==null?void 0:e.get(i))==null?void 0:t.api}}oe=new WeakMap;function ai(){var n;return((n=window.ads)==null?void 0:n.context)??null}class io{constructor(i,e){s(this,"AMZN_TOKEN_NAME","AMZN-Token");s(this,"APSTAG_RECORD_KEY","apstagRecord");s(this,"APSTAG_HEM_SENT_KEY","apstagHEMsent");s(this,"APSTAG_HEM_OPTOUT_KEY","apstagHEMoptOut");s(this,"AMAZON_TOKEN_TTL",336*60*60*1e3);s(this,"storage",new ei);this.config=i,this.consentData=e}updateConsentData(i,e){this.consentData=i,this.updateApstagPublisherAudienceConfig(e)}updateApstagPublisherAudienceConfig({gdprParam:i}){var o,a;if(this.cleanUpA9TokensIfApplicable(),!this.isHemSyncingEnabled())return;const e=this.resolveHashedEmailSource(),{optOut:t}=this.consentData;if(!e){b({code:Cn,message:"Can't update HEM without an email record.",priority:c.P4}),t&&window.apstag&&((a=(o=window.apstag).dpa)==null||a.call(o));return}const r={...i,optOut:t,hashedRecords:[{type:"email",record:e}]};this.syncHemIfApplicable(r)}getApstagRecordFromStorage(){return this.storage.getItem(this.APSTAG_RECORD_KEY)}getHashedEmailFromAdsContext(){var e;const i=(e=ai())==null?void 0:e.opts.userEmailHashes;return!Array.isArray(i)||(i==null?void 0:i.length)!==3?null:i[2]}resolveHashedEmailSource(){return this.getApstagRecordFromStorage()??this.getHashedEmailFromAdsContext()??null}syncHemIfApplicable(i){var o,a,d,l;const e=(a=(o=i==null?void 0:i.hashedRecords)==null?void 0:o[0])==null?void 0:a.record,{optOut:t}=i;if(!e)return;const r=this.deriveApstagTokenizationFunction(t);r&&window.apstag&&((l=(d=window.apstag)[r])==null||l.call(d,i,()=>{this.updateApstagConsentInLocalStorage(e,t)}))}deriveApstagTokenizationFunction(i){return this.checkIfUserConsentChanged(i)?"upa":this.checkIfA9TokenShouldBeRenewed()?"rpa":null}checkIfA9TokenShouldBeRenewed(){const i=this.storage.getItem(this.APSTAG_HEM_SENT_KEY,!0);if(!i)return!0;const e=parseInt(i,10);return isNaN(e)?!0:e<Date.now()}checkIfUserConsentChanged(i){const e=this.storage.getItem(this.APSTAG_HEM_OPTOUT_KEY,!1);return e!==null&&i!==e}isHemSyncingEnabled(){return this.config.icA9HEM&&!this.config.icA9CleanHEM}updateApstagConsentInLocalStorage(i,e){this.storage.setItem(this.APSTAG_RECORD_KEY,i),this.storage.setItem(this.APSTAG_HEM_OPTOUT_KEY,e.toString()),q.get(this.AMZN_TOKEN_NAME)?this.storage.setItem(this.APSTAG_HEM_SENT_KEY,(Date.now()+this.AMAZON_TOKEN_TTL).toString()):this.storage.removeItem(this.APSTAG_HEM_SENT_KEY)}cleanUpA9TokensIfApplicable(){this.config.icA9CleanHEM&&this.cleanUpA9Tokens()}cleanUpA9Tokens(){var i,e;(q.get(this.AMZN_TOKEN_NAME)||this.storage.getItem(this.APSTAG_RECORD_KEY))&&((e=(i=window.apstag)==null?void 0:i.dpa)==null||e.call(i),this.storage.removeItem(this.APSTAG_RECORD_KEY),this.storage.removeItem(this.APSTAG_HEM_SENT_KEY),this.storage.removeItem(this.APSTAG_HEM_OPTOUT_KEY),q.delete(this.AMZN_TOKEN_NAME,{path:"/"}))}}function no(n,i,e){var r,o;return(o=(r=n.filter(([a])=>a[0]<=i&&a[1]<=e).sort(([a],[d])=>d[0]-a[0]||d[1]-a[1]))==null?void 0:r[0])==null?void 0:o[1]}const di=10,ro={currency:"USD",value:di};class oo{constructor(i,e,t,r,o){s(this,"apstagConfigParams");s(this,"a9HemSyncer");this.consentData=i,this.timeout=e,this.config=t,this.apstagConfigParams={pubID:r,adServer:"googletag",videoAdServer:"DFP",simplerGPT:!0,deals:!0,bidTimeout:this.timeout,signals:o?{ortb2:o}:{}},this.a9HemSyncer=new io(this.config,this.consentData),this.init(!0)}configureCommand(i,e){window.apstag._Q.push([i,e])}updateApstagOrtb2Signals(i){i&&(this.apstagConfigParams.signals.ortb2=i,this.updateApstagConfig())}updateApstagConfig(){if(window.apstag){const{gdprParam:i,uspParam:e}=this.getConsentsParams();window.apstag.init({...this.apstagConfigParams,...i,...e})}}init(i){window.apstag=window.apstag??{_Q:[],init:(...t)=>{this.configureCommand("i",t)},fetchBids:(...t)=>{this.configureCommand("f",t)}};const e=this.getConsentsParams();this.updateApstagConfig(),i&&this.a9HemSyncer.updateApstagPublisherAudienceConfig(e)}getConsentsParams(){return{gdprParam:this.consentData.consentApi==="tcf"?{gdpr:{cmpTimeout:this.timeout}}:{gdpr:{enabled:!1}},uspParam:this.getUspParam()}}handleConsentChange(i){this.consentData=i;const e=this.getConsentsParams();this.updateApstagConfig(),this.a9HemSyncer.updateConsentData(i,e)}getUspParam(){return this.consentData.consentApi==="usp"&&this.consentData.consentString?{params:{us_privacy:this.consentData.consentString}}:{}}async requestBids(i,e){if(!this.consentData.allowed.ads||this.consentData.coppa)return[];E(window.apstag,"window.apstag has not been initialized yet");const t={slots:this.buildBidsConfig(i.adNodes),timeout:this.timeout};if(!t.slots.length)return[];e("a9",i,t);const r=new Promise(o=>{var a;(a=window.apstag)==null||a.fetchBids(t,d=>{var l,u;(u=(l=window.apstag)==null?void 0:l.setDisplayBids)==null||u.call(l),o(d)})});try{return await Q(r,this.timeout)}catch{return this.buildTimedOutResponse(t.slots)}}buildTimedOutResponse(i){return i.map(e=>({slotID:e.slotID,timedOut:!0}))}transformA9Config(i,e){if(!i.sizeConfig)return i;const t={...i,sizes:no(e,window.innerWidth,window.innerHeight)};return delete t.sizeConfig,t}buildBidsConfig(i){const e=[];return i.forEach(t=>{const r=t.getBidderConfig("a9");if(!r)return;const o=t.getSlotName(),a=t.getBidderSizes(),d=this.transformA9Config(r,a),l={slotName:t.getAdUnitPath()??o,slotID:o,floor:ro,...d};e.push(l)}),e}}function so(n){const i=parseFloat(n);return isNaN(i)?"-1":`us_tier${ao(i)}`}function ao(n){return n>=.7?1:n>=.5?2:3}const li=6,lo="1217",co="bsr004",uo="1014",go=40,ho=50,It={main_vertical:{from:"main_vertical",limit:"one-of-each"},main_entity_type:{from:"main_entity_type",limit:"one-of-each"},genre:{from:"genres",addConfidence:"site"},subgenre:{from:"subgenres",addConfidence:"site"},vertical:{from:"verticals",addConfidence:"all"},themes:{from:"themes",addConfidence:"site"},fran:{from:"franchises"},trending:{from:"trending_score",transformValue:so}};function ci(n){const i=(window==null?void 0:window.fandomTaxonomy)??{};return(i==null?void 0:i[n])??[]}function x(n){const i=[lo,co],e=ci(n),t=(e==null?void 0:e.iab_categories)??[];return t.length>0?i.push(...t):i.push(uo),Array.from(new Set(i.filter(Boolean)))}function po(n){return typeof n!="number"||isNaN(n)?"":`_c${0+Math.floor(n*10)}`}function mo(n){return typeof n!="object"||n===null?n:Object.keys(n).reduce((i,e)=>(n[e]&&n[e].length>0&&(i[e]=n[e]),i),{})}function fo(n){return typeof n=="object"&&n&&typeof n.value=="string"&&n.value.length>0&&typeof n.confidence=="number"}const bo={site:"s_",page:"p_"};function vt(n,i,e){const t=ci(n);let r=(t==null?void 0:t[i])??[];return Array.isArray(r)||(r=[r]),r.filter(fo).map(a=>{const d=typeof e=="function"?e(a.value):a.value;return{...a,value:`${bo[n]}${d}`}})}function So(n){const{from:i,addConfidence:e=!1,limit:t,transformValue:r}=n,o=Nt(vt("site",i,r),e==="site"||e==="all"),a=Nt(vt("page",i,r),e==="page"||e==="all"),d=t==="one-of-each"?1:void 0;return Eo([...o.slice(0,d),...a.slice(0,d)]).filter(Boolean).map(Ao).slice(0,ho)}function Eo(n){return n.sort((i,e)=>e.confidence-i.confidence)}function Nt(n,i){return i?n.map(_o):n}function _o(n){return{...n,value:`${n.value}${po(n.confidence)}`}}function Ao(n){return n.value.substring(0,go)}function Me(){const n=Object.keys(It).reduce((i,e)=>(i[e]=So(It[e]),i),{});return mo(n)}const To=500;class ui extends h{constructor(){super(...arguments);s(this,"name","FandomTaxonomyPlugin");s(this,"targetingApplied",!1);s(this,"hooks",{onAfterGptWrapperInit:e=>{this.waitForFandomTaxonomyPresent().then(()=>this.updateGpt(e))}});s(this,"api",{getIABPageCategories:()=>x("page"),getIABSiteCategories:()=>x("site"),getTargetingKeyValues:()=>Me()})}getDebugState(){return{isTargetingApplied:this.targetingApplied,iabSiteCategories:x("site"),iabPageCategories:x("page"),taxonomyKeyValues:Me()}}async waitForEvent(){return new Promise(e=>{const t=()=>e();window.addEventListener("FandomTaxonomyUpdated",()=>{window.removeEventListener("FandomTaxonomyUpdated",t),e()})})}async waitForFandomTaxonomyPresent(){if(!window.fandomTaxonomy)try{await Q(Promise.any([de(()=>!!window.fandomTaxonomy),this.waitForEvent()]),To)}catch{g({code:Ji,message:"waitForFandomTaxonomyPresent timed out",priority:c.P2})}}updateGptConfig(e){e.setConfig({pps:{taxonomies:{IAB_CONTENT_2_2:{values:[...new Set([...x("site"),...x("page")])]}}}})}getIABKeyValues(){return{cattax:[li.toString()],cat:x("site"),pagecat:x("page")}}updateGptKVs(e){Object.entries({...this.getIABKeyValues(),...Me()}).forEach(([t,r])=>{const o=e.getTargeting(t);o&&o.length>0&&(r=[...new Set([...o,...r])]),e.setTargeting(t,r)})}updateGpt(e){this.targetingApplied||(this.targetingApplied=!0,this.updateGptKVs(e),this.updateGptConfig(e))}}const gi=.1,yo={buckets:[{max:3,increment:.01},{max:8,increment:.05},{max:20,increment:.5},{max:46,increment:1}]},Io={buckets:[{max:3,increment:.01},{max:8,increment:.05},{max:20,increment:.5}]},Te={data:{currency:"USD",default:gi}},vo={cache:{url:"https://prebid.adnxs.com/pbc/v1/cache"},debug:!1,enableTIDs:!0,enableSendAllBids:!0,sendBidsControl:{bidLimit:2,dealPrioritization:!0},priceGranularity:"dense",mediaTypePriceGranularity:{banner:yo,video:Io},targetingControls:{alwaysIncludeDeals:!0,allowTargetingKeys:["AD_ID","BIDDER","PRICE_BUCKET","UUID","SIZE","DEAL","CACHE_HOST","SOURCE"],allowSendAllBidsTargetingKeys:["AD_ID","BIDDER","PRICE_BUCKET","UUID","SIZE","DEAL"]},timeoutBuffer:400,useBidCache:!0,bidCacheFilterFunction:n=>n.mediaType!=="video",userSync:{filterSettings:{iframe:{bidders:"*",filter:"include"},image:{bidders:"*",filter:"include"}},userIds:[],auctionDelay:50,syncsPerBidder:3,syncDelay:6e3},floors:Te,ozone:{enhancedAdserverTargeting:!1,oz_whitelist_adserver_keys:[]},rubicon:{singleRequest:!0}},No={standard:{storageAllowed:!0,suppressEmptyKeys:!0,allowZeroCpmBids:!0}},ko={standard:{adserverTargeting:[{key:"hb_bidder",val:function(n){return n.bidderCode}},{key:"hb_adid",val:function(n){return n.adId}},{key:"hb_pb",val:function(n){return n.pbCg}},{key:"hb_size",val:function(n){return n.size}},{key:"hb_source",val:function(n){return n.source}},{key:"hb_format",val:function(n){return n.mediaType}},{key:"hb_deal",val:function(n){return n.dealId}}]}},Co={bidfloor:gi,bidfloorcur:"USD"};class Ro{constructor(i){s(this,"prebidReady",!1);s(this,"pbjs");this.prebidConfig=i,window.pbjs=window.pbjs??{},window.pbjs.que=window.pbjs.que??[],this.pbjs=window.pbjs,this.pbjs.que.push(()=>{this.pbjs.bidderSettings=rt(this.pbjs.bidderSettings,No),this.pbjs.setConfig({...this.prebidConfig}),this.prebidReady=!0})}isPrebidReady(){return this.prebidReady}requestBids(i){this.pbjs.que.push(()=>{this.pbjs.requestBids(i)})}setTargetingForGPTAsync(i,e){this.pbjs.que.push(()=>{var t,r;(r=(t=this.pbjs).setTargetingForGPTAsync)==null||r.call(t,i,e)})}pushToQueue(i){this.pbjs.que.push(()=>i(this.pbjs))}setConfig(i){this.pbjs.que.push(()=>{try{this.pbjs.setConfig(i)}catch(e){b({code:Pn,message:`Failed to set Prebid config: ${e}`,priority:c.P2})}})}reset(){this.pbjs.que.push(()=>{this.pbjs.clearAllAuctions()})}}class v{constructor(...i){s(this,"configFlags");this.configFlags=i}isEnabled(i){return this.configFlags.length===0?!0:this.configFlags.every(e=>!!i[e])}transformAdUnitBidConfigs(i){return i}}class Po extends v{transformAdUnitBidConfigs(i,e){for(const t of i)t.params.keywords={...e.pageTargeting};return i}}class wo extends v{transformAdUnitBidConfigs(i,e){for(const t of i)t.params.customData=[{settings:{},targeting:{...e.pageTargeting}}];return i}}const Fo={appnexus:new Po("icPrebidAppNexus"),gumgum:new v("icPrebidGumGum"),ix:new v("icPrebidIX"),kargo:new v("icPrebidKargo"),mgnipbs:new v("icPrebidMagniteS2s"),medianet:new v("icPrebidMedianet"),nobid:new v("icPrebidNobid"),openx:new v("icPrebidOpenX"),ozone:new wo("icPrebidOzone"),pubmatic:new v("icPrebidPubmatic"),rubicon:new v("icPrebidRubicon"),seedtag:new v("icPrebidSeedtag"),triplelift:new v("icPrebidTriplelift"),ttd:new v("icPrebidTtd"),wikia:new v};function kt(){return j("pbjs_debug")}const Lo=n=>{if(n.icPrebidSharedId)return{name:"pubCommonId",storage:{type:"cookie",name:"_pubcid",expires:365}}},Do=n=>{if(!n.icPrebidId5)return;const i={name:"id5Id",params:{partner:1139},storage:{type:"html5",name:"id5id",expires:90,refreshInSeconds:8*3600}};return n.icPrebidId5ExternalModule&&Object.assign(i.params,{externalModuleUrl:"https://cdn.id5-sync.com/api/1.0/id5PrebidModule.js"}),i},Oo=n=>n.icLiveIntentConnectedId?{name:"liveIntentId",params:{publisherId:"79968",requestedAttributesOverrides:{uid2:!0,bidswitch:!0,medianet:!0,magnite:!0,pubmatic:!0,index:!0,openx:!0,thetradedesk:!0,sovrn:!0},ajaxTimeout:1e3,liCollectConfig:{fpiStorageStrategy:"ls",fpiExpirationDays:730}},storage:{name:"__tamLIResolveResult",type:"html5",expires:1}}:void 0,Bo={ignoreOptOut:!1,ignoreAllowedAds:!1,ignoreCoppa:!1},w=(n,i={})=>{var a;const{ignoreAllowedAds:e,ignoreCoppa:t,ignoreOptOut:r}={...Bo,...i},o=(d,l)=>l?!0:!d;return!!(n&&n.ready&&o(n.optOut,r)&&o(!((a=n.allowed)!=null&&a.ads),e)&&o(n.coppa,t))},xo="https://b-code.liadm.com/a-07ev.min.js",Mo="0.3",Uo={unifiedId:"liveConnect-unifiedId",sha2:"liveConnect",md5:"liveConnect-md5",sha1:"liveConnect-sha1"},Ct="LiveConnectConsentInitialized",Ue="LiveConnectPluginReady",Ve=n=>Uo[n];class Y extends h{constructor(e,t){super(e);s(this,"name","LiveConnectPlugin");s(this,"storage",null);s(this,"libraryLoaded",!1);s(this,"consent");s(this,"hooks",{onConsentUpdated:e=>{w(e)?(this.consent=!0,this.setupStorage()):this.consent=!1,window.dispatchEvent(new Event(Ct))},onAdEngineReset:()=>{!this.libraryLoaded||!this.consent||this.resolveAndTrackIds()}});s(this,"api",{waitForHems:async()=>(this.consent===void 0&&await this.waitFor(Ct),this.consent?(this.libraryLoaded||await this.waitFor(Ue),{sha2:this.getFromStorage("sha2"),sha1:this.getFromStorage("sha1"),md5:this.getFromStorage("md5")}):null),checkIfSha2HemAvailable:()=>Y.isEnabled(this.pluginConfig,this.instantConfig)?this.isAvailableInStorage("sha2"):!1});this.instantConfig=t}getDebugState(){return{isScriptLoaded:this.libraryLoaded,isStorageInitialized:!!this.storage,isSha2HemAvailable:this.api.checkIfSha2HemAvailable()}}static isEnabled(e,t){return e.enabled!==!1&&t.icLiveConnect&&t.icLiveConnectCachingStrategy&&!t.icIdentityPartners&&super.isEnabled(e,t)}setupStorage(){!this.consent||this.storage||(this.storage=new ei(this.instantConfig.icLiveConnectCachingStrategy.type==="local"?()=>window.localStorage:()=>window.sessionStorage),this.shouldLoadScript()?(p(y,{type:_.VENDOR_TIME_UPDATE,eventName:"live_connect_started",time:performance.now()}),K({src:xo,isAsyncOrDeferOtherwise:!0,node:"first"}).then(()=>{this.resolveAndTrackIds(),p(y,{type:_.VENDOR_TIME_UPDATE,eventName:"live_connect_loaded",time:performance.now()})})):(p(y,{type:_.VENDOR_TIME_UPDATE,eventName:"live_connect_cached",time:performance.now()}),this.libraryLoaded=!0,window.dispatchEvent(new Event(Ue))))}getHEMTypes(){return this.instantConfig.icLiveConnectCachingStrategy.mandatoryParams}shouldLoadScript(){return this.getHEMTypes().some(t=>!this.isAvailableInStorage(t))}resolveAndTrackIds(){var e,t,r;(r=window.liQ)==null||r.resolve(o=>{for(const[a,d]of Object.entries(o))a==="unifiedId"&&p(y,{type:_.VENDOR_TIME_UPDATE,eventName:"live_connect_responded_uuid",time:performance.now()}),this.storeId(a,d);this.libraryLoaded=!0,window.dispatchEvent(new Event(Ue))},o=>{g({code:Yi,message:"Failed to resolve and track ids",priority:c.P4,error:o})},{qf:((t=(e=this.instantConfig)==null?void 0:e.icLiveConnectQf)==null?void 0:t.toString())??Mo,resolve:["sha2","md5","sha1","unifiedId"]})}storeId(e,t){var o;if(this.isAvailableInStorage(e))return;const r=Ve(e);(o=this.storage)==null||o.setItem(r,t,this.instantConfig.icLiveConnectCachingStrategy.ttl),p(nt.IDENTITY_INFO,{partnerName:r,partnerIdentityId:t})}isAvailableInStorage(e){var t;return!!((t=this.storage)!=null&&t.getItem(Ve(e)))}getFromStorage(e){var t;return((t=this.storage)==null?void 0:t.getItem(Ve(e)))??null}async waitFor(e){return new Promise(t=>{const r=()=>t();window.addEventListener(e,()=>{window.removeEventListener(e,r),t()})})}}function Vo(n){const i=n.match(/.{2}/g);if(!i)throw new Error("Invalid input string");return btoa(String.fromCharCode(...i.map(e=>parseInt(e,16))))}const Wo="VCaqxS6v2X",zo="UID2-X-P-MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEOE+DsIa2aJWHIYpG+JrLpe0uxwrGe9aC4NaP7lQMN9+9/pk/7vydOrzQvxeDSlThIiMwGRMpyjAa593RYoGtFA==",Ho=async(n,i)=>{if(n.icPrebidUID2)try{const e=i.usePlugin(Y);if(!e)return;const t=await e.waitForHems();if(t!=null&&t.sha2)return{name:"uid2",params:{serverPublicKey:zo,subscriptionId:Wo,emailHash:Vo(t.sha2)}}}catch{return}},Go=n=>{var i,e;if(n.icPrebidYahooConnectId)return{name:"connectId",params:{pixelId:"58833",puid:((e=(i=window.fandomContext)==null?void 0:i.tracking)==null?void 0:e.ppid)??"0"},storage:{type:"html5",name:"connectId",expires:15}}},hi="identityLink",qo=n=>{if(n.icPrebidLiveRampATS)return{name:hi,params:{pid:"2161",notUse3P:!1},storage:{type:"cookie",name:"idl_env",expires:15,refreshInSeconds:1800}}},$o="924dbye",jo=n=>{if(n.icPrebidUnifiedId)return{name:"unifiedId",params:{partner:$o},storage:{type:"cookie",name:"pbjs_unifiedid",expires:30}}},Ko=[jo,Lo,Do,Oo,Go,qo],Yo=(n,i)=>{var t;const e=Ko.map(r=>r(i)).filter(r=>r!==void 0);return n.userSync??(n.userSync={}),(t=n.userSync).userIds??(t.userIds=[]),n.userSync.userIds.push(...e),n},Qo=[Ho],Xo=(n,i,e)=>{Qo.forEach(t=>{t(n,i).then(r=>{if(!r)return;const o=e.getConfig("userSync");o.userIds??(o.userIds=[]),o.userIds.push(r),e.mergeConfig({userSync:o}),e.refreshUserIds({submoduleNames:[r.name]})})})},Jo=n=>{if(n.icPrebidLiveRampATSAnalytics)return{provider:"atsAnalytics",options:{pid:"2161"}}},Zo=[Jo],es=(n,i)=>{const e=Zo.map(t=>t(n)).filter(t=>t!==void 0);e.length&&i.enableAnalytics(e)};function ts(n){return n.banner!==void 0}function is(n){return n.video!==void 0}function ns(){var n,i;return(i=(n=window.fandomContext)==null?void 0:n.odyssey)==null?void 0:i.responsiveDeviceType}class I extends h{constructor(e,t){super(e);s(this,"name","PrebidPlugin");s(this,"adEngine");s(this,"prebidWrapper");s(this,"activeBidders",new Map);s(this,"hooks",{onBiddersInit:(e,t)=>{e.adRenderManager.isBiddingEnabled()&&(this.adEngine=e,t.push(this.waitForPrebidReady()))},onCreateBiddersRequests:(e,t,r,o)=>{r.adRenderManager.isBiddingEnabled()&&e.push(this.requestBids(t,o))},onInitPageTargeting:()=>{this.prebidWrapper.pushToQueue(e=>Xo(this.instantConfig,this,e)),this.prebidWrapper.pushToQueue(e=>es(this.instantConfig,e))},onAdEngineReset:()=>{this.prebidWrapper.reset()}});s(this,"api",{addPrebidReadyCallback:e=>{this.prebidWrapper.pushToQueue(e)},setConfig:e=>{this.prebidWrapper.setConfig(e)}});this.instantConfig=t,this.prebidWrapper=this.initPrebidWrapper(),this.initBidderAdapters()}getDebugState(){return{activeBidders:Array.from(this.activeBidders.keys()),isWrapperInitialized:!!this.prebidWrapper,isDebugEnabled:kt()}}async waitForPrebidReady(){const e=new Promise(t=>{this.api.addPrebidReadyCallback(()=>t())});await Q(e,this.instantConfig.icPrebidInitTimeoutMS,"PrebidPlugin.waitForPrebidReady")}initPrebidWrapper(){const e=Yo({...vo,...this.pluginConfig.config,bidderTimeout:this.instantConfig.icAdEngineAuctionTimeoutMS,debug:kt()},this.instantConfig);return new Ro(e)}initBidderAdapters(){for(const[e,t]of Object.entries(Fo))t.isEnabled(this.instantConfig)&&this.activeBidders.set(e,t)}generateAdUnitBids(e,t){const r=[];for(const[o,a]of Object.entries(e.bids)){const d=this.applyMonetizationTiersToBids(a);if(this.activeBidders.has(o)){const l=this.activeBidders.get(o),u=(l==null?void 0:l.transformAdUnitBidConfigs(d,t,this.instantConfig))??[];r.push(...u)}}return r}applyMonetizationTiersToBids(e){var o;const t=(o=this.adEngine)==null?void 0:o.monetizationTierEngine;if(!t)return g({code:on,message:"PrebidPlugin.applyMonetizationTiersToBids: MonetizationTierEngine is not available.",priority:c.P2}),e;const r=[];for(const a of e){if(!a.params)continue;const d=t.filterTieredParamsByCurrentTier(a.params);typeof d>"u"||r.push({...a,params:d})}return r}generateAdUnits(e){const t=[];for(const r of e.adNodes){const o=r.getBidderConfig("prebid");if(!o)continue;let a=[];o.bids&&(a=this.generateAdUnitBids(o,e));const d={...o,code:r.getSlotName(),bids:a,ortb2Imp:{...Co,...o.ortb2Imp??{}}};d.mediaTypes=this.transformAdUnitMediaTypes(r,d.mediaTypes??{}),t.push(d)}return t}transformAdUnitMediaTypes(e,t){const r=e.getBidderSizes();if(ts(t))_r(r)&&(t.banner={sizeConfig:this.transformBannerSizeConfig(r),...t.banner});else if(is(t)){const o=this.transformVideoSizeConfig(r,e.getSlotName());t.video={playerSize:o,w:o?o[0]:void 0,h:o?o[1]:void 0,...t.video}}return t}transformBannerSizeConfig(e){return e.map(([t,r])=>({minViewPort:t,sizes:r}))}transformVideoSizeConfig(e,t){var o,a;const r=(a=(o=e[0])==null?void 0:o[1])==null?void 0:a[0];if(Array.isArray(r)&&r.length===2&&typeof r[0]=="number"&&typeof r[1]=="number")return r;b({code:Fn,message:`PrebidPlugin.transformVideoSizeConfig: Invalid video size configuration for ad node ${t}. Using default size.`,priority:c.P3})}async requestBids(e,t){return E(this.prebidWrapper.isPrebidReady(),"PrebidPlugin.requestBids: Prebid.js is not ready"),new Promise(r=>{var u;const o=this.generateAdUnits(e);t("prebid",e,o);const a=((u=this.usePlugin(at))==null?void 0:u.getOrtb2(e.pageTargeting))??{},d={auctionId:e.auctionId,adUnits:o,ortb2:a,bidsBackHandler:()=>{this.prebidWrapper.setTargetingForGPTAsync(),r()}},l=ns();l&&(d.labels=[l]),this.prebidWrapper.requestBids(d)})}}class at extends h{constructor(){super(...arguments);s(this,"name","OpenRtbPlugin");s(this,"pageTargeting",{});s(this,"adEngine");s(this,"dsaSettings",{dsa:{dsarequired:1,pubrender:2,datatopub:2}});s(this,"orbt2SiteCategories",[]);s(this,"ortb2PageCategories",[]);s(this,"hooks",{onBiddersInit:e=>{this.adEngine=e;const t=this.usePlugin(I);t==null||t.addPrebidReadyCallback(r=>{this.pageTargeting={...e.gptWrapper.getAllTargeting()},this.extendPrebidConfig(r)})}});s(this,"api",{getOrtb2:(e={})=>{var r;const t=((r=this.adEngine)==null?void 0:r.gptWrapper.getAllTargeting())??{};return this.pageTargeting={...t,...e},this.getOrtb2()}})}getDebugState(){return{pageTargeting:{...this.pageTargeting},orbt2SiteCategories:[...this.orbt2SiteCategories],ortb2PageCategories:[...this.ortb2PageCategories]}}getKeywordsSet(e){return new Set([...e.gnre??[],...e.media??[],...e.theme??[],...e.tv??[]])}buildKeywords(){var t;const e=(t=window==null?void 0:window.fandomContext)==null?void 0:t.site;return e!=null&&e.tags?Array.from(this.getKeywordsSet(e.tags).values()).filter(Boolean).join(","):""}setOrtb2Categories(){const e=this.usePlugin(ui);this.orbt2SiteCategories=(e==null?void 0:e.getIABSiteCategories())??[],this.ortb2PageCategories=(e==null?void 0:e.getIABPageCategories())??[]}getOrtb2(){this.setOrtb2Categories();const{pageName:e,pageId:t,lang:r,...o}=this.pageTargeting;return{site:{...o,cattax:li,cat:[...this.orbt2SiteCategories],pagecat:[...this.ortb2PageCategories],id:t==null?void 0:t.toString(),name:e,content:{language:r,context:5},keywords:this.buildKeywords(),domain:window.location.hostname,publisher:{domain:window.location.hostname}},regs:{ext:{...this.dsaSettings}}}}extendPrebidConfig(e){e.mergeConfig({ortb2:this.getOrtb2()})}}function pi(n,i,e){var r;const t=(r=n.getResponseInformation)==null?void 0:r.call(n);if(t)return{advertiserId:t.advertiserId,creativeId:t.creativeId,lineItemId:t.lineItemId,orderId:t.campaignId,selectedSize:e,configuredSizes:Oe(i.getSizes())}}function We(n,i,e,t){const r=i.getSlotElementId(),o=e.getAdNodeByName(r);if(!o)return;const a={type:n,slotName:r,slotInfo:pi(i,o,t),rv:o.getRenderCount()};p(Ne,a)}function Rt(n,i){p(y,{type:n,time:performance.now(),slotName:i})}const rs=/[?&]prev_iu_szs=([^&#]*)/;function os(n){if(!n)return"";const i=n.match(rs);return i?decodeURIComponent(i[1]):""}function ss(n){var t;if(!n)return[];const i=((t=n.getContentUrl)==null?void 0:t.call(n))??"",e=os(i);return e?e.split("|").filter(Boolean):[]}function as(n,i,e,t){const r=i.getSlotElementId(),o=e.getAdNodeByName(r);if(!o)return;const a={type:n,slotName:r,slotInfo:{...ls(i),selectedSize:ds(t),configuredSizes:Oe(o.getSizes()),parsedSizes:ss(i)}};p(zi,a)}function ds(n){if(n!==void 0)return n===null?null:Ce(n)}function ls(n){var e;const i=(e=n.getResponseInformation)==null?void 0:e.call(n);return i?{advertiserId:i.advertiserId,creativeId:i.creativeId,lineItemId:i.lineItemId,orderId:i.campaignId}:{advertiserId:void 0,creativeId:void 0,lineItemId:void 0,orderId:void 0}}class mi extends h{constructor(e,t){super(e);s(this,"name","HeavyAdsDetectionPlugin");s(this,"detectedHeavyAds",[]);s(this,"onHeavyAdDetectedCallbacks",[]);s(this,"api",{getDetectedHeavyAds:()=>this.detectedHeavyAds.slice(),onHeavyAdDetected:e=>{this.onHeavyAdDetectedCallbacks.push(e)}});t.icInterventionTracking&&this.initializeHeavyAdDetection()}getDebugState(){return{detectedHeavyAds:this.detectedHeavyAds.slice()}}initializeHeavyAdDetection(){if(typeof ReportingObserver>"u"){b({code:Mn,message:"ReportingObserver not supported, heavy ads detection unavailable",priority:c.P4});return}window.addEventListener("message",this.handleMessageEvent.bind(this),{capture:!0,passive:!0})}handleMessageEvent(e){if(e.origin!==window.origin)return;const t=e.data;if(t&&t.libId==="@wikia/post-quecast"&&t.action&&t.action.id==="HeavyAdIntervention"){const r={slotName:t.action.slotName,reason:this.parseReasonFromMessage(t.action.message),timestamp:t.action.timestamp};this.detectedHeavyAds.push(r),this.onHeavyAdDetectedCallbacks.forEach(o=>o(r)),b({code:Un,message:`HeavyAdsDetectionPlugin detected heavy ad for slot ${r.slotName} (${r.reason})`,priority:c.P3})}}parseReasonFromMessage(e){return e.includes("CPU usage")?"cpu":e.includes("network")?"network":"unknown"}}class cs{constructor(i,e){s(this,"listener",this.detectClickOnIframe.bind(this));this.slotName=i,this.callbackOnDetection=e}init(){window.addEventListener("blur",this.listener)}detectClickOnIframe(){const i=document.activeElement;(i==null?void 0:i.closest(`div#${CSS.escape(this.slotName)}`))!==null&&(this.callbackOnDetection(),this.clearDetection())}clearDetection(){setTimeout(()=>{document.activeElement.blur()},100)}detach(){window.removeEventListener("blur",this.listener)}}function fi(n,i,e,t){return{slotName:n.adUnitCode,baseSlotName:(e==null?void 0:e.getBaseSlotName())??n.adUnitCode,rv:(e==null?void 0:e.getRenderCount())??void 0,bidInfo:{status:i,bidderName:n.bidderCode,size:`${n.width}x${n.height}`,price:`${n.cpm}`,timeToRespond:n.timeToRespond,auctionId:n.auctionId,rejectionReason:n.rejectionReason,fullAuction:t}}}function dt(n,i,e,t){return{slotName:n.adUnitCode,baseSlotName:(e==null?void 0:e.getBaseSlotName())??n.adUnitCode,rv:(e==null?void 0:e.getRenderCount())??void 0,bidInfo:{status:i,bidderName:n.bidder,auctionId:n.auctionId,size:void 0,price:void 0,timeToRespond:void 0,rejectionReason:void 0,fullAuction:t}}}function us(n,i,e,t){if(!t)return;const r=fi(n,"on_time",i,e);p(W.BIDDER_RESPONSE,r)}function gs(n,i,e,t){if(!t)return;const r=fi(n,"rejected",i,e);p(W.BIDDER_RESPONSE,r)}function hs(n,i,e,t){if(!t)return;const r=dt(n,"unknown",i,e);p(W.BIDDER_RESPONSE,r)}function ps(n,i,e,t){if(!t)return;const r=dt(n,"timedout",i,e);p(W.BIDDER_RESPONSE,r)}function ms(n,i,e,t){if(!t)return;const r=dt(n,"declined",i,e);p(W.BIDDER_RESPONSE,r)}function ae(n,i){if(!i)return;const e={slotName:"error",baseSlotName:"error",rv:void 0,bidInfo:{status:"error",bidderName:"error",auctionId:void 0,size:void 0,price:void 0,timeToRespond:void 0,rejectionReason:void 0,fullAuction:n}};p(W.BIDDER_RESPONSE,e)}const fs={auctionEndWait:100,percentFullAuctions:.01,percentSampleTarget:.1};class bs{constructor(i,e,t=fs){s(this,"fullAuction");s(this,"sampleRate");s(this,"pendingAuctions",{});this.pbjs=i,this.adNodeManager=e,this.config=t,this.validateSampling(t.percentFullAuctions,t.percentSampleTarget),this.fullAuction=Math.random()<t.percentFullAuctions,j("force_tracking")&&(this.fullAuction=!0),this.fullAuction?this.sampleRate=1:this.sampleRate=(t.percentSampleTarget-t.percentFullAuctions)/(1-t.percentFullAuctions),this.monitorAuctionInit(),this.monitorTimedOutRequests(),this.monitorAuctionEnd()}validateSampling(i,e){if(i>e)throw Error("percentFullAuctions must be less than the percentSampleTarget");if(e>1||e<0)throw Error("percentSampleTarget must be between 0 and 1");if(i>1||i<0)throw Error("percentFullAuctions must be between 0 and 1")}bidIsSampled(){return Math.random()<this.sampleRate}monitorAuctionInit(){this.pbjs.onEvent("auctionInit",i=>{const e={bidState:{}};i.bidderRequests.forEach(t=>{try{t.bids.forEach(r=>{e.bidState[J(r)]="requested"})}catch{g({code:sn,message:`Error tracking initial auctionInit state for bidRequest: ${JSON.stringify(t)}`,priority:c.P4})}}),this.pendingAuctions[i.auctionId]=e})}monitorAuctionEnd(){this.pbjs.onEvent("auctionEnd",i=>{this.recordBidsReceived(i),this.recordBidsRejected(i),setTimeout(()=>{this.recordNoBids(i),this.recordUnknownBids(i),delete this.pendingAuctions[i.auctionId]},this.config.auctionEndWait)})}monitorTimedOutRequests(){this.pbjs.onEvent("bidTimeout",i=>{i.forEach(e=>{try{const t=this.pendingAuctions[e.auctionId],r=this.adNodeManager.getAdNodeByName(e.adUnitCode);t.bidState[J(e)]="timedout",ps(e,r,this.fullAuction,this.bidIsSampled())}catch{g({code:an,message:"Error recording bidTimeout",priority:c.P4,data:e}),ae(this.fullAuction,this.bidIsSampled())}})})}recordBidsReceived(i){const e=this.pendingAuctions[i.auctionId];i.bidsReceived.forEach(t=>{try{const r=this.adNodeManager.getAdNodeByName(t.adUnitCode);e.bidState[J(t)]="on_time",us(t,r,this.fullAuction,this.bidIsSampled())}catch(r){g({code:dn,message:"Error recording bidReceived",priority:c.P4,error:r,data:t}),ae(this.fullAuction,this.bidIsSampled())}})}recordBidsRejected(i){const e=this.pendingAuctions[i.auctionId];i.bidsRejected.forEach(t=>{try{e.bidState[J(t)]="rejected";const r=this.adNodeManager.getAdNodeByName(t.adUnitCode);gs(t,r,this.fullAuction,this.bidIsSampled())}catch{g({code:ln,message:"Error recording bidRejected",priority:c.P4,data:t}),ae(this.fullAuction,this.bidIsSampled())}})}recordNoBids(i){const e=this.pendingAuctions[i.auctionId];i.noBids.forEach(t=>{try{const r=J(t);if(e.bidState[r]!="timedout"){e.bidState[r]="declined";const o=this.adNodeManager.getAdNodeByName(t.adUnitCode);ms(t,o,this.fullAuction,this.bidIsSampled())}}catch{g({code:cn,message:"Error recording no_bid",priority:c.P4,data:t}),ae(this.fullAuction,this.bidIsSampled())}})}recordUnknownBids(i){try{const e=i.bidderRequests.flatMap(r=>r.bids),t=this.pendingAuctions[i.auctionId];for(const[r,o]of Object.entries(t.bidState))if(o==="requested"){const a=e.find(d=>J(d)===r);if(a){const d=this.adNodeManager.getAdNodeByName(a.adUnitCode);hs(a,d,this.fullAuction,this.bidIsSampled())}else g({code:un,message:"Could not find bid data to report",priority:c.P4}),ae(this.fullAuction,this.bidIsSampled())}}catch{g({code:gn,message:"Error recording unknown bids",priority:c.P4})}}}function J(n){return`${n.bidder}-${n.transactionId}`}function Ss(n){return"timedOut"in n&&n.timedOut}class Es{constructor(){s(this,"A9_BIDDER_NAME","a9")}trackBidResponse(i,e,t,r){e.forEach(o=>{if(Ss(o)){const d=this.buildTimedOutBidInfo(i,r,t);this.sendBidInfo(d,o,i);return}if(o.size=="0x0"){const d=this.buildDeclinedBidInfo(i,r,t);this.sendBidInfo(d,o,i);return}const a=this.buildOnTimeBidInfo(i,r,o,t);this.sendBidInfo(a,o,i)})}buildTimedOutBidInfo(i,e,t){return{status:"timedout",bidderName:this.A9_BIDDER_NAME,size:void 0,price:void 0,timeToRespond:Math.round(t),timedOut:!0,auctionId:i.auctionId,fullAuction:e}}buildDeclinedBidInfo(i,e,t){return{status:"declined",bidderName:this.A9_BIDDER_NAME,size:void 0,price:void 0,timeToRespond:Math.round(t),timedOut:!1,auctionId:i.auctionId,fullAuction:e}}buildOnTimeBidInfo(i,e,t,r){return{status:"on_time",bidderName:this.A9_BIDDER_NAME,size:t.size,price:t.targeting.amznbid,timeToRespond:Math.round(r),timedOut:!1,auctionId:i.auctionId,fullAuction:e}}sendBidInfo(i,e,t){const r=e.slotID;let o=0,a=r;const d=t.adNodes.find(u=>u.getSlotName()===r);d&&(o=d.getRenderCount(),a=d.getBaseSlotName());const l={slotName:r,baseSlotName:a,rv:o,bidInfo:i};p(W.BIDDER_RESPONSE,l)}}class bi extends h{constructor(){super(...arguments);s(this,"name","TrackingPlugin");s(this,"auctionTracker");s(this,"a9AuctionTracker");s(this,"SLOTS_ELIGIBLE_TO_LOADING_TIME_TRACK",["top_leaderboard","top_boxad","floor_adhesion","interstitial"]);s(this,"clickTrackingSlotMap",new Map);s(this,"slotsAlreadyTrackedForLoadTime",{requested:new Map,rendered:new Map});s(this,"hooks",{onInitPageTargeting:()=>{p(y,{type:_.AE_INIT,time:performance.now()})},onAdEngineInit:e=>{document.addEventListener("visibilitychange",this.onPageVisibilityChange.bind(this,e)),this.onPageVisibilityChange(e)},onBiddersInit:e=>{var t;(t=this.usePlugin(I))==null||t.addPrebidReadyCallback(r=>{this.auctionTracker=new bs(r,e.adNodeManager),this.a9AuctionTracker=new Es})},onBeforeFirstCallAdsRequest:(e,t)=>{var r;return this.onGptSlotRequested(e,t),this.onGptSlotRendered(e,t),this.onGptResponseReceived(e,t),(r=this.usePlugin(mi))==null||r.onHeavyAdDetected(o=>{this.onHeavyAdDetected(e,t,o)}),e},onFirstRenderCycleComplete(){_e().cmd.push(e=>e.issueManager.triggerPageStatus({trigger:"first_render_cycle"}))},onBeforeAdsRequest:()=>{if(j("temp_force_error"))throw Error("Fake Error onBeforeAdsRequest")},onAdEngineReset:()=>{this.slotsAlreadyTrackedForLoadTime.requested.clear(),this.slotsAlreadyTrackedForLoadTime.rendered.clear();for(const e of this.clickTrackingSlotMap.values())e.detach();this.clickTrackingSlotMap.clear()}});s(this,"api",{trackA9BidResponse:(e,t,r)=>{var a;const o=t.filter(()=>this.auctionTracker.bidIsSampled());(a=this.a9AuctionTracker)==null||a.trackBidResponse(e,o,r,this.auctionTracker.fullAuction)}})}getDebugState(){return{isAuctionTrackerInitialized:!!this.auctionTracker,isA9AuctionTrackerInitialized:!!this.a9AuctionTracker,clickTrackingSlotNames:Array.from(this.clickTrackingSlotMap.keys()),slotsTrackedForLoadTimeRequested:Array.from(this.slotsAlreadyTrackedForLoadTime.requested.keys()),slotsTrackedForLoadTimeRendered:Array.from(this.slotsAlreadyTrackedForLoadTime.rendered.keys())}}isSlotEligibleToLoadingTimeTrack(e){return this.SLOTS_ELIGIBLE_TO_LOADING_TIME_TRACK.includes(e)}onGptSlotRequested(e,t){e.addEventListener("slotRequested",r=>{const o=r.slot,a=o.getSlotElementId();We(G.SLOT_REQUESTED_INFO,o,t),this.isSlotEligibleToLoadingTimeTrack(a)&&(this.slotsAlreadyTrackedForLoadTime.requested.has(a)||(Rt(_.SLOT_REQUESTED,a),this.slotsAlreadyTrackedForLoadTime.requested.set(a,!0)))})}onGptSlotRendered(e,t){e.addEventListener("slotRenderEnded",r=>{if(r.isEmpty)return;const o=r.slot,a=o.getSlotElementId(),d=t.getAdNodeByName(a);d&&(We(G.SLOT_RENDERED_INFO,o,t,Ce(r.size??"")),as(Kt.SLOT_SIZE_ESTABLISHED,o,t,r.size),this.attachClickTracking(a,d),this.isSlotEligibleToLoadingTimeTrack(a)&&(this.slotsAlreadyTrackedForLoadTime.rendered.has(a)||(Rt(_.SLOT_RENDERED,a),this.slotsAlreadyTrackedForLoadTime.rendered.set(a,!0))))})}onGptResponseReceived(e,t){e.addEventListener("slotResponseReceived",r=>{const o=r.slot;We(G.SLOT_CODE_SERVED_INFO,o,t)})}onPageVisibilityChange(e){e.gptWrapper.setTargeting("is_bg",document.hidden?V:me)}attachClickTracking(e,t){if(this.clickTrackingSlotMap.has(e))return;const r=()=>{const a=t.getRenderCount(),d={type:G.SLOT_CLICKED,slotName:e,rv:a};p(Ne,d)},o=new cs(e,r);o.init(),this.clickTrackingSlotMap.set(e,o)}onHeavyAdDetected(e,t,r){const o=r.slotName,a=t.getAdNodeByName(o);if(!a){b({code:Bn,message:`HeavyAdsDetectionPlugin detected heavy ad for unknown slot ${o}`,priority:c.P2});return}const d=e.getSlotById(o);if(!d){b({code:xn,message:`HeavyAdsDetectionPlugin detected heavy ad for slot ${o}, but GPT has no record of that slot`,priority:c.P2});return}p(Ne,{type:G.SLOT_HEAVY_AD_INTERVENTION,slotName:o,rv:a.getRenderCount(),reason:r.reason,slotInfo:pi(d,a)})}}const _s="b8f84ec5-52e5-45d5-a863-6181aea3a67b",As="3115";class Ts extends h{constructor(e,t){super(e);s(this,"name","A9Plugin");s(this,"wrapper");s(this,"errorOnInit");s(this,"consentData");s(this,"adEngine");s(this,"hooks",{onConsentUpdated:e=>{this.consentData=e,this.wrapper?this.wrapper.handleConsentChange(e):this.initWrapper()},onAdEngineInit:e=>{e.adRenderManager.isBiddingEnabled()&&(this.adEngine=e,this.initWrapper())},onCreateBiddersRequests:(e,t,r,o)=>{r.adRenderManager.isBiddingEnabled()&&e.push(Q(this.executeBidRequest(t,o),this.instantConfig.icAdEngineAuctionTimeoutMS,`A9 bid request timed out for auction ${t.auctionId}`).catch(a=>{if(a.message.includes("request timed out")){b({code:Rn,message:a.message,priority:c.P3,error:a,data:t});return}throw a}))}});this.instantConfig=t}static isEnabled(e,t){return!!t.icA9Bidder&&super.isEnabled(e,t)}getDebugState(){return{isWrapperInitialized:!!this.wrapper,initErrorMessage:this.errorOnInit??null,resolvedPubId:this.adEngine?this.resolvePubID(this.adEngine):null}}trackBidResponse(e,t,r){var o;try{(o=this.usePlugin(bi))==null||o.trackA9BidResponse(e,t,r)}catch(a){g({code:en,message:"Error tracking A9 bids",priority:c.P3,error:a})}}resolvePubID(e){const{monetizationTierEngine:t}=e;return t.isTier3()?_s:t.isTier4()?As:null}async executeBidRequest(e,t){E(this.wrapper,"A9Wrapper has not been initialized");const r=`${N.AE_AUCTION_START_A9_START}_${e.auctionId}`;performance.mark(r),this.wrapper.updateApstagOrtb2Signals(this.getOrtb2Object());const o=await this.wrapper.requestBids(e,t),{duration:a}=performance.measure(Qt.AE_AUCTION_DURATION_A9_BID_TOTAL_TIME,r);this.trackBidResponse(e,o,a)}initWrapper(){if(!this.consentData||!this.adEngine||!this.isConsentGranted(this.consentData)||this.wrapper||this.errorOnInit||this.isKidWiki())return;const e=this.resolvePubID(this.adEngine);if(!e){const t="A9Wrapper initialization failed: pubID could not be resolved";g({code:tn,message:t,priority:c.P2}),this.errorOnInit=t;return}this.wrapper??(this.wrapper=new oo(this.consentData,this.instantConfig.icAdEngineAuctionTimeoutMS,this.instantConfig,e,this.getOrtb2Object())),this.errorOnInit=void 0}getOrtb2Object(e){var t;return(t=this.usePlugin(at))==null?void 0:t.getOrtb2(e)}isConsentGranted(e){return w(e,{ignoreOptOut:!0})}isKidWiki(){var t;const[e]=((t=this.adEngine)==null?void 0:t.gptWrapper.getTargeting("kid_wiki"))??[];return e===V}}class ys extends h{constructor(e,t){super(e);s(this,"name","ConsentManagementPrebidPlugin");s(this,"isTcfAvailable",!1);s(this,"isUspAvailable",!1);s(this,"hooks",{onConsentUpdated:({coppa:e,consentApi:t})=>{var r;this.isTcfAvailable=t==="tcf",this.isUspAvailable=t==="usp",(r=this.usePlugin(I))==null||r.addPrebidReadyCallback(o=>{o.mergeConfig({coppa:e})})},onBiddersInit:()=>{var e;(e=this.usePlugin(I))==null||e.addPrebidReadyCallback(t=>{this.isTcfAvailable&&t.mergeConfig({consentManagement:{gdpr:{cmpApi:"iab",timeout:this.instantConfig.icPrebidConsentManagementTimeoutMS,defaultGdprScope:!0}}}),this.isUspAvailable&&t.mergeConfig({consentManagement:{usp:{cmpApi:"iab",timeout:this.instantConfig.icPrebidConsentManagementTimeoutMS}}})})}});this.instantConfig=t}getDebugState(){return{isTcfAvailable:this.isTcfAvailable,isUspAvailable:this.isUspAvailable}}}class Ye{constructor(i){s(this,"iconSvg",'<svg width="9" height="9" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 22C6.48605 22 2.00005 17.514 2.00005 12C2.00005 6.486 6.48605 2 12 2C17.514 2 22 6.486 22 12C22 17.514 17.514 22 12 22M12 0C5.383 0 0 5.383 0 12C0 18.617 5.383 24 12 24C18.617 24 24 18.617 24 12C24 5.383 18.617 0 12 0" clip-rule="evenodd"/><path d="M10.9998 18.0171V10.0096C10.9998 9.4556 11.4467 9.00777 11.9997 9.00777 12.5527 9.00777 12.9997 9.4556 12.9997 10.0096V18.0171C12.9997 18.5711 12.5527 19.0189 11.9997 19.0189 11.4467 19.0189 10.9998 18.5711 10.9998 18.0171zM12.0057 7.01379C11.4527 7.01379 10.9998 6.55995 10.9998 6.00693 10.9998 5.4539 11.4527 5.00006 12.0057 5.00006 12.5587 5.00006 13.0107 5.4539 13.0107 6.00693 13.0107 6.55995 12.5587 7.01379 12.0057 7.01379" clip-rule="evenodd"/></svg>');this.props=i}render(){const e=new DOMParser().parseFromString(this.iconSvg,"image/svg+xml").documentElement,t=()=>{document.querySelectorAll(".dsa-dialog").forEach(a=>{document.body.removeChild(a)})},r=async()=>{const{AdvertisementInfoDialog:o}=await P(async()=>{const{AdvertisementInfoDialog:d}=await import("./AdvertisementInfoDialog-ftkjtV7l.js");return{AdvertisementInfoDialog:d}},[]);t();const a=new o(this.props).render();document.body.appendChild(a),a.showModal()};return jsxRenderer("span",{className:"dsa-advertisement-label-icon",onClick:r},e)}}class Is{constructor(i){this.props=i}getTranslatedLabelText(){var t;const i=document.getElementsByTagName("fandom-ad");for(const r of i){const o=(t=r.getAdLabelElement)==null?void 0:t.call(r);if(o)return o.innerText}const e=document.querySelector(".fandom-ad-label")??document.querySelector(".ae-translatable-label");return e?e.innerText:"Advertisement "}render(){const{behalf:i,paid:e}=this.props,t=new Ye({behalf:i,paid:e}).render();return jsxRenderer("div",{className:"ae-translatable-label fandom-ad-label advertisement-label",id:"label-"+this.props.slot},jsxRenderer("span",{className:"dsa-advertisement-label-clickable"},this.getTranslatedLabelText(),t))}}class vs extends h{constructor(){super(...arguments);s(this,"name","DigitalServicesActPlugin");s(this,"adUnitsWithoutDynamicLabel",["interstitial","floor_adhesion"]);s(this,"defaultDSAPrebidSettings",{dsarequired:1,pubrender:2,datatopub:2});s(this,"hooks",{onBiddersInit:()=>{const e=this.usePlugin(I);E(e,"PrebidPlugin not found"),e.addPrebidReadyCallback(t=>{this.extendPrebidConfig(t),this.attachPrebidEventsHandlers(t)})}})}extendPrebidConfig(e){e.mergeConfig({ortb2:{regs:{ext:{dsa:{...this.defaultDSAPrebidSettings}}}}})}getBidMeta(e){return e.meta??{}}getDSAMeta(e){return this.getBidMeta(e).dsa??null}isDSADataAvailable(e){var t,r;return typeof((t=this.getDSAMeta(e))==null?void 0:t.behalf)=="string"&&typeof((r=this.getDSAMeta(e))==null?void 0:r.adrender)=="number"}addDSALabelToSlot(e){var d,l;const t=document.querySelector(`fandom-ad#${e.adUnitCode}`),r=(d=t==null?void 0:t.getAdLabelElement)==null?void 0:d.call(t),{behalf:o,paid:a}=this.getDSAMeta(e);if(r){const u=new Ye({behalf:o,paid:a}).render();r.classList.add("advertisement-label","dsa-advertisement-label-clickable"),(l=r.querySelector(".dsa-advertisement-label-icon"))==null||l.remove(),r.appendChild(u)}else{const u=new Is({slot:e.adUnitCode,behalf:o,paid:a}).render(),f=document.getElementById(e.adUnitCode);f==null||f.appendChild(u)}}handleTopLeaderboard(e){var d,l,u;const t=(l=(d=document.querySelector("fandom-ad#top_leaderboard"))==null?void 0:d.getAdLabelElement)==null?void 0:l.call(d);if(!t)return;const{behalf:r,paid:o}=this.getDSAMeta(e),a=new Ye({behalf:r,paid:o}).render();t.classList.add("advertisement-label","dsa-advertisement-label-clickable"),(u=t.querySelector(".dsa-advertisement-label-icon"))==null||u.remove(),t.appendChild(a)}attachPrebidEventsHandlers(e){const t=({bid:r})=>{!this.isDSADataAvailable(r)||this.adUnitsWithoutDynamicLabel.includes(r.adUnitCode)||(r.adUnitCode==="top_leaderboard"?this.handleTopLeaderboard(r):this.addDSALabelToSlot(r))};e.onEvent("adRenderSucceeded",t)}}const Ns=(n,...i)=>n.reduce((t,r,o)=>{const a=i[o]||"";return t+r+a},"").replace(/\s+/g," ").trim(),Si=document.createElement("style");document.head.appendChild(Si);const Pt=Si.sheet,ks=n=>typeof(n==null?void 0:n.dynamic)=="object"&&!!n.dynamic.single,Cs=n=>typeof(n==null?void 0:n.dynamic)=="object"&&!!n.dynamic.outOfPage;class Rs extends h{constructor(){super(...arguments);s(this,"name","DynamicSlotPlugin");s(this,"requestedSlots",[]);s(this,"missingAnchors",[]);s(this,"hooks",{onAfterAdNodeManagerInit:(e,t)=>{for(const r of Object.values(t))try{ks(r)&&this.handleDynamicSingleSlot(r),Cs(r)&&this.handleDynamicOutOfPageSlot(r)}catch(o){g({code:Xi,priority:c.P3,error:o,message:`Dynamic slot "${r.name}" failed to render`})}}})}getDebugState(){return{requestedSlots:[...this.requestedSlots],missingAnchors:this.missingAnchors.map(e=>({...e}))}}renderWrapper(e,t){const r=document.createElement("div");return r.id=e,r.classList.add(S.WRAPPER_CLASS),t&&Pt&&Pt.insertRule(Ns`
        #${e} {
          ${t}
        }
      `),r}handleDynamicSingleSlot(e){const t=e.dynamic.single,r=document.querySelector(t.selector);if(!r){g({code:Qi,message:`Dynamic slot anchor element with selector "${t.selector}" not found`,priority:c.P2}),this.missingAnchors.push({slotName:e.name,selector:t.selector});return}this.renderDynamicSlot(r,e.name,t),this.requestedSlots.push(e.name)}handleDynamicOutOfPageSlot(e){const t=document.createElement(S.ELEMENT_NAME);t.id=e.name,document.body.append(t)}renderDynamicSlot(e,t,r){var a;const o=document.createElement(S.ELEMENT_NAME);if(o.id=t,(a=r.wrapper)!=null&&a.id){const d=this.renderWrapper(r.wrapper.id,r.wrapper.css);d.appendChild(o),e[r.insertMethod](d);return}e[r.insertMethod](o)}}const Ps='<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19.707 4.293a.999.999 0 0 0-1.414 0L12 10.586 5.707 4.293a.999.999 0 1 0-1.414 1.414L10.586 12l-6.293 6.293a.999.999 0 1 0 1.414 1.414L12 13.414l6.293 6.293a.997.997 0 0 0 1.414 0 .999.999 0 0 0 0-1.414L13.414 12l6.293-6.293a.999.999 0 0 0 0-1.414" fill-rule="evenodd"/></svg>';function ws(n){const i=new DOMParser,e=document.createElement("button"),t=["button-control","button-close","floor-adhesion-close-button"],r=i.parseFromString(Ps,"image/svg+xml").documentElement;return e.appendChild(r),e.classList.add(...t),e.addEventListener("click",n),e}class Qe{constructor(i=0){s(this,"observers",new Map);s(this,"history",[]);this.historySize=i}subscribe(i){const e=Symbol();return this.observers.set(e,i),this.historySize>0&&this.history.forEach(t=>i(t)),()=>{this.observers.delete(e)}}notify(i){this.historySize>0&&(this.history.push(i),this.history.length>this.historySize&&this.history.shift()),this.observers.forEach(e=>e(i))}}function fe(){var n;return((n=window.fandomHost)==null?void 0:n.device)==="smartphone"}const te={DESKTOP_COLLAPSE:[9,9],DESKTOP_SUCCESS:[11,11],MOBILE_COLLAPSE:[6,6],MOBILE_SUCCESS:[8,8]};function wt(n,i,e){const t=Ir(n.getSizes(),i);n.setSizes(t),n.removeSizes(e)}function Fs(n){fe()?wt(n,te.MOBILE_SUCCESS,te.MOBILE_COLLAPSE):wt(n,te.DESKTOP_SUCCESS,te.DESKTOP_COLLAPSE)}function Ft(n){return n===te.MOBILE_SUCCESS[1]||n===te.DESKTOP_SUCCESS[1]}const ze=50;class Ei extends h{constructor(){super(...arguments);s(this,"name","FloorAdhesionPlugin");s(this,"floorAdhesionSlotName","floor_adhesion");s(this,"containerRendered",!1);s(this,"adEngine");s(this,"adNodeManager");s(this,"closeButtonElement");s(this,"collapseEventSubscriber",new Qe(1));s(this,"closeButtonOnClickEventSubscriber",new Qe(1));s(this,"observer");s(this,"isTentpole",!1);s(this,"hooks",{onAfterAdNodeManagerInit:e=>{this.adNodeManager=e},onAdEngineInit:e=>{this.adEngine=e,this.addSlotRenderEndedFloorAdhesionListener(e)},onAdEngineReset:()=>{var r,o;this.containerRendered=!1,this.isTentpole=!1,this.removeCloseButton(),this.observer&&(this.observer.disconnect(),this.observer=void 0);let e=(r=this.adNodeManager)==null?void 0:r.getAdNodeByName(this.floorAdhesionSlotName);const t=!e;if(e??(e=(o=this.adNodeManager)==null?void 0:o.createAdNode(this.floorAdhesionSlotName)),e){const a=this.getFloorAdhesionWrapper(e);t&&a.style.display==="none"&&(a.style.display="")}}});s(this,"api",{activateTentpole:()=>{this.isTentpole=!0},block:()=>{try{E(this.adNodeManager,"adNodeManager is not defined"),this.adNodeManager.blockSlot(this.floorAdhesionSlotName)}catch(e){g({code:Ki,message:"Could not block the slot",priority:c.P3,error:e})}},unblock:async()=>{var o;const{adNodeManager:e,gptWrapper:t}=this.adEngine??{};this.isTentpole&&t&&(t.setTargeting("uap","none"),t.setTargeting("uap_c","none"));const r=e==null?void 0:e.getAdNodeByName(this.floorAdhesionSlotName);r?(r.unblock(),this.expand(r),Fs(r),await((o=this.adEngine)==null?void 0:o.adRenderManager.requestRender([r]))):b({code:kn,message:`[FloorAdhesionPlugin] Could not find AdNode for ${this.floorAdhesionSlotName} to unblock.`,priority:c.P4})},onCollapse:e=>this.collapseEventSubscriber.subscribe(e),onClose:e=>this.closeButtonOnClickEventSubscriber.subscribe(e)})}getDebugState(){return{isContainerRendered:this.containerRendered,isTentpole:this.isTentpole,hasCloseButton:!!this.closeButtonElement,hasActiveObserver:!!this.observer}}startObservingSizeChanges(e,t){const r=t.getElement();r&&(this.observer=new ResizeObserver(o=>{o.forEach(a=>{if(a.target!==r)return;const d=a.contentRect.height;this.render(e,t,d)})}),this.observer.observe(r))}getWrapperId(e){var t,r,o;return(o=(r=(t=e==null?void 0:e.getSlotConfig().dynamic)==null?void 0:t.single)==null?void 0:r.wrapper)==null?void 0:o.id}getFloorAdhesionWrapper(e){let t=e.getParentWrapper();if(!t){const r=this.getWrapperId(e);E(r,"floorAdhesionWrapperId is not defined"),t=document.getElementById(r)}return E(t,"floorAdhesionWrapper is not defined"),t}createAndAppendCloseButton(e,t){this.closeButtonElement=ws(()=>{e.style.display="none";const r=t.getRenderCount();this.adNodeManager.removeAdNode(t),p(Ne,{type:G.SLOT_FORCE_CLOSE_INFO,slotName:this.floorAdhesionSlotName,rv:r||void 0}),this.closeButtonOnClickEventSubscriber.notify()}),e.appendChild(this.closeButtonElement)}removeCloseButton(){this.closeButtonElement&&(this.closeButtonElement.remove(),this.closeButtonElement=void 0)}isFirstRenderOfBigAd(e){return!this.containerRendered&&e>ze}isRefreshToSmallerAd(e){return this.containerRendered&&e<=ze&&!Ft(e)}isRefreshToBiggerAd(e){return this.containerRendered&&(e>ze||Ft(e))&&!this.closeButtonElement}render(e,t,r){this.containerRendered||e.classList.add("add-background"),this.isFirstRenderOfBigAd(r)?this.createAndAppendCloseButton(e,t):this.isRefreshToSmallerAd(r)?this.removeCloseButton():this.isRefreshToBiggerAd(r)&&this.createAndAppendCloseButton(e,t),this.containerRendered=!0}collapse(e){const t=e.getElement(),r=this.getFloorAdhesionWrapper(e);r.style.display="none",t&&(t.style.height="0px"),this.containerRendered=!1,this.collapseEventSubscriber.notify(),this.observer&&(this.observer.disconnect(),this.observer=void 0)}expand(e){const t=this.getFloorAdhesionWrapper(e);t.style.display="",t.style.height="",e.getElement().style.height=""}addSlotRenderEndedFloorAdhesionListener(e){e.gptWrapper.addSlotEventListener(this.floorAdhesionSlotName,"slotRenderEnded",t=>{var o;const r=(o=this.adNodeManager)==null?void 0:o.getAdNodeByName(this.floorAdhesionSlotName);if(r){if(t.isEmpty){this.collapse(r);return}this.observer||this.startObservingSizeChanges(this.getFloorAdhesionWrapper(r),r)}})}}const Ls=".mw-parser-output > h2";function se(n){var e;return!!((Os(n)??{}).hasFeaturedVideo&&((e=window.canPlayVideo)!=null&&e.call(window)))}function Xe(n){return!se(n)&&!!document.querySelector(Ls)}function Ds(){var n,i,e;return((i=(n=window.mw)==null?void 0:n.config)==null?void 0:i.get("wgArticleFeaturedVideo"))??((e=window.RLCONF)==null?void 0:e.wgArticleFeaturedVideo)??null}function Os(n){var i;return n??((i=window.ads)==null?void 0:i.context.targeting)}const Bs=/^(?<prefix>sse-)(?<experimentString>.+)$/;function _i(){const n=document.documentElement.classList;for(const i of n){const e=i.toLowerCase().match(Bs);if(e&&e.groups)return e.groups.experimentString}}function xs(){const n=_i();if(n){const i=Ai(n);if(i)return i}}const Ms=/^(?<team>[a-zA-Z]+)-(?<ticketId>[0-9]+)-(?<mode>variant|control)-?(?<variant>[1-6])?$/;function Ai(n){const i=n.toLowerCase().match(Ms);if(i&&i.groups){let e=`${i.groups.mode}`;return i.groups.variant&&(e=`${e}${i.groups.variant}`),{name:`${i.groups.team}-${i.groups.ticketId}`,group:e}}}function Us(){var n,i;return((i=(n=window.fandomHost)==null?void 0:n.browser)==null?void 0:i.split(" ")[0])??""}function Re(n=window.fandomContext??null){var i;return((i=n==null?void 0:n.user)==null?void 0:i.userState)??st}class Vs extends h{constructor(){super(...arguments);s(this,"name","PageLevelTargetingPlugin");s(this,"adEngine");s(this,"hooks",{onAdEngineInit:e=>{this.adEngine=e,this.api.setTargeting({labrador:this.adEngine.runtimeConfig.activeLabradorKeyValues})},onInitPageTargeting:e=>{const t=this.buildInitialPageTargeting();Object.assign(e,t)},onBiddersInit:e=>{this.setTargeting(e.gptWrapper),sr().then(()=>this.setTargeting(e.gptWrapper))},onBeforeFirstCallAdsRequest:e=>{const{ppid:t}=this.getTargetingFromFandomContextTracking();t&&e.updatePublisherProvidedId(t)},onAdEngineReset:()=>{const e=this.buildInitialPageTargeting();this.adEngine.gptWrapper.setTargeting(e)}});s(this,"api",{getAllTargeting:()=>{var e;return(e=this.adEngine)==null?void 0:e.gptWrapper.getAllTargeting()},setTargeting:e=>{var t;(t=this.adEngine)==null||t.gptWrapper.setTargeting(e)}})}getDebugState(){return structuredClone({targetingFromLegacy:this.getTargetingFromLegacyAdsContext(),targetingFromFandomContextSite:this.getTargetingFromFandomContextSite(),targetingFromFandomContextPage:this.getTargetingFromFandomContextPage()})}getRating({esrb:e=[],mpa:t=[]}){const r=[];for(const o of e)r.push(`esrb:${o}`);for(const o of t)r.push(`mpa:${o}`);return r}getS2PageType(e){const t=(e==null?void 0:e.pageType)??"article";if(t==="article"){if(se(e))return`wv-${t}`;if(Xe())return`${t}-ic`}return t}getTargetingFromLegacyAdsContext(){var r;const{targeting:e={},opts:t={}}=((r=window.ads)==null?void 0:r.context)??{};return{s2:this.getS2PageType(e),original_host:t.isGamepedia===!0?"gamepedia":"fandom"}}getTargetingFromFandomContextSite(){const e=F();if(!(e!=null&&e.site))return{};const{site:t}=e;if(Object.keys(t).length===0)return{};const r={},{categories:o,siteId:a,siteName:d="wikia",tags:l,directedAtChildren:u,taxonomy:f=[]}=t;return t.top1000&&(r.top="1k"),{...r,s0:f[0],s0c:o,s0v:f[1],s1:`_${d}`,siteId:a.toString(),kid_wiki:u?V:me,rating:this.getRating(l??{}),...l}}getTargetingFromFandomContextApp(){const e=F();if(!(e!=null&&e.app))return{};const{app:t}=e,{cdn:r}=t;return r?{cdn:r}:{}}getTargetingFromFandomContextPage(){const e=F();if(!(e!=null&&e.page))return{};const{page:t}=e;if(Object.keys(t).length===0)return{};const{articleId:r,pageName:o,pageType:a,pageId:d,lang:l,wordCount:u}=t;return{artid:String(r),lang:l,pageId:d.toString(),pageName:o,pageType:a,tier:Jt(e).toString(),word_count:String(u),wpage:o==null?void 0:o.toLowerCase()}}getTargetingFromFandomContextTracking(){const e=F();if(!(e!=null&&e.tracking))return{};const{tracking:t}=e,r={};return t.pvNumber!==void 0&&(r.pv=t.pvNumber.toString()),t.pvNumberGlobal!==void 0&&(r.pvg=t.pvNumberGlobal.toString()),t.pvUID!==void 0&&(r.pvuid=t.pvUID),t.ppid!==void 0&&(r.ppid=t.ppid),r}getTargetingFromFandomContextTargeting(){const e=F();if(!(e!=null&&e.targeting))return{};const{adGroup:t,...r}=e.targeting,o={...r};return t!==void 0&&(o.adGroup=t.split(",")),o}getTargetingFromFandomContextUser(){return{userState:Re()}}getTargetingFromFandomContext(){return{...this.getTargetingFromFandomContextApp(),...this.getTargetingFromFandomContextPage(),...this.getTargetingFromFandomContextSite(),...this.getTargetingFromFandomContextTracking(),...this.getTargetingFromFandomContextTargeting(),...this.getTargetingFromFandomContextUser()}}getTargetingFromFandomAds(){return{reset_count:`${Hi()}`}}getExperimentGroups(){const e=_i();return e?[e]:[]}getTargetingFromFandomHost(){var t,r,o;const e=fe();return{device:((t=window.fandomHost)==null?void 0:t.device)??"desktop",geo:((o=(r=window.fandomHost)==null?void 0:r.geo)==null?void 0:o.country)??"none",is_mobile:e?V:me,skin:`ucp_${e?"mobile":"desktop"}`,browser:Us()}}setTargeting(e){const t={...this.getTargetingFromFandomContextTracking(),...this.getTargetingFromFandomContextTargeting()};e.setTargeting(t)}buildInitialPageTargeting(){return{...{odyssey:["1",`1_${or()}`],odyssey_version:Gt(),odyssey_takeover:Mr,product:"fandom",uap:"none",uap_c:"none",dmn:$t().replace(/\./g,""),hostpre:Mi()??void 0,exp_bucket:jt(),experiment_groups:this.getExperimentGroups()},...this.getTargetingFromFandomContext(),...this.getTargetingFromFandomHost(),...this.getTargetingFromLegacyAdsContext(),...this.getTargetingFromFandomAds()}}}class Ws extends h{constructor(){super(...arguments);s(this,"name","PerformanceTestPlugin");s(this,"hooks",{onBeforeFirstCallAdsRequest(e){e.addEventListener("slotRenderEnded",t=>{t.slot.getSlotElementId()==="top_leaderboard"&&performance.mark("top_leaderboard_rendered")})}})}}function zs(n){return n.offsetTop>=window.innerHeight}const He={fandomdesktop:".mw-parser-output",fandommobile:".mw-parser-output",default:"#content"};function Hs(n){return n?He[n]??He.default:He.default}const Lt=970;class Gs extends h{constructor(e){super(e);s(this,"name","RepeatableSlotsPlugin");s(this,"contentWidth");s(this,"hooks",{onAfterAdNodeManagerInit:e=>{var r;const{baseSlots:t}=e.getSlotConfigMap();for(const o of Object.values(t))(r=o==null?void 0:o.dynamic)!=null&&r.repeat&&this.createAdNodesForBaseSlot(o,o.dynamic.repeat)}});this.contentWidth=this.calculateContentWidth()}getDebugState(){return{contentWidth:this.contentWidth,maxIncontentAdWidth:Lt}}calculateContentWidth(){const e=document.querySelector(Hs(pe()));return e?e.clientWidth:Lt}shouldPlaceSlotOnAnchor(e,t,r){const{minDistanceBetweenAds:o=1}=r;if(!zs(e)||e.offsetWidth<this.contentWidth)return!1;const a=window.innerHeight;if(t!==null&&o>0){const d=a*o,l=t.offsetTop+d;if(e.offsetTop<l)return!1}return!0}getAnchors(e){const t=[...document.querySelectorAll(e.selector)],r=(e==null?void 0:e.startAtSelectorIndex)??0;let o=null;return t.filter((d,l)=>{if(this.shouldPlaceSlotOnAnchor(d,o,e)&&l>=r)return o=d,!0})}createAdNodesForBaseSlot(e,t){const r=document.createElement("div");r.classList.add(e.name,S.WRAPPER_CLASS);const o=this.getAnchors(t),a=Math.min(t.max??Number.MAX_SAFE_INTEGER,o.length);for(let d=0;d<a;d++){const l=`${e.name}_${d+1}`,u=o[d],f=r.cloneNode(),A=document.createElement(S.ELEMENT_NAME);A.id=l,f.appendChild(A),u[t.insertMethod](f)}}}class qs{constructor(i,e){s(this,"refreshStatus");s(this,"nextRefreshTime");s(this,"refreshTimerRef");s(this,"slotVisibilityChangedEventListenerUnsubscribe");this.adNode=i,this.refreshTimeoutMS=e,this.refreshStatus="disabled",this.init()}init(){var i;this.clearTimer(),this.unsubscribeFromSlotVisibilityChangedEventListener(),this.refreshStatus=(i=this.refreshConfig)!=null&&i.enabled?"enabled":"disabled"}onRefreshScheduled(i){this.clearTimer(),this.refreshTimerRef=i,this.nextRefreshTime=new Date(Date.now()+this.refreshTimeoutMS),this.refreshStatus="scheduled"}onSlotVisibilityChangedEventListenerSubscribed(i){this.refreshStatus="out-of-view",this.clearTimer(),this.unsubscribeFromSlotVisibilityChangedEventListener(),this.slotVisibilityChangedEventListenerUnsubscribe=i}onSlotVisible(){this.unsubscribeFromSlotVisibilityChangedEventListener()}onRequestRender(){this.refreshStatus="refreshing",this.clearTimer()}onAdNodeRemoved(){this.clearTimer(),this.unsubscribeFromSlotVisibilityChangedEventListener(),this.refreshStatus="disabled"}onSlotRenderEnded(){var i;this.refreshStatus=(i=this.refreshConfig)!=null&&i.enabled?"enabled":"disabled"}getDebugState(){const i={status:this.refreshStatus};return this.nextRefreshTime&&(i.nextRefreshTime=this.nextRefreshTime,i.secondsUntilNextRefresh=this.nextRefreshTime.getTime()-Date.now()),i.config=this.refreshConfig,i}get refreshConfig(){return this.adNode.getSlotConfig().refresh}clearTimer(){this.refreshTimerRef&&clearTimeout(this.refreshTimerRef),this.refreshTimerRef=void 0,this.nextRefreshTime=void 0}unsubscribeFromSlotVisibilityChangedEventListener(){var i;(i=this.slotVisibilityChangedEventListenerUnsubscribe)==null||i.call(this),this.slotVisibilityChangedEventListenerUnsubscribe=()=>{}}}const ge=class ge extends h{constructor(e,t){super(e);s(this,"name","SlotRefresherPlugin");s(this,"active",!0);s(this,"refreshTimeoutMS",ge.DEFAULT_REFRESH_TIMEOUT_MS);s(this,"adEngine");s(this,"adNodeRefreshers");s(this,"hooks",{onAdEngineInit:e=>{this.adEngine=e,e.gptWrapper.addEventListener("impressionViewable",t=>{this.scheduleRefresh(t.slot,e)}),e.gptWrapper.addEventListener("slotRenderEnded",t=>{var r;(r=this.adNodeRefreshers.get(t.slot.getSlotElementId()))==null||r.onSlotRenderEnded()})},onAdNodeCreated:e=>{this.adNodeRefreshers.set(e.getSlotName(),new qs(e,this.refreshTimeoutMS))},onAdNodeRemoved:e=>{const t=this.adNodeRefreshers.get(e.getSlotName());t==null||t.onAdNodeRemoved(),this.adNodeRefreshers.delete(e.getSlotName())},onAdEngineReset:()=>{this.active=!0;for(const e of this.adNodeRefreshers.values())e.init()}});s(this,"api",{stop:()=>{this.active=!1},stopSlot:e=>{var r;const t=(r=this.adEngine)==null?void 0:r.adNodeManager.getAdNodeByName(e);E(t,`AdNode for slot ${e} not found`),t.block()}});this.instantConfig=t,this.adNodeRefreshers=new Map,this.refreshTimeoutMS=this.instantConfig.icRefreshTimeoutMS??ge.DEFAULT_REFRESH_TIMEOUT_MS}refreshWhenBackInViewport(e,t){var a;const r=e.getSlotName(),o=t.gptWrapper.addSlotEventListener(r,"slotVisibilityChanged",d=>{var l,u;d.inViewPercentage>=50&&((l=this.adNodeRefreshers.get(r))==null||l.onSlotVisible(),this.active&&(t.adRenderManager.requestRender([e]),(u=this.adNodeRefreshers.get(r))==null||u.onRequestRender()))});(a=this.adNodeRefreshers.get(r))==null||a.onSlotVisibilityChangedEventListenerSubscribed(o)}refreshOrAddListener(e,t){var r;this.active&&(e.isInViewport()?(t.adRenderManager.requestRender([e]),(r=this.adNodeRefreshers.get(e.getSlotName()))==null||r.onRequestRender()):this.refreshWhenBackInViewport(e,t))}scheduleRefresh(e,t){var d;const r=e.getSlotElementId(),o=t.adNodeManager.getAdNodeByName(r);E(o,`Cannot schedule refresh. AdNode for slot ${r} not found`);const a=window.setTimeout(()=>{o.isRefreshable()&&this.refreshOrAddListener(o,t)},this.refreshTimeoutMS);(d=this.adNodeRefreshers.get(r))==null||d.onRefreshScheduled(a)}getDebugState(){const e={refreshActive:this.active,refreshTimeoutMS:this.refreshTimeoutMS,adNodes:{}};for(const[t,r]of this.adNodeRefreshers.entries())e.adNodes[t]=r.getDebugState();return e}};s(ge,"DEFAULT_REFRESH_TIMEOUT_MS",3e4);let be=ge;const $s={cache:{url:"https://prebid-server.rubiconproject.com/cache",ignoreBidderCacheKey:!0},s2sConfig:[]},js={enabled:!0,accountId:"7450",bidders:["mgnipbs"],defaultVendor:"rubicon",coopSync:!0,userSyncLimit:8,defaultTTL:300,timeout:500,allowUnknownBidderCodes:!0,extPrebid:{cache:{vastxml:{returnCreative:!1}},bidders:{mgnipbs:{wrappername:"7450_Web_Server"}}}};class Ks extends h{constructor(e,t){super(e);s(this,"name","ServerToServerPlugin");s(this,"hooks",{onBiddersInit:()=>{if(this.instantConfig.icPrebidMagniteS2s){const e=this.usePlugin(I);e==null||e.addPrebidReadyCallback(t=>{t.setConfig($s)}),e==null||e.addPrebidReadyCallback(t=>{t.mergeConfig({s2sConfig:[js]})})}}});this.instantConfig=t}static isEnabled(e,t){return!!t.icPrebidMagniteS2s&&super.isEnabled(e,t)}}const H="top_leaderboard",Je={DESKTOP:[3,3],MAX:[3,3],MOBILE:[2,2]},Ys=250;function Qs(n){if(n.size===null||typeof n.size=="string")return!1;if(Array.isArray(n.size)&&n.size.length>=2){const[i,e]=n.size;return Ke([i,e],Je.DESKTOP)||Ke([i,e],Je.MOBILE)}return!1}function Xs(n,i){if(n==="fandomdesktop")return P(async()=>{const{TopBoxadHandler:e}=await import("./TopBoxadHandler-D3AHPWmH.js");return{TopBoxadHandler:e}},[]).then(({TopBoxadHandler:e})=>{new e().applySticky(i)}).catch(e=>{g({code:Zi,message:"Failed to load TopBoxadHandler",error:e,priority:c.P4})})}const Fe=class Fe extends h{constructor(){super(...arguments);s(this,"name","InContentLeaderboardPlugin");s(this,"adEngine");s(this,"adNodes",[]);s(this,"blockedSlots",new Set);s(this,"hooks",{onAdEngineInit:e=>{this.adEngine=e,this.adNodes=this.adEngine.adNodeManager.getAdNodesByBaseName(Fe.IN_CONTENT_LEADERBOARD_BASE_SLOT_NAME),this.api.block(0)}});s(this,"api",{block:e=>{var r;const t=this.getAdNodes(e);try{E((r=this.adEngine)==null?void 0:r.adNodeManager,"adNodeManager is not defined");for(const o of t)this.blockSlot(o)}catch(o){g({code:nn,message:"Could not block slots",error:o,priority:c.P3})}},unblock:e=>{var r;const t=this.getAdNodes(e);try{E((r=this.adEngine)==null?void 0:r.adNodeManager,"adNodeManager is not defined");for(const o of t)this.unblockSlot(o)}catch(o){g({code:rn,message:"Could not unblock slots",error:o,priority:c.P3})}}})}getDebugState(){return{incontentLeaderboardSlots:this.adNodes.map(e=>e.getSlotName()),blockedSlots:Array.from(this.blockedSlots)}}getAdNodes(e){return e===void 0?this.adNodes:e<0||e>=this.adNodes.length?[]:[this.adNodes[e]]}blockSlot(e){var r;(r=this.adEngine)==null||r.adNodeManager.blockSlot(e.getSlotName()),this.blockedSlots.add(e.getSlotName());const t=e.getElement();t&&(t.style.display="none")}unblockSlot(e){var r;(r=this.adEngine)==null||r.adNodeManager.unblockSlot(e.getSlotName()),this.blockedSlots.delete(e.getSlotName());const t=e.getElement();t&&(t.style.display="")}};s(Fe,"IN_CONTENT_LEADERBOARD_BASE_SLOT_NAME","incontent_leaderboard");let Pe=Fe;class Ti extends h{constructor(){super(...arguments);s(this,"name","InContentPlayerPlugin");s(this,"hasFiredInContentVideoInitCallback",!1);s(this,"initOnceEventSubscriber",new Qe(1));s(this,"api",{initOnce:()=>{this.hasFiredInContentVideoInitCallback||(this.hasFiredInContentVideoInitCallback=!0,this.initOnceEventSubscriber.notify())},reject:()=>{const e=this.usePlugin(Pe);e==null||e.unblock(0)},registerInContentPlayerInitCallback:e=>{this.initOnceEventSubscriber.subscribe(e)}})}getDebugState(){return{hasInContentVideoInitCallbackFired:this.hasFiredInContentVideoInitCallback}}}const Js=1e10;function Zs(){return Math.floor(Math.random()*Js)+1}function ea(){return["output=xml_vast4","env=vp","gdfp_req=1","impl=s","unviewed_position_start=1",`url=${encodeURIComponent(window.location.href)}`,`description_url=${encodeURIComponent(window.location.href)}`,`correlator=${Zs()}`]}function ta(){var i,e;const n=(e=(i=F())==null?void 0:i.tracking)==null?void 0:e.ppid;return n?[`ppid=${n}`]:[]}function ia(n){const i=Oe(n.getSizes());return i.length>0?i.join("|"):"640x480"}function na(n){window.ads&&n&&(window.ads.runtime=window.ads.runtime??{},window.ads.runtime.video={adUnit:n})}const ra="https://pubads.g.doubleclick.net/gampad/ads?";class Ze extends h{constructor(e,t){super(e);s(this,"name","VastUrlPlugin");s(this,"consentData");s(this,"resolvedState",Promise.withResolvers());s(this,"isIcvAlreadyCreated",!1);s(this,"adEngine");s(this,"api",{get:async(e="featured",t)=>{const r=this.getAdNode(e)??this.createFeaturedAdNode();return r?(await this.requestBids(r),`${ra}${this.getParams(t,r).join("&")}`):""},getAdUnitPath:(e="incontent_player")=>{const t=this.getAdNode(e)??this.createIncontentAdNode();return(t==null?void 0:t.getAdUnitPath())??""},getTargetingParams:async(e="featured",t)=>{const r=this.getAdNode(e);return r?(await this.requestBids(r),this.buildCustomParams(t,r)):""},getPageTargeting:()=>{var e;return this.createIncontentAdNode(),((e=this.adEngine)==null?void 0:e.gptWrapper.getAllTargeting({raw:!1}))??{}},getSlotTargeting:e=>{var t;return this.createIncontentAdNode(),((t=this.adEngine)==null?void 0:t.gptWrapper.getAllSlotTargeting(e,{raw:!1}))??{}},setAdUnitRuntimeVariable:(e="incontent_player")=>{const t=this.api.getAdUnitPath(e)??"";na(t)},unblockVideo:()=>{this.resolvedState.resolve()}});s(this,"hooks",{onConsentUpdated:e=>{this.consentData=e},onAfterAdNodeManagerInit:()=>{this.instantConfig.icUAPJWPlayer||this.api.unblockVideo()},onAdEngineInit:e=>{this.adEngine=e}});this.instantConfig=t}getDebugState(){return{hasFeaturedVideo:se(),hasIncontentPlayer:Xe()}}createFeaturedAdNode(){var e,t;if(se()&&((e=document.getElementById("featured"))==null?void 0:e.tagName)!==L.ELEMENT_NAME.toUpperCase())return(t=this.adEngine)==null?void 0:t.adNodeManager.createAdNode("featured")}createIncontentAdNode(){var e,t;if(Xe()&&!this.isIcvAlreadyCreated&&((e=document.getElementById("incontent_player"))==null?void 0:e.tagName)!==L.ELEMENT_NAME.toUpperCase())return this.isIcvAlreadyCreated=!0,(t=this.adEngine)==null?void 0:t.adNodeManager.createAdNode("incontent_player")}getParams(e,t){return[...ea(),...ta(),...this.getPrivacyParams(),...this.getSlotParams(t),...this.getCustomParams(e,t),...this.getVideoParams()].filter(Boolean)}getSlotParams(e){const t=e.getAdUnitPath(),r=ia(e);return[`iu=${t}`,`sz=${r}`]}getPrivacyParams(){const{coppa:e,consentApi:t,consentString:r=""}=this.consentData??{},o=[];return t==="usp"?o.push(`us_privacy=${r}`,"gdpr=0"):t==="tcf"&&o.push(`gdpr_consent=${r}`,"gdpr=1"),e===!0&&o.push("tfcd=1"),o}buildCustomParams(e,t){const r=(t==null?void 0:t.getAllTargeting())??{},o=Object.entries(r).map(([l,u])=>`${l}=${u.join(",")}`).join("&"),a=this.getPageTargetingParams();return[`player=${this.getVideoPlayer(e)}`,"rv=1",o,...a,...this.getUAPParams()].filter(Boolean).join("&")}getCustomParams(e,t){const r=this.buildCustomParams(e,t);return[`cust_params=${encodeURIComponent(r)}`]}getPageTargetingParams(){var t;const e=((t=this.adEngine)==null?void 0:t.gptWrapper.getAllTargeting({raw:!1}))??{};return Object.entries(e).map(([r,o])=>`${r}=${o}`)}getVideoPlayer(e){return e??(this.instantConfig.icFeaturedVideoPlayer==="Connatix"?"cnx":"jwp")}getVideoParams(){return[`vpos=${this.getPosition()}`]}getUAPParams(){var r,o,a,d;const e=(o=(r=this.adEngine)==null?void 0:r.gptWrapper)==null?void 0:o.getTargeting("uap"),t=(d=(a=this.adEngine)==null?void 0:a.gptWrapper)==null?void 0:d.getTargeting("uap_c");return e&&t?[`uap=${e[0]}`,`uap_c=${t[0]}`]:[]}getPosition(){return"preroll"}waitForResolvedState(){return this.resolvedState.promise}getAdNode(e){var t;return(t=this.adEngine)==null?void 0:t.adNodeManager.getAdNodeByName(e)}async requestBids(e){var t;e.incrementRenderCount(),await((t=this.adEngine)==null?void 0:t.adRenderManager.requestBids([e])),await this.waitForResolvedState()}}class oa{constructor(){s(this,"activating",!1);s(this,"feature");s(this,"killDeactivation",!1);s(this,"onRemoveStickinessCallback")}activate(i){this.activating||this.feature||(this.activating=!0,P(async()=>{const{StickyFeature:e}=await import("./StickyFeature-DxSbHdth.js");return{StickyFeature:e}},[]).then(({StickyFeature:e})=>{this.feature=new e,this.feature.activate(i),this.activating=!1,this.onRemoveStickinessCallback&&this.feature.onRemoveStickiness(this.onRemoveStickinessCallback)}).catch(()=>{throw this.activating=!1,new Error("Failed to load StickyFeature")}))}addOnRemoveStickiness(i){if(!this.feature){this.onRemoveStickinessCallback=i;return}this.feature.onRemoveStickiness(i)}deactivate(){if(this.killDeactivation){this.killDeactivation=!1;return}if(!this.feature){setTimeout(()=>{this.deactivate()},100);return}this.feature.removeStickiness({forcedByDeactivation:!0})}reactivate(i,e){if(this.killDeactivation=!0,!this.feature){this.activate({...i,disableAutoUnstick:e});return}this.feature.activate({...i,disableAutoUnstick:e})}reset(){this.feature&&this.feature.removeStickiness({forcedByDeactivation:!0})}}class sa{constructor(i){s(this,"activating",!1);s(this,"feature");this.topStrategyTunerPlugin=i}activate(i,e){this.activating||this.feature||(this.activating=!0,P(async()=>{const{SkyboxFeature:t}=await import("./SkyboxFeature-sS0Ka0As.js");return{SkyboxFeature:t}},[]).then(({SkyboxFeature:t})=>{this.feature=new t,this.feature.activate(this.topStrategyTunerPlugin,i,e),this.activating=!1}).catch(()=>{throw this.activating=!1,new Error("Failed to load SkyboxFeature")}))}moveToResolvedState(i){this.feature&&(this.feature.isStateResolved()||this.feature.makeStateResolved(i))}onSkyboxStateResolved(i){this.feature&&this.feature.onSkyboxStateResolved(i)}onSkyboxRender(i){const e=(i==null?void 0:i.getRenderCount())??-1;i&&e>1&&this.feature&&this.feature.reset(i)}reset(){var i;this.feature&&((i=this.feature)==null||i.reset())}}class aa{constructor(i){s(this,"activating",!1);s(this,"feature");this.adNodeManager=i}activate(i){this.activating||this.feature||(this.activating=!0,P(async()=>{const{SlotManagerFeature:e}=await import("./SlotManagerFeature-SVdkR6ey.js");return{SlotManagerFeature:e}},[]).then(({SlotManagerFeature:e})=>{this.feature=new e(this.adNodeManager),this.feature.activate(i.enabledSlots??[]),this.activating=!1}).catch(()=>{throw this.activating=!1,new Error("Failed to load SlotManagerFeature")}))}}class da{constructor(){s(this,"activating",!1);s(this,"feature")}activate(i,e){this.activating||this.feature||(this.activating=!0,P(async()=>{const{VideoBannerFeature:t}=await import("./VideoBannerFeature-CfBEMTbh.js");return{VideoBannerFeature:t}},[]).then(({VideoBannerFeature:t})=>{this.feature=new t,this.feature.activate(i,e),this.activating=!1}).catch(()=>{throw this.activating=!1,new Error("Failed to load VideoBannerFeature")}))}stopVideoOnOutOfViewport(){this.feature&&this.feature.stopVideoOnOutOfViewport()}reset(){this.feature&&this.feature.reset()}}function Dt(n){return n?n.toString():"none"}const yi=/(opera|chrome|safari|firefox|msie|trident(?=\/))/i;function Ii(){const n=navigator.userAgent.match(yi);return n!==null&&n[1]==="Chrome"}function la(){const n=navigator.userAgent.match(yi);return n!==null&&n[1].toLowerCase()==="safari"&&!Ii()}function ca(){var n;la()&&(requestAnimationFrame(()=>{const i=document.body.style.display;document.body.style.display="inline-block",document.body.offsetHeight,document.body.style.display=i}),(n=document.querySelector(".skybox-top video"))==null||n.pause())}class ua extends h{constructor(e,t,r){super(e);s(this,"name","TopStrategyTunerPlugin");s(this,"adNodeManager");s(this,"gpt");s(this,"defaultStickyTlbPromiseResolver",()=>{});s(this,"defaultStickyTlbPromiseRejecter",()=>{});s(this,"featuresFlags",{skyboxResolved:!1});s(this,"defaultStickyTlbApplied",!1);s(this,"stickyActivator");s(this,"skyboxActivator");s(this,"slotManagerActivator");s(this,"videoFeatureActivator");s(this,"tentpoleActivator",Promise.withResolvers());s(this,"onTlbLoadedCallbacks",[]);s(this,"hasFanTakeoverLoaded",null);s(this,"api",{activate:async e=>{var t;e.slotName??(e.slotName=H),this.defaultStickyTlbPromiseRejecter(),e.skybox&&e.takeover&&((t=this.usePlugin(be))==null||t.stop()),this.activateTentpoleFeature(e),this.activateStickyFeature(e),this.activateSlotManagerFeature(e),this.activateSkyboxFeature(e),this.activateVideoFeature(e)},onRemoveStickiness:e=>{var t;(t=this.stickyActivator)==null||t.addOnRemoveStickiness(e)},onSkyboxStateResolved:e=>{var t;(t=this.skyboxActivator)==null||t.onSkyboxStateResolved(e)},onTlbLoaded:e=>{this.onTlbLoadedCallbacks.push(e)}});s(this,"hooks",{onAfterAdNodeManagerInit:e=>{var t;this.adNodeManager=e,se()&&((t=this.adNodeManager.getAdNodeByName(H))==null||t.removeSizes(Je.MAX,le.LESS_THAN_OR_EQUAL))},onAfterGptWrapperInit:e=>{this.gpt=e,this.activateOrUnblockProperPluginOnDefaultTopSlotRender(e),this.handleDefaultTopLeaderboardFirstImpression(e)},onAdEngineReset:()=>{this.resetActivators(),this.resetState()}});this.instantConfig=t,this.defaultStickyTlbPromise=r,this.defaultStickyTlbPromise??(this.defaultStickyTlbPromise=new Promise((o,a)=>{this.defaultStickyTlbPromiseResolver=o,this.defaultStickyTlbPromiseRejecter=a})),document.body.classList.add("odyssey","odyssey-top-strategy")}getDebugState(){return{isSkyboxResolved:this.featuresFlags.skyboxResolved,hasFanTakeoverLoaded:this.hasFanTakeoverLoaded,isDefaultStickyTlbApplied:this.defaultStickyTlbApplied,hasStickyActivator:!!this.stickyActivator,hasSkyboxActivator:!!this.skyboxActivator,hasSlotManagerActivator:!!this.slotManagerActivator,hasVideoBannerActivator:!!this.videoFeatureActivator,onTlbLoadedCallbacksCount:this.onTlbLoadedCallbacks.length}}activateStickyFeature(e){!e.sticky&&this.defaultStickyTlbApplied||(this.stickyActivator??(this.stickyActivator=new oa),this.stickyActivator.activate(e))}activateSkyboxFeature(e){var t;e.skybox&&(this.skyboxActivator??(this.skyboxActivator=new sa(this)),(t=this.stickyActivator)==null||t.deactivate(),this.skyboxActivator.activate(e,()=>{var r;this.featuresFlags.skyboxResolved=!0,(r=this.stickyActivator)==null||r.reactivate(e,!fe()),ca()}),this.onTlbLoadedCallbacks.forEach(r=>r(!0)))}activateSlotManagerFeature(e){var r;if(!e.takeover||!((r=e.enabledSlots)!=null&&r.length))return;const t=pe();t===qe.METACRITIC||t===qe.TVGUIDE||(this.slotManagerActivator=new aa(this.adNodeManager),this.slotManagerActivator.activate({enabledSlots:e.enabledSlots}))}activateTentpoleFeature(e){var r,o,a;if(typeof e.tentpole!="object"){this.tentpoleActivator.resolve();return}const{tentpole:t}=e;this.gpt&&(this.gpt.setTargeting("uap",Dt(t==null?void 0:t.lineItemId)),this.gpt.setTargeting("uap_c",Dt(t==null?void 0:t.creativeId))),(r=this.usePlugin(be))==null||r.stop(),(o=this.usePlugin(Ze))==null||o.unblockVideo(),this.unblockVideoAds(),(a=this.usePlugin(Ei))==null||a.activateTentpole(),Xs(pe(),this)}activateOrUnblockProperPluginOnDefaultTopSlotRender(e){e.addSlotEventListener(H,"slotRenderEnded",async t=>{var r,o;if(this.handleUnblockVideoOnDefaultSlotRender(),this.skyboxActivator){const a=(r=this.adNodeManager)==null?void 0:r.getAdNodeByName(H);this.skyboxActivator.onSkyboxRender(a);return}if(!fe()){if(!this.instantConfig.icForceStickyTlb&&t.isEmpty)return;(o=this.defaultStickyTlbPromise)==null||o.then(()=>{this.defaultStickyTlbApplied=!0,this.activateStickyFeature({id:"unknown",slotName:H,sticky:!0})}),setTimeout(()=>{this.defaultStickyTlbPromiseResolver()},100)}this.handleInContentVideo(t)})}handleDefaultTopLeaderboardFirstImpression(e){e.addSlotEventListener(H,"impressionViewable",()=>{var r,o;if(this.skyboxActivator)return;((o=(r=this.adNodeManager)==null?void 0:r.getAdNodeByName(H))==null?void 0:o.getRenderCount())===1&&this.onTlbLoadedCallbacks.forEach(a=>a(!1))})}handleUnblockVideoOnDefaultSlotRender(){const e=()=>{var t;(t=this.usePlugin(Ze))==null||t.unblockVideo(),this.unblockVideoAds()};Q(this.tentpoleActivator.promise,Ys).then(e,e)}handleInContentVideo(e){this.hasFanTakeoverLoaded=Qs(e);const t=this.usePlugin(Ti);!this.hasFanTakeoverLoaded&&!se()?t==null||t.initOnce():t==null||t.reject()}activateVideoFeature(e){var t;e.videoUrl&&(this.videoFeatureActivator??(this.videoFeatureActivator=new da),this.videoFeatureActivator.activate(e,()=>{var r;(r=this.skyboxActivator)==null||r.moveToResolvedState(e)}),(t=this.stickyActivator)==null||t.addOnRemoveStickiness(()=>{var r;(r=this.videoFeatureActivator)==null||r.stopVideoOnOutOfViewport()}))}resetActivators(){var e,t,r;(e=this.stickyActivator)==null||e.reset(),(t=this.skyboxActivator)==null||t.reset(),(r=this.videoFeatureActivator)==null||r.reset()}resetState(){this.featuresFlags.skyboxResolved=!1,this.defaultStickyTlbApplied=!1,this.hasFanTakeoverLoaded=null,this.onTlbLoadedCallbacks.length=0}unblockVideoAds(){const e=document.getElementsByTagName(L.ELEMENT_NAME);for(const t of e)t instanceof L&&t.unblockVideo()}}class ga extends h{constructor(e,t){super(e);s(this,"name","LightboxLeaderboardPlugin");s(this,"adEngine");s(this,"refreshLock",!1);s(this,"slotExpanded",!1);s(this,"galleryLeaderboard",null);s(this,"lightboxLeaderboardAdNode");s(this,"hooks",{onAdEngineInit:e=>{this.adEngine=e},onAdNodeCreated:e=>{this.lightboxLeaderboardAdNode=e}});s(this,"api",{onLightboxOpen:e=>{this.galleryLeaderboard=document.querySelector(".gallery-leaderboard"),this.galleryLeaderboard&&this.renderOrRefreshAd(e)},onLightboxClose:()=>{this.galleryLeaderboard=null,this.toggleFloorAdhesion(!1)},onLightboxChange:e=>{this.renderOrRefreshAd(e)}});this.instantConfig=t}getDebugState(){return{isRefreshLocked:this.refreshLock,isSlotExpanded:this.slotExpanded,hasGalleryLeaderboard:!!this.galleryLeaderboard,hasLightboxLeaderboardAdNode:!!this.lightboxLeaderboardAdNode}}setRefreshLock(e=2e3){this.refreshLock=!0,setTimeout(()=>{this.refreshLock=!1},e)}waitForFloorWrapper(e){const t=document.getElementById("floor_adhesion_wrapper");if(t){e(t);return}const r=new MutationObserver(()=>{const o=document.getElementById("floor_adhesion_wrapper");o&&(r.disconnect(),e(o))});r.observe(document.body,{childList:!0,subtree:!0})}toggleFloorAdhesion(e){this.waitForFloorWrapper(t=>{t.classList.toggle("hide-under-lightbox",e)})}getOrCreateLightboxLeaderboard(){var t;if(!this.galleryLeaderboard)return null;let e=document.getElementById("lightbox_leaderboard");return e||(e=document.createElement(S.ELEMENT_NAME),e.id="lightbox_leaderboard",this.galleryLeaderboard.classList.add(S.WRAPPER_CLASS),this.galleryLeaderboard.prepend(e),this.lightboxLeaderboardAdNode=(t=this.adEngine)==null?void 0:t.adNodeManager.getAdNodeByName("lightbox_leaderboard")),e}handleShowingAdSlot(){var r;const e=this.getOrCreateLightboxLeaderboard();if(!e)return;this.toggleFloorAdhesion(!0),(r=e.parentElement)==null||r.classList.remove("is-loading");const t=document==null?void 0:document.getElementsByClassName("lightbox-wrapper-inner")[0];t&&!t.classList.contains("with-ad")&&t.classList.add("with-ad"),this.expandSlot(),this.bidAndRefreshLightboxLeaderboardAdNode()}handleHidingAdSlot(){var r;if(!this.getOrCreateLightboxLeaderboard())return;const t=document==null?void 0:document.getElementsByClassName("lightbox-wrapper-inner")[0];(r=t==null?void 0:t.classList)==null||r.remove("with-ad"),this.collapseSlot()}collapseSlot(){var t;if(!this.slotExpanded)return;const e=(t=this.lightboxLeaderboardAdNode)==null?void 0:t.getElement();e&&(e.style.height="0px",e.parentElement&&(e.parentElement.style.display="none")),this.slotExpanded=!1}expandSlot(){var t;if(this.slotExpanded)return;const e=(t=this.lightboxLeaderboardAdNode)==null?void 0:t.getElement();e&&(e.style.height="",e.parentElement&&(e.parentElement.style.display="")),this.slotExpanded=!0}renderOrRefreshAd(e){var t;if(this.instantConfig.icLightboxLeaderboardEnabled&&((t=this.adEngine)==null?void 0:t.monetizationTierEngine.getCurrentTier())===T.TIER_3)if(e){if(this.refreshLock)return;this.handleShowingAdSlot()}else this.handleHidingAdSlot()}async bidAndRefreshLightboxLeaderboardAdNode(){var e;this.setRefreshLock(),this.lightboxLeaderboardAdNode&&((e=this.adEngine)==null||e.adRenderManager.requestRender([this.lightboxLeaderboardAdNode],!0))}}class ha extends h{constructor(){super(...arguments);s(this,"name","LotamePlugin");s(this,"CLIENT_ID",17364);s(this,"PIXEL_URL",`https://tags.crwdcntrl.net/lt/c/${this.CLIENT_ID}/lt.min.js`);s(this,"isLoaded",!1);s(this,"TAXONOMY_TAGS_TO_KEEP",["gnre","media","pform","pub","theme","tv"]);s(this,"hooks",{onConsentUpdated:e=>{w(e)&&this.init()},onAdEngineReset:()=>{var o;if(!this.isLoaded)return;const e=`lotame_${this.CLIENT_ID}`,t=window[e];if(!(t!=null&&t.page))return;const r=this.setupLotameTagInput();(o=t.cmd)==null||o.push(()=>{var a;(a=t.page)==null||a.call(t,r.data)})}})}getDebugState(){var e,t;return{isScriptLoaded:this.isLoaded,clientId:this.CLIENT_ID,hasFandomContext:!!((t=(e=F())==null?void 0:e.site)!=null&&t.tags)}}mapTaxonomyToLotameBehaviorTags(e={}){const t=[];for(const[r,o]of Object.entries(e))if(this.TAXONOMY_TAGS_TO_KEEP.includes(r))for(const a of o)t.push(`${r}: ${a}`);return t}setupLotameTagInput(){var r,o;const e=(o=(r=F())==null?void 0:r.site)==null?void 0:o.tags;return{data:{behaviors:{med:e?this.mapTaxonomyToLotameBehaviorTags(e):[]}},config:{clientId:this.CLIENT_ID}}}setupLotameNamespaceConfig(){const e=this.setupLotameTagInput(),t=`lotame_${this.CLIENT_ID}`,r=e.config??{},o=window[t]={};o.config=r,o.data=e.data??{},o.cmd=o.cmd??[],o.cmd.push(()=>{var a;(a=o.setUserConsent)==null||a.call(o,{lotameConsent:!0})})}async loadLotameScript(){this.setupLotameNamespaceConfig();try{await Ae("lotame",this.PIXEL_URL),this.isLoaded=!0}catch{}}static isEnabled(e,t){return!!t.icLotame&&super.isEnabled(e,t)}init(){this.isLoaded||this.loadLotameScript()}}class pa extends h{constructor(e){super(e);s(this,"name","ConfiantPlugin");s(this,"scriptDomain","cdn.confiant-integrations.net");s(this,"fallbackPropertyId","d-aIf3ibf0cYxCLB1HTWfBQOFEA");s(this,"propertyId");s(this,"isLoaded",!1);s(this,"trackBlock",(e,t,r,o,a,d)=>{if(d&&d.dfp){const l=d.dfp.s;console.debug(`Blocked ad on ${l}`)}});s(this,"hooks",{onConsentUpdated:e=>{w(e)&&this.init()}});this.propertyId=e.propertyId??this.fallbackPropertyId}getDebugState(){return{isScriptLoaded:this.isLoaded,propertyId:this.propertyId,scriptDomain:this.scriptDomain}}static isEnabled(e,t){return!!t.icConfiant&&super.isEnabled(e,t)}async loadConfiantScript(){const e=`//${this.scriptDomain}/${this.propertyId}/gpt_and_prebid/config.js`;try{await Ae("confiant",e),this.isLoaded=!0}catch{}}setupConfiantWindowObject(){window.confiant=window.confiant??{},window.confiant.callback=this.trackBlock}init(){this.isLoaded||(this.setupConfiantWindowObject(),this.loadConfiantScript())}}const ma=1,Ot={default:1187275693,v6_1:339079598},fa={default:"IntentIqObject",v6_1:"IntentIqObject61"};function ba(n){return{biddingPlatformId:ma,partnerAuctionId:n.auctionId,bidderCode:n.bidderCode,prebidAuctionId:n.auctionId,cpm:n.cpm,currency:n.currency}}function Sa(n){return`//script.wikia.nocookie.net/fandom-ae-assets/intentiq/${n}/IIQUniversalID.js`}function lt(n){return n==="v6.1"}function Ea(n){return fa[lt(n)?"v6_1":"default"]}function vi(n){return window[Ea(n)]}async function _a(n){await de(()=>vi(n)!==void 0,{maxTries:10,exponentialTimeout:10})}function Aa(n,i,e){const t=window.location.hostname.includes(".fandom.com")?"fandom.com":window.location.hostname;return lt(n)?{partner:Ot.v6_1,pbjs:e,timeoutInMillis:i,ABTestingConfigurationSource:"IIQServer",manualWinReportEnabled:!0,domainName:t,vrBrowserBlackList:["chrome"]}:{partner:Ot.default,pbjs:e,timeoutInMillis:i,ABTestingConfigurationSource:"percentage",abPercentage:97,manualWinReportEnabled:!0,domainName:t,vrBrowserBlackList:["chrome"]}}async function Ta(n,i,e){return new Promise(t=>{const r=new i({...n,callback:(o,a)=>{a??(a="U"),e(r,a),t()}})})}async function ya(n,i,e){return new Promise(t=>{var a,d;const r=new i({...n,callback:()=>{t()}}),o=((d=(a=r==null?void 0:r.intentIqConfig)==null?void 0:a.abTesting)==null?void 0:d.currentTestGroup)??"U";e(r,o)})}async function Ia(n,i,e,t){const r=Aa(n,i,e),o=vi(n);if(o)return lt(n)?Ta(r,o,t):ya(r,o,t)}const va=1e3;class Na extends h{constructor(e,t){super(e);s(this,"name","IntentIqPlugin");s(this,"consent",!1);s(this,"enabled",!1);s(this,"intentIqObject");s(this,"gptWrapper");s(this,"pbjs");s(this,"hooks",{onBiddersInit:()=>{var e;(e=this.usePlugin(I))==null||e.addPrebidReadyCallback(t=>{this.pbjs=t,this.initialize(this.pbjs)})},onConsentUpdated:e=>{this.consent=w(e),this.pbjs&&this.initialize(this.pbjs)},onAfterGptWrapperInit:e=>{this.gptWrapper=e},onAdEngineReset:()=>{!this.pbjs||!this.consent||this.reinitialize(this.pbjs)}});this.instantConfig=t}static isEnabled(e,t){return!Ii()&&!!t.icPrebidIntentIQ&&!!t.icPrebidIntentIQVersion&&!!t.icPrebidIntentIQTimeout&&super.isEnabled(e,t)}async initialize(e){if(this.enabled||!this.consent)return;await this.loadIntentIqLibrary(e);const t=({bid:r})=>{this.reportPrebidWin(r)};e.onEvent("adRenderSucceeded",t)}async configureIntentIq(e,t){try{await _a(this.instantConfig.icPrebidIntentIQVersion),await Ia(this.instantConfig.icPrebidIntentIQVersion,this.instantConfig.icPrebidIntentIQTimeout,e,(r,o)=>{this.enabled=!0,this.intentIqObject=r,this.setTargeting(o),t&&p(y,{type:_.VENDOR_TIME_UPDATE,eventName:"intentiq_loaded",time:performance.now()})})}catch(r){t&&p(y,{type:_.VENDOR_TIME_UPDATE,eventName:"intentiq_error_loading",time:performance.now()}),g({code:ji,message:t?"Failed to get intent Iq object instance":"Failed to re-initialize IntentIQ object instance on reset",priority:c.P3,error:r})}}async reinitialize(e){this.enabled=!1,await this.configureIntentIq(e,!1)}async loadIntentIqLibrary(e){try{p(y,{type:_.VENDOR_TIME_UPDATE,eventName:"intentiq_started",time:performance.now()}),await Q(K(Sa(this.instantConfig.icPrebidIntentIQVersion)),va)}catch{p(y,{type:_.VENDOR_TIME_UPDATE,eventName:"intentiq_error_loading",time:performance.now()})}await this.configureIntentIq(e,!0)}setTargeting(e){E(this.gptWrapper,"GPT wrapper is not available"),e&&this.gptWrapper&&this.gptWrapper.setTargeting("intent_iq_group",e)}reportPrebidWin(e){if(!this.enabled||!this.intentIqObject)return;const t=ba(e);this.intentIqObject.reportExternalWin(t)}}const ka={propertyId:12974,gamIntegration:!1};class Ca extends h{constructor(e,t){super(e);s(this,"name","CaptifyPlugin");s(this,"gptWrapper");s(this,"PROPERTY_ID");s(this,"CAPTIFY_PIXEL_URL");s(this,"gamIntegration",!1);s(this,"isLoaded",!1);s(this,"hooks",{onAdEngineInit:e=>{this.gptWrapper=e.gptWrapper},onConsentUpdated:e=>{w(e)&&this.init()},onAdEngineReset:()=>{this.removeScript(),this.isLoaded=!1,this.init()}});this.instantConfig=t;const{propertyId:r=12974,gamIntegration:o=!1}=typeof this.instantConfig.icCaptify=="boolean"?ka:this.instantConfig.icCaptify;this.PROPERTY_ID=r,this.CAPTIFY_PIXEL_URL=`https://p.cpx.to/p/${this.PROPERTY_ID}/px.js`,this.gamIntegration=o}static isEnabled(e,t){return!!(t!=null&&t.icCaptify)&&super.isEnabled(e,t)}createCaptifyWindowObject(){const e=`captify_kw_query_${this.PROPERTY_ID}`;window[e]=""}removeScript(){const e=document.querySelector(`script[src="${this.CAPTIFY_PIXEL_URL}"]`);e&&e.parentNode&&e.parentNode.removeChild(e)}async createAndInsertScript(){try{await Ae("captify",{src:this.CAPTIFY_PIXEL_URL,isAsyncOrDeferOtherwise:!1,node:"first"}),this.isLoaded=!0}catch{}}installGAMIntegration(){var r;const e="_cptt",t="_cptte";(r=this.gptWrapper)==null||r.addToCommandQueue(()=>{var d;const o=window.localStorage&&window.localStorage.getItem(e);if(!o){window.localStorage.removeItem(e),window.localStorage.removeItem(t);return}const a=parseInt(window.localStorage.getItem(t));if(!isNaN(a)&&a>Date.now()){const l=JSON.parse(o);for(let u=0,f=Object.keys(l);u<f.length;u++){const A=f[u];(d=this.gptWrapper)==null||d.setTargeting(A,l[A].map(k=>k.toString()))}}})}init(){this.isLoaded||(this.createCaptifyWindowObject(),this.createAndInsertScript(),this.gamIntegration&&this.installGAMIntegration())}}const Ra="//cdn.brandmetrics.com/tag/9097a5369e204e6eac53b45c7dde13c5/fandom.com_au.js";class Pa extends h{constructor(e){super(e);s(this,"name","BrandMetricsPlugin");s(this,"scriptUrl");s(this,"firstAdRendered",!1);s(this,"libraryLoaded",!1);s(this,"hooks",{onAfterGptWrapperInit:e=>{this.init(e)}});this.scriptUrl=this.getScriptUrl()}getScriptUrl(){return this.pluginConfig.scriptUrl??Ra}async loadBrandMetricsScript(){try{await Ae("brand-metrics",this.scriptUrl),this.libraryLoaded=!0}catch{}}static isEnabled(e,t){return!!(t!=null&&t.icBrandMetrics)&&super.isEnabled(e,t)}init(e){const t=()=>{this.firstAdRendered||(this.firstAdRendered=!0,e.removeEventListener("slotRenderEnded",t),this.loadBrandMetricsScript())};e.addEventListener("slotRenderEnded",t)}getDebugState(){return{isScriptLoaded:this.libraryLoaded,scriptUrl:this.scriptUrl}}}const wa="AU_SEG",Fa="auSegReady";var ee=(n=>(n.MATCHES_SCRIPT_LOADED="audigent_matches_library_loaded",n.MATCHES_SCRIPT_ERROR_LOADING="audigent_matches_library_error_loading",n.SEGMENTS_SCRIPT_LOADED="audigent_segment_library_loaded",n.SEGMENTS_SCRIPT_ERROR_LOADING="audigent_segment_library_error_loading",n.SEGMENTS_READY="audigent_segments_ready",n))(ee||{});const La="-1",Da="https://a.ad.gt/api/v1/u/matches/158",Oa="https://seg.ad.gt/api/v1/s/158";class Ba extends h{constructor(e,t){super(e);s(this,"name","AudigentPlugin");s(this,"isInitialized",!1);s(this,"segmentsScriptAdded",!1);s(this,"matchesScriptAdded",!1);s(this,"gptWrapper");s(this,"consent",!1);s(this,"hooks",{onConsentUpdated:e=>{this.consent=w(e),this.consent&&this.initialize()},onInitPageTargeting:e=>{this.consent&&(e.AU_SEG=this.getSegments())},onAfterGptWrapperInit:e=>{this.gptWrapper=e,this.updateTargeting()},onAdEngineReset:()=>{this.updateTargeting()}});this.instantConfig=t,this.listenForSegmentUpdates(),this.addSegmentsScript()}static isEnabled(e,t){return!!(t!=null&&t.icAudigent)&&super.isEnabled(e,t)}getDebugState(){var e;return{isInitialized:this.isInitialized,isSegmentsScriptAdded:this.segmentsScriptAdded,isMatchesScriptAdded:this.matchesScriptAdded,segments:((e=window.au_seg)==null?void 0:e.segments)??[]}}sendTracking(e){const t={type:_.VENDOR_TIME_UPDATE,eventName:e,time:performance.now()};p(y,t)}getSegments(){var t;let e=La;return window.au_seg&&(e=(t=window.au_seg)==null?void 0:t.segments.slice(0,this.instantConfig.icAudigentSegmentLimit)),e}updateTargeting(){if(!this.gptWrapper||!this.consent)return;const e=this.getSegments();this.gptWrapper.setTargeting(wa,e)}listenForSegmentUpdates(){document.addEventListener(Fa,()=>{this.updateTargeting(),this.sendTracking(ee.SEGMENTS_READY)})}async addSegmentsScript(){if(!this.segmentsScriptAdded)try{await K(Oa),this.segmentsScriptAdded=!0,this.sendTracking(ee.SEGMENTS_SCRIPT_LOADED)}catch{this.sendTracking(ee.SEGMENTS_SCRIPT_ERROR_LOADING)}}async addMatchesScript(){if(!(this.matchesScriptAdded||!this.consent))try{await K(Da),this.matchesScriptAdded=!0,this.sendTracking(ee.MATCHES_SCRIPT_LOADED)}catch{this.sendTracking(ee.MATCHES_SCRIPT_ERROR_LOADING)}}async initialize(){this.isInitialized||(this.updateTargeting(),await this.addMatchesScript(),this.isInitialized=!0)}}const ce="-1",Bt="https://pub.doubleverify.com/signals/pub.json",xt="28150781",Mt="DV1001654",xa={abs:ce,bsc:ce,ids:ce},Ma=["top_leaderboard","top_boxad","incontent_boxad","bottom_leaderboard","incontent_leaderboard","lightbox_leaderboard","featured","incontent_player","mpu_top","mpu-plus-top","cdm-zone-01","cdm-zone-02","cdm-zone-03","cdm-zone-04","cdm-zone-06"];class Ua extends h{constructor(){super(...arguments);s(this,"name","DoubleVerifyPlugin");s(this,"adNodeManager");s(this,"gptWrapper");s(this,"consent",!1);s(this,"initialized",!1);s(this,"trackedSlots",{});s(this,"referer",window.location.href);s(this,"hooks",{onConsentUpdated:e=>{w(e)&&(this.consent=!0,this.initialize())},onAdEngineInit:e=>{this.gptWrapper=e.gptWrapper,this.adNodeManager=e.adNodeManager,this.initialize()},onAdEngineReset:()=>{this.initialized=!1,this.trackedSlots={},this.initialize()}})}getDebugState(){return{cmp:Mt,ctx:xt,isInitialized:this.initialized,referer:this.referer,scriptUrl:Bt,trackedSlotNames:Object.keys(this.trackedSlots)}}getTrackedSlotNames(){return this.pluginConfig.slotNamesToTrack??Ma}static isEnabled(e,t){return!!t.icDoubleVerify&&super.isEnabled(e,t)}buildRequestUrl(){const e=new URL(Bt),t=e.searchParams;t.set("ctx",xt),t.set("cmp",Mt),t.set("url",this.referer);for(const r of Object.keys(this.trackedSlots))t.append(`adunits[${r}][]`,"");return e}async fetchData(){if(!this.gptWrapper||!this.adNodeManager||!this.consent)return;const e=this.buildRequestUrl();try{const t=await fetch(e,{headers:{referer:this.referer}});if(t.status>=400)return;const r=await t.json();this.handleResponse(r)}catch(t){g({message:"Failed to request data from DoubleVerify",error:t,priority:c.P3,code:Gi})}}handleResponse(e){const{ABS:t,BSC:r,IDS:o,TVP:a,VLP:d}=e;this.gptWrapper&&(this.gptWrapper.setTargeting("abs",t),this.gptWrapper.setTargeting("bsc",r),this.gptWrapper.setTargeting("ids",o.toString())),this.setTargetingForSlots("tvp",a),this.setTargetingForSlots("vlp",d)}setTargetingForSlots(e,t={}){for(const[r,o]of Object.entries(t)){const a=this.trackedSlots[r];a==null||a.setTargeting(e,o[""])}}initialize(){if(!this.consent||!this.gptWrapper||!this.adNodeManager||this.initialized)return;this.referer=window.location.href;for(const[r,o]of Object.entries(xa))this.gptWrapper.setTargeting(r,o);const e=this.adNodeManager.getAdNodes(),t=this.getTrackedSlotNames();for(const r of e){if(!t.includes(r.getBaseSlotName())&&!t.includes(r.getSlotName()))continue;r.setTargeting("vlp",ce),r.setTargeting("tvp",ce);const o=r.getAdUnitPath();o?this.trackedSlots[o]=r:b({message:`[DoubleVerifyPlugin] AdUnitPath for ${r.getSlotName()} not defined. Skipping slot`,priority:c.P4,code:Nn})}this.initialized=!0,this.fetchData()}}function Va(n){return[oi,si].includes(n)}class Wa extends h{constructor(){super(...arguments);s(this,"name","InterstitialPlugin");s(this,"adEngine");s(this,"isDirectCampaign");s(this,"hooks",{onAdEngineInit:e=>{this.adEngine=e},onFirstRenderCycleComplete:(e,t,r)=>{const o=e.adNodeManager.getAdNodeByName("interstitial");this.isDirectCampaign=Va(r),this.shouldLoadInterstitial(o)?(this.markAnchorTagsWithImgTagsAsInterstitialIneligible(),this.listenForImpressionViewableOnInterstitialAndSetInterstitialImpression(o),e.adRenderManager.requestRender([o])):this.setInterstitialDisabledTargeting()},onAdEngineReset:()=>{this.isDirectCampaign=void 0}});s(this,"api",{onCeltraInterstitialImpression:()=>{this.setCappingCookieAndInterstitialDisabledTargeting()}})}getDebugState(){var r,o,a,d;const e=q.get("_ae_intrsttl_imp"),t=(r=this.adEngine)==null?void 0:r.adNodeManager.getAdNodeByName("interstitial");return{interstitialAdNode:t,isCappingCookieSet:!!e,isPageReloaded:this.isPageReloaded(),isDirectCampaign:this.isDirectCampaign,shouldLoadInterstitial:this.shouldLoadInterstitial(t),hasInterstitialDisabledTargeting:((d=(a=(o=this.adEngine)==null?void 0:o.gptWrapper)==null?void 0:a.getTargeting("bundles"))==null?void 0:d.includes("interstitial_disabled"))??!1}}isPageReloaded(){if(!window.performance)return;const e=performance.getEntriesByType("navigation")[0];return(e==null?void 0:e.type)==="reload"}setCappingCookieAndInterstitialDisabledTargeting(){q.set("_ae_intrsttl_imp","1",{expires:864e5,domain:$t(),path:"/"}),this.setInterstitialDisabledTargeting()}setInterstitialDisabledTargeting(){var e,t,r;if((e=this.adEngine)!=null&&e.gptWrapper){const o=((t=this.adEngine)==null?void 0:t.gptWrapper.getTargeting("bundles"))||[];o.push("interstitial_disabled"),(r=this.adEngine)==null||r.gptWrapper.setTargeting("bundles",o)}}markAnchorTagsWithImgTagsAsInterstitialIneligible(){for(const e of document.querySelectorAll("a"))e.querySelector("img")&&e.setAttribute("data-google-interstitial","false")}shouldLoadInterstitial(e){return q.get("_ae_intrsttl_imp")||!e||this.isPageReloaded()||this.isDirectCampaign?!1:fe()}listenForImpressionViewableOnInterstitialAndSetInterstitialImpression(e){var r;const t=(r=this.adEngine)==null?void 0:r.gptWrapper.addSlotEventListener(e.getSlotName(),"impressionViewable",()=>{this.setCappingCookieAndInterstitialDisabledTargeting(),t==null||t()})}}function et(n,i,e){return n===i&&e!==void 0&&e!==null}class za extends h{constructor(){super(...arguments);s(this,"name","JWPlayerRTDPrebidPlugin");s(this,"JWP_RTD_AUCTION_DELAY",100);s(this,"hooks",{onBiddersInit:()=>{const e=this.usePlugin(I);e==null||e.addPrebidReadyCallback(t=>{t.mergeConfig(this.configureJwpRtd())})},onCreateBidderAdUnit:(e,t,r)=>{et("prebid",e,r)&&r.forEach(o=>{var a;(a=o.mediaTypes)!=null&&a.video&&(o.ortb2Imp=this.extendOrtbWithJwpRtdData(o.ortb2Imp))})}})}static isEnabled(e,t){var r;return!!((r=window.canPlayVideo)!=null&&r.call(window))&&t.icFeaturedVideoPlayer==="jwp-video-player"&&super.isEnabled(e,t)}configureJwpRtd(){const e=this.getMediaId();return{realTimeData:{auctionDelay:this.JWP_RTD_AUCTION_DELAY,dataProviders:[{name:"jwplayer",waitForIt:!0,params:{mediaIDs:e?[e]:[]}}]}}}extendOrtbWithJwpRtdData(e={}){var r;const t=this.getMediaId();return t?{...e,ext:{...e.ext,data:{...((r=e.ext)==null?void 0:r.data)??{},jwTargeting:{mediaID:t}}}}:e}getMediaId(){var r,o,a;if(typeof jwplayer<"u"){const d=(r=jwplayer().getPlaylistItem())==null?void 0:r.mediaid;if(d)return d}const e=Ds(),t=(a=(o=e==null?void 0:e.playlist)==null?void 0:o[0])==null?void 0:a.mediaid;return t||b({code:wn,message:"JWPlayerRTDPrebidPlugin: No mediaId found in the featured video config.",priority:c.P3}),t}}const Ut="//cdn.adsafeprotected.com/iasPET.1.js",Ha="930616",R="-1",Ga=["adt","alc","dlm","drg","hat","off","vio"],Vt={fr:R,b_ias:R,"ias-kw":R,adt:R,alc:R,dlm:R,drg:R,hat:R,off:R,vio:R},Wt={veryLow:1,low:2,medium:3,high:4},zt={default:[],fandomdesktop:["top_leaderboard","top_boxad","incontent_boxad","incontent_leaderboard","bottom_leaderboard","lightbox_leaderboard","featured","incontent_player"],fandommobile:["top_leaderboard","top_boxad","incontent_boxad","bottom_leaderboard","featured","incontent_player","drawer"],f2:["top_leaderboard","top_boxad","incontent_boxad","bottom_leaderboard","featured"],comicvine:["mpu_top"],gamefaqs:["mpu_top"],gamespot:["mpu_top"],giantbomb:["mpu_top"],metacritic:["top_boxad"],"metacritic-neutron":["top_boxad"],tvguide:["mpu-plus-top"],sports:["cdm-zone-01","cdm-zone-02","cdm-zone-03","cdm-zone-04","cdm-zone-06"]};function Ni(n){return Array.isArray(n)?n.length===2&&typeof n[0]=="number"&&typeof n[1]=="number"?n:n.length===1&&n[0]==="fluid"?"fluid":Array.isArray(n[0])?Ni(n[0]):[1,1]:n==="fluid"?"fluid":[1,1]}class qa extends h{constructor(){super(...arguments);s(this,"name","IasPublisherOptimizationPlugin");s(this,"gptWrapper");s(this,"adNodeManager");s(this,"consent",!1);s(this,"initialized",!1);s(this,"hooks",{onConsentUpdated:e=>{w(e)&&(this.consent=!0,this.initialize())},onBeforeFirstCallAdsRequest:()=>{this.setInitialAdNodesTargeting()},onInitPageTargeting:e=>{Object.assign(e,Vt)},onAdEngineInit:e=>{this.adNodeManager=e.adNodeManager,this.gptWrapper=e.gptWrapper,this.initialize()},onAdEngineReset:()=>{var e,t;this.consent&&((e=this.gptWrapper)==null||e.setTargeting(Vt),(t=window.__iasPET)!=null&&t.queue&&window.__iasPET.queue.push({adSlots:this.getPETSlots(),dataHandler:this.iasDataHandler.bind(this)}))}})}static isEnabled(e,t){return!!t.icIASPublisherOptimization&&super.isEnabled(e,t)}async initialize(){if(!(!this.consent||!this.gptWrapper||!this.adNodeManager||this.initialized))try{this.initialized=!0,this.setup(),await Ae("ias-publisher-optimization",Ut)}catch{}}setup(){window.__iasPET=window.__iasPET??{},window.__iasPET.queue=window.__iasPET.queue??[],window.__iasPET.pubId=Ha,window.__iasPET.queue.push({adSlots:this.getPETSlots(),dataHandler:this.iasDataHandler.bind(this)})}setInitialAdNodesTargeting(){this.getWatchedAdNodes().forEach(e=>{e.getTargeting("vw").length===0&&e.setTargeting("vw",R)})}getPETSlots(){const e=[];return this.getWatchedAdNodes().forEach(t=>{const r=this.getSlotSize(t),o={adUnitPath:t.getAdUnitPath()??"",adSlotId:t.getSlotName(),size:r};t.getSlotType()==="video"&&(o.type="video",o.size=[1,1]),e.push(o)}),e}getSlotSize(e){const t=e.getDefaultSizes(),r=Ni(t);return Array.isArray(r)?r:[1,1]}getWatchedAdNodes(){var t;return(((t=this.adNodeManager)==null?void 0:t.getAdNodes())??[]).filter(r=>this.getWatchedSlotList().includes(r.getSlotName())||this.getWatchedSlotList().includes(r.getBaseSlotName()))}getWatchedSlotList(){const e=this.pluginConfig.watchedSlotList;return Array.isArray(e)?e:zt[pe()]??zt.default}iasDataHandler(e){try{const t=JSON.parse(e);this.updateGenericTargeting(t),this.updateSlotTargeting(t),this.updateBrandSafetyTargeting(t)}catch(t){g({code:pn,message:"Failed to parse IAS targeting data",error:t,priority:c.P3})}}updateGenericTargeting(e){var o,a;const t={fr:(e==null?void 0:e.fr)??""},r=(o=e.custom)==null?void 0:o["ias-kw"];r&&(t["ias-kw"]=r),(a=this.gptWrapper)==null||a.setTargeting(t)}updateSlotTargeting(e){var t;if(e.slots)for(const[r,o]of Object.entries(e.slots))(t=this.gptWrapper)==null||t.setSlotTargeting(r,"vw",o.vw??o.vw_vv)}updateBrandSafetyTargeting(e){var t;if(e.brandSafety){const r=e.brandSafety;let o;const a={};Ga.forEach(d=>{r[d]&&(a[d]=r[d],(typeof o>"u"||Wt[o]<Wt[r[d]])&&(o=r[d]))}),a.b_ias=o??R,(t=this.gptWrapper)==null||t.setTargeting(a)}}getDebugState(){var e,t,r;return{isInitialized:this.initialized,pubId:(e=window.__iasPET)==null?void 0:e.pubId,queueItemsCount:((r=(t=window.__iasPET)==null?void 0:t.queue)==null?void 0:r.length)??0,scriptUrl:Ut,watchedSlotList:this.getWatchedSlotList()}}}function $a(){(function(n,i){n[i]=n[i]||{nlsQ:function(e,t,r,o,a,d){return a=n.document,o=a.createElement("script"),o.defer=1,o.src=(n.location.protocol==="http:"?"http:":"https:")+"//cdn-gl.imrworldwide.com/conf/"+e+".js#name="+t+"&ns="+i,d=a.getElementsByTagName("script")[0],d.parentNode.insertBefore(o,d),n[i][t]=n[i][t]||{g:r||{},ggPM:function(l,u,f,A,k){(n[i][t].q=n[i][t].q||[]).push([l,u,f,A,k])}},n[i][t]}}})(window,"NOLBUNDLE")}class ja extends h{constructor(){super(...arguments);s(this,"name","NielsenPlugin");s(this,"NIELSEN_KEY","P26086A07-C7FB-4124-A679-8AC404198BA7");s(this,"nielsenWindowConfig",{});s(this,"isLoaded",!1);s(this,"gptWrapper");s(this,"consent",!1);s(this,"hooks",{onConsentUpdated:e=>{this.consent=w(e),this.consent&&this.init()},onAfterGptWrapperInit:e=>{this.gptWrapper=e,this.consent&&this.init()}})}getDebugState(){return{isScriptLoaded:this.isLoaded,isDebugModeEnabled:this.nielsenWindowConfig.nol_sdkDebug==="debug"}}static isEnabled(e,t){return!!t.icNielsen&&super.isEnabled(e,t)}getNielsenInstance(){return $a(),j("nielsen-dcr-debug")&&(this.nielsenWindowConfig.nol_sdkDebug="debug"),window==null?void 0:window.NOLBUNDLE.nlsQ(this.NIELSEN_KEY,"nlsnInstance",this.nielsenWindowConfig)}init(){var d,l,u;if(this.isLoaded||!this.gptWrapper)return;const e=this.getNielsenInstance(),t=(d=this.gptWrapper.getTargeting("s0v"))==null?void 0:d.join(","),r=(l=this.gptWrapper.getTargeting("artid"))==null?void 0:l.join(","),o=(u=this.gptWrapper.getTargeting("s1"))==null?void 0:u.join(","),a={type:"static",assetid:`fandom.com/${t}/${o}/${r}`,section:`FANDOM ${t==null?void 0:t.replace(/_/g," ").toUpperCase()} NETWORK`};e.ggPM("static",a),this.isLoaded=!0}}const Ie="tier",Le=class Le extends h{constructor(){super(...arguments);s(this,"name","BlockthroughReadershipLinkPlugin");s(this,"isInitialized",!1);s(this,"adEngine",null);s(this,"tieredElements",new Set);s(this,"hooks",{onConsentUpdated:e=>{w(e)&&this.initialize()},onAdEngineInit:e=>{this.adEngine=e},onAdEngineReset:()=>{for(const e of this.tieredElements)e.classList.remove(`${Ie}2`,`${Ie}3`,`${Ie}4`);this.tieredElements.clear()},onBeforeAdsRequest:e=>{var o;const t=(o=this.adEngine)==null?void 0:o.monetizationTierEngine;if(!t){g({code:hn,message:"Monetization tier engine is not available, cannot add Blockthrough readership link classes",priority:c.P2});return}const r=`${Ie}${t.getCurrentTier()}`;for(const a of e){const d=a.getElement();d&&!d.classList.contains(r)&&(d.classList.add(r),this.tieredElements.add(d))}}})}static isEnabled(e,t){return Re()!==st?!1:!!t.icBlockthroughReadershipLink&&super.isEnabled(e,t)}adjustPrebidAdserverTargetingConfig(){var e;(e=this.usePlugin(I))==null||e.addPrebidReadyCallback(t=>{t.bidderSettings=rt(t.bidderSettings,ko)})}async initialize(){if(!this.isInitialized){this.isInitialized=!0;try{p(y,{type:_.VENDOR_TIME_UPDATE,eventName:"bt-loader_started",time:performance.now()}),this.adjustPrebidAdserverTargetingConfig(),await K(Le.SCRIPT_URL),p(y,{type:_.VENDOR_TIME_UPDATE,eventName:"bt-loader_loaded",time:performance.now()})}catch{p(y,{type:_.VENDOR_TIME_UPDATE,eventName:"bt-loader_error_loading",time:performance.now()})}}}};s(Le,"SCRIPT_URL","https://btloader.com/tag?o=5199505043488768&upapi=true");let tt=Le;class Ka extends h{constructor(e){super(e);s(this,"name","AdLabelPlugin");s(this,"translatedAdLabel",null);s(this,"excludedSlots",new Set(["top_leaderboard","floor_adhesion","left_panel_ad","mobile_drawer_ad"]));s(this,"hooks",{onAdEngineInit:e=>{this.registerSlotRenderHandler(e.gptWrapper)},onAdNodeRemoved:e=>{const t=e.getElement(),r=t==null?void 0:t.querySelector('label[data-key="advertisement"]');r==null||r.remove()}});s(this,"api",{addLabelToSlot:e=>{this.addLabelToSlot(e)}})}getTranslatedAdLabel(){var t;if(this.translatedAdLabel)return this.translatedAdLabel;const e=document.getElementsByTagName("fandom-ad");for(const r of e){const o=(t=r.getAdLabelElement)==null?void 0:t.call(r);if(o)return this.translatedAdLabel=o,this.translatedAdLabel}return this.translatedAdLabel=document.querySelector(".fandom-ad-label")??document.querySelector(".ae-translatable-label"),this.translatedAdLabel}addLabelToSlot(e){if(this.excludedSlots.has(e))return;const t=document.getElementById(e),r=this.getTranslatedAdLabel();if(!t||!r)return;const o=`label-${e}`;if(document.getElementById(o))return;const a=this.cloneTranslatedLabel(r,o);t.appendChild(a)}registerSlotRenderHandler(e){e.addEventListener("slotRenderEnded",t=>{const r=t.slot.getSlotElementId();t.isEmpty||this.addLabelToSlot(r)})}cloneTranslatedLabel(e,t){const r=e.cloneNode(!0);r.classList.remove("dsa-advertisement-label-clickable"),r.id=t;const o=r.querySelector(".dsa-advertisement-label-icon");return o==null||o.remove(),r}getDebugState(){return{hasTranslatedLabel:!!this.getTranslatedAdLabel(),excludedSlotNames:Array.from(this.excludedSlots)}}}class Ya extends h{constructor(e,t){super(e);s(this,"name","PrebidIdSyncingPlugin");s(this,"YAHOO_BIT",0);s(this,"ID5_BIT",1);s(this,"HEM_BIT",2);s(this,"LIVEINTENT_BIT",3);s(this,"PUBCID_BIT",4);s(this,"UID2_BIT",5);s(this,"LIVE_RAMP_ATS_BIT",6);s(this,"UID_BIT",7);s(this,"BIT_PLACEHOLDER","x");s(this,"ID_STRING_LENGTH",16);s(this,"PRESENT_PLACEHOLDER","P");s(this,"ABSENT_PLACEHOLDER","A");s(this,"LIVE_CONNECT_PLACEHOLDER","L");s(this,"MEDIA_WIKI_PLACEHOLDER","M");s(this,"pbjs");s(this,"ID_MAP",{[this.YAHOO_BIT]:e=>this.getDefaultBitStatus(e,"yahoo.com"),[this.ID5_BIT]:e=>this.getDefaultBitStatus(e,"id5-sync.com"),[this.HEM_BIT]:()=>this.getHEMBitStatus(),[this.LIVEINTENT_BIT]:e=>this.getDefaultBitStatus(e,"liveintent.com"),[this.PUBCID_BIT]:e=>this.getDefaultBitStatus(e,"pubcid.org"),[this.UID2_BIT]:e=>this.getDefaultBitStatus(e,"uidapi.com"),[this.LIVE_RAMP_ATS_BIT]:e=>this.getDefaultBitStatus(e,"liveramp.com"),[this.UID_BIT]:e=>this.getDefaultBitStatus(e,"adserver.org")});s(this,"hooks",{onBiddersInit:e=>{var t;this.configureLiveIntentTargeting(e),(t=this.usePlugin(I))==null||t.addPrebidReadyCallback(r=>{this.pbjs=r,this.pbjs.onEvent("requestBids",()=>{this.generateBoiAndSyncGptTargeting(e),this.updateLiveIntentTargeting(e)})})}});this.instantConfig=t}getDebugState(){return{boiString:this.generateBoiString()}}getDefaultBitStatus(e,t){return e.find(r=>r.source===t)?this.PRESENT_PLACEHOLDER:this.ABSENT_PLACEHOLDER}getHEMBitStatus(){var e,t,r;switch(!0){case this.checkIfLiveConnectSha2HEMIsPresent():return this.LIVE_CONNECT_PLACEHOLDER;case!!((r=(t=(e=ai())==null?void 0:e.opts)==null?void 0:t.userEmailHashes)!=null&&r.length):return this.MEDIA_WIKI_PLACEHOLDER;default:return this.ABSENT_PLACEHOLDER}}configureLiveIntentTargeting(e){var o;const t=this.instantConfig.icLiveIntentConnectedId,r=t?"t1":"t0";if((o=e.gptWrapper)==null||o.setTargeting("li-module-enabled",[r]),!t){window.liModuleEnabled=!1;return}window.liModuleEnabled=!0}updateLiveIntentTargeting(e){var r;if(!this.instantConfig.icLiveIntentConnectedId)return;const t=this.getIds().some(o=>o.source.includes("liveintent.com"));(r=e.gptWrapper)==null||r.setTargeting("li-module-enabled",[`t1-${t?"e1":"e0"}`])}getIds(){var e;return((e=this.pbjs)==null?void 0:e.getUserIdsAsEids())??[]}generateBoiString(){const e=this.getIds();let t="";for(let r=0;r<this.ID_STRING_LENGTH;r++){const o=this.ID_MAP[r];if(o){const a=o(e);t+=a}else t+=this.BIT_PLACEHOLDER}return t}generateBoiAndSyncGptTargeting(e){const t=this.generateBoiString();e.gptWrapper.setTargeting("boi",t),this.getIds().forEach(r=>{var o;(o=r.uids[0])!=null&&o.id&&p(nt.IDENTITY_INFO,{partnerName:r.source,partnerIdentityId:r.uids[0].id})})}checkIfLiveConnectSha2HEMIsPresent(){var e;try{return((e=this.usePlugin(Y))==null?void 0:e.checkIfSha2HemAvailable())??!1}catch{return!1}}}function Se(n,i){const e=Object.entries(n);return!n||e.length===0?[]:e.reduce((t,[r,o])=>{const a=ki(r,i),{instantConfig:d}=i;return o!=null&&o.isEnabled(a,d)&&(a==null?void 0:a.enabled)!==!1&&t.push(new o(a,d)),t},[])}function ki(n,i){var e;return((e=i==null?void 0:i.plugins)==null?void 0:e[n])??{}}class Qa{constructor(i,e){s(this,"experimentPluginMap",new Map);this.pluginClasses=i;const t=this.identifyActiveExperiment();if(!t)return;const r=Object.entries(i);for(const[o,a]of r){const d=ki(o,e);if(a.experimentName==t.name&&a.isEnabled(d,e.instantConfig)){const l=new a(d,e.instantConfig);l.setExperimentGroup(t.group),this.experimentPluginMap.set(l.experimentName,l)}}}checkExpiration(i){const e=i.codeDeletionDate;new Date().getTime()>=e.getTime()&&b({code:Vn,message:`Experiment ${i.experimentName} has passed its codeDeletionDate`,priority:c.P4})}identifyActiveExperiment(){const i=De("force-sse");if(i){const e=Ai(i);if(e)return e}return xs()}getExperimentPlugins(){return[...this.experimentPluginMap.values()]}}const Xa="https://ats-wrapper.privacymanager.io/ats-modules/2be88350-78eb-4214-96b8-3a489d2aa7d6/ats.js";class Ja extends h{constructor(){super(...arguments);s(this,"name","LiveRampATSPlugin");s(this,"initialized",!1);s(this,"isScriptLoaded",!1);s(this,"hooks",{onConsentUpdated:e=>{if(!w(e)){this.shouldClearEnvelope(e)&&this.processOptOut();return}this.initialize()},onAdEngineReset:()=>{const e=this.usePlugin(Y);e&&this.processHems(e).catch(t=>{b({code:On,message:"LiveRamp ATS re-processing HEMs failed",priority:c.P3,error:t})})}})}static isEnabled(e,t){return!!t.icPrebidLiveRampATS&&super.isEnabled(e,t)}async initialize(){if(!this.initialized){this.initialized=!0;try{const e=this.usePlugin(Y);if(!e)return;await this.loadScript(),await this.processHems(e)}catch(e){b({code:Ln,message:"LiveRamp ATS initialization failed",priority:c.P3,error:e})}}}async loadScript(){if(!this.isScriptLoaded)try{this.isScriptLoaded=!0,await K({src:Xa,isAsyncOrDeferOtherwise:!0,node:"first"})}catch(e){this.isScriptLoaded=!1,b({code:Dn,message:"LiveRamp ATS script failed to load",priority:c.P3,error:e})}}async processHems(e){const t=await e.waitForHems();if(!t)return;const r=[t.sha1,t.sha2,t.md5].filter(a=>!!a);if(r.length===0)return;this.setupLrEnvelopePresentListener(),(await this.getAtsModule()).setAdditionalData({type:"emailHashes",id:r})}getAtsModule(){return new Promise(e=>{if(window.atsenvelopemodule)return e(window.atsenvelopemodule);window.addEventListener("envelopeModuleReady",()=>{e(window.atsenvelopemodule)},{once:!0})})}setupLrEnvelopePresentListener(){window.addEventListener("lrEnvelopePresent",()=>{const e=this.usePlugin(I);e==null||e.addPrebidReadyCallback(t=>{t.refreshUserIds({submoduleNames:[hi]})})},{once:!0})}shouldClearEnvelope(e){return(e==null?void 0:e.consentApi)==="usp"}async processOptOut(){await this.loadScript(),(await this.getAtsModule()).invalidateEnvelope(),this.initialized=!1}}const Za=n=>n.getEvents().some(i=>{var e,t;return i.eventType==="auctionDebug"&&((e=i.args)==null?void 0:e.type)==="WARNING"&&typeof((t=i.args)==null?void 0:t.arguments)<"u"&&[...i.args.arguments].some(r=>String(r).includes("TCF timeout waiting for CMP to load"))}),ed=()=>typeof window.OneTrust<"u"&&typeof window.OneTrust.geolocationResponse=="object"&&typeof window.OneTrust.UpdateConsent=="function",he=class he extends h{constructor(e,t){super(e);s(this,"name","AuctionCmpTrackingPlugin");s(this,"state",{cmpApiAvailable:!1,oneTrustAvailable:!1,auctionStarted:!1,auctionTimedOut:0,adsRendered:!1,numberOfIdPartners:0});s(this,"trackingSent",!1);s(this,"cleanup",()=>{});s(this,"hooks",{onBiddersInit:()=>{var e;this.enabled&&(this.setTimeoutForTracking(),(e=this.usePlugin(I))==null||e.addPrebidReadyCallback(t=>{t.onEvent("auctionInit",()=>{this.setTimeoutForTracking(),this.state.cmpApiAvailable=!Za(t),this.state.oneTrustAvailable=ed(),this.state.auctionStarted=!0}),t.onEvent("auctionTimeout",()=>{this.setTimeoutForTracking(),this.state.auctionTimedOut=1}),t.onEvent("auctionEnd",()=>{this.setTimeoutForTracking(),this.state.numberOfIdPartners=t.getUserIdsAsEids().length})}))},onFirstRenderCycleComplete:(e,t)=>{this.enabled&&(this.state.adsRendered=t.length>0,this.trackingSent||(this.cleanup(),this.sendTracking()))}});this.instantConfig=t}get enabled(){return!!this.instantConfig.odysseyAuctionCmpTracking}setTimeoutForTracking(e=2*this.instantConfig.icAdEngineAuctionTimeoutMS){this.cleanup();const t=setTimeout(()=>{this.trackingSent||(this.state.auctionTimedOut=2,this.sendTracking())},e);this.cleanup=()=>clearTimeout(t)}getConsentRegion(){var t;const e=(t=window.fandomCmp)==null?void 0:t.consentApi;return e==="usp"?"US":e==="tcf"?"EU":"RoW"}encodeState(){return Object.values(this.state).map(e=>typeof e=="boolean"?Number(e):e).join(",")}sendTracking(){this.enabled&&(this.trackingSent=!0,p(Xt.TRACKING_EVENT,{event_type:he.TRACKING_EVENT_NAME,ga_category:he.TRACKING_EVENT_NAME,ga_label:this.getConsentRegion(),ga_value:this.encodeState()}))}getDebugState(){return{isEnabled:this.enabled,hasTrackingSent:this.trackingSent,cmpApiAvailable:this.state.cmpApiAvailable,oneTrustAvailable:this.state.oneTrustAvailable,hasAuctionStarted:this.state.auctionStarted,auctionTimeoutStatus:this.state.auctionTimedOut,hasAdsRendered:this.state.adsRendered,numberOfIdPartners:this.state.numberOfIdPartners,consentRegion:this.getConsentRegion(),encodedState:this.encodeState()}}};s(he,"TRACKING_EVENT_NAME","odyssey_cmp_tracking");let it=he;const td={fandomdesktop:["incontent_leaderboard","bottom_leaderboard","floor_adhesion","lightbox_leaderboard","mid_boxad","left_panel_ad","featured","incontent_player"],fandommobile:["incontent_boxad","bottom_leaderboard","interstitial","lightbox_leaderboard","mobile_drawer_ad","featured","incontent_player"]};class id extends h{constructor(e){super(e);s(this,"name","RegisteredUserPlugin");s(this,"config");s(this,"adEngine");s(this,"removedSlots",[]);s(this,"hooks",{onInitSlotConfigMap:e=>{const t=Re();if(t===st)return;const r=this.handleAdNodeCreationError.bind(this);window.addEventListener("error",r),t===Vr?(this.removeSlotsForRegisteredUsers(e),this.removeAdsWhenCommentsEnterViewport(e)):t===Wr&&this.removeAllSlots(e)},onAdEngineInit:e=>{this.adEngine=e}});this.config=td}getDebugState(){return{config:this.config,removedSlots:this.removedSlots,userState:Re()}}handleAdNodeCreationError(e){const t=e.message.match(/AdNode for element with id\[(.*)\] could not be created./);if(!t)return;const r=t[1],o=ie(r);if(this.wasSlotRemoved(o)){e.preventDefault();return}}removeSlots(e,t){t.forEach(r=>{e.baseSlots[r]?e.baseSlots[r].enabled=!1:e.videoSlots[r]&&(e.videoSlots[r].enabled=!1),this.removedSlots.push(r)}),this.removeAdNodes(t)}removeSlotsForRegisteredUsers(e){const{app:t}=e,r=this.config[t]||[];this.removeSlots(e,r)}removeAllSlots(e){const t=[...Object.keys(e.baseSlots),...Object.keys(e.videoSlots)];this.removeSlots(e,t)}removeAdNodes(e){if(e.some(r=>ie(r)==="top_leaderboard")&&(this.removeTopLeaderboardWrapper(),e=e.filter(r=>ie(r)!=="top_leaderboard")),this.adEngine){e.forEach(r=>{const o=this.adEngine.adNodeManager.getAdNodeByName(r);o&&(o.collapse(),this.adEngine.adNodeManager.removeAdNode(o))});return}e.forEach(r=>{document.querySelectorAll(`${S.ELEMENT_NAME}#${r}, ${L.ELEMENT_NAME}#${r}`).forEach(o=>{o.remove()})})}getCommentsAndDiscussionsContainers(){return["#articleComments",".article-comments-collapsible-menu","#article-discussions"].map(r=>document.querySelector(r)).filter(r=>r!==null)}removeAdsWhenCommentsEnterViewport(e){const t=this.getCommentsAndDiscussionsContainers();if(t.length===0)return;if(t.find(a=>ot(a,100))){this.removeAllSlots(e);return}const r={root:null,rootMargin:"100px 0px 100px 0px",threshold:0},o=new IntersectionObserver(a=>{a.forEach(d=>{d.isIntersecting&&(this.removeAllSlots(e),o.disconnect())})},r);t.forEach(a=>o.observe(a))}removeTopLeaderboardWrapper(){var r,o;const e=document.getElementById("top_leaderboard"),t=(r=e==null?void 0:e.getStickyContainerWrapper)==null?void 0:r.call(e);if(t){t.remove();return}(o=document.querySelector(".top_leaderboard-odyssey-wrapper"))==null||o.remove()}wasSlotRemoved(e){return!!this.removedSlots.find(t=>t===e)}}function nd(n,i,e){const t={"*":Te.data.default};for(const r of i){const o=r.getSlotName(),a=rd(r,n);a&&(t[o]=a.calculateFloor(e))}return t}function rd(n,i){const e=n.getBaseSlotName(),t=i.filter(r=>od(r.baseSlotName,e));if(t.length!==0)return t.length>1&&g({code:qi,message:`DynamicPriceFloor: Unexpected number of matching dynamic floor configs for this slot ${e}`,priority:c.P3}),t[0]}function od(n,i){return n==="*"?!0:Array.isArray(n)?n.some(e=>ve(e,i)):ve(n,i)}const U="ay_floor",$="ay_floor_g",we="f_hb_floor",sd="hb_pb";function Ht(n,i,e){if(n<=1||n>=3.5)return n;const t=Number((n-e).toFixed(2)),r=Number((t%i).toFixed(2));return r===i?n:Number((n-r).toFixed(2))}function ct(n){let i;return n>=3.5?i=3.5:n>=2?i=Ht(n,.03,2):n>=1?i=Ht(n,.02,1):n>=0?i=n:i=0,i.toFixed(2)}function ad(n){var r,o;const i=parseFloat((r=n.getTargeting(sd))==null?void 0:r[0]);if(isNaN(i))return;const e=parseFloat((o=n.getTargeting(U))==null?void 0:o[0]);if(i<e)return;const t=ct(i);n.clearTargeting(U),n.clearTargeting($),n.setTargeting(U,t),n.setTargeting($,"beatPrebid")}function dd(n,i,e){const t=n.getSlotName(),r=n.getSlotType(),o=i[t];if(o){if(n.clearTargeting(we),r!=="video"){n.clearTargeting(U),n.clearTargeting($);const a=ct(o);e?(n.setTargeting(U,a),n.setTargeting($,"getFloors")):(n.setTargeting(U,Te.data.default.toFixed(2)),n.setTargeting($,"forcedControl"))}n.setTargeting(we,o.toFixed(2))}}function ld(n){let i=5381;for(let e=0;e<n.length;e++){const t=n.charCodeAt(e);i=(i<<5)+i+t,i|=0}return(i>>>0).toString(16)}function cd(n){const i=["geo","monetization","tier","skin"].map(e=>{const t=n[e],r=Array.isArray(t)?t.sort().join(","):t;return`${e}=${r}`}).join("&");return{targetingStr:i,hash:ld(i)}}function Ci(n,i){var r;const e=i.gptWrapper.getAllTargeting({raw:!0}),t=Object.keys(n);for(const o of t){const a=n[o];if(a===void 0)continue;const d=(r=e[o])==null?void 0:r[0];if(Array.isArray(a)){if(!a.some(u=>ve(u,d)))return!1}else if(!ve(a,d))return!1}return!0}function ud(n,i){return n.filter(e=>Ci(e.targeting,i))}class ye{constructor(i){s(this,"testGroupName");s(this,"floorStrategyName");s(this,"setAyFloorHigherTempVar",!0);s(this,"filteredFloorConfigs");s(this,"adEngine");this.adEngine=i.adEngine,this.floorStrategyName=i.floorStrategyName,this.testGroupName=i.testGroupName;const e=this.getFloorConfigs();this.filteredFloorConfigs=ud(e,this.adEngine)}}class D extends ye{getFloorConfigs(){return gd}}const gd=[{targeting:{},baseSlotName:"*",calculateFloor:()=>Te.data.default}];class hd extends ye{getFloorConfigs(){return pd}}const pd=[{targeting:{geo:"us",skin:"ucp_mobile",tier:"4"},baseSlotName:"floor_adhesion",calculateFloor:()=>.64},{targeting:{geo:"us",skin:"ucp_desktop",tier:"4"},baseSlotName:"incontent_boxad",calculateFloor:()=>.39},{targeting:{geo:"us",skin:"ucp_mobile",tier:"4"},baseSlotName:"incontent_boxad",calculateFloor:()=>.47},{targeting:{geo:"us",skin:"ucp_mobile",tier:"3"},baseSlotName:"floor_adhesion",calculateFloor:()=>.34},{targeting:{geo:"us",skin:"ucp_desktop",tier:"4"},baseSlotName:"top_leaderboard",calculateFloor:()=>.4},{targeting:{geo:"us",skin:"ucp_mobile",tier:"4"},baseSlotName:"bottom_leaderboard",calculateFloor:()=>.3},{targeting:{geo:"us",skin:"ucp_desktop",tier:"4"},baseSlotName:"mid_boxad",calculateFloor:()=>.33},{targeting:{geo:"us",skin:"ucp_mobile",tier:"4"},baseSlotName:"top_leaderboard",calculateFloor:()=>.36},{targeting:{geo:"us",skin:"ucp_desktop",tier:"3"},baseSlotName:"incontent_boxad",calculateFloor:()=>.2},{targeting:{geo:"us",skin:"ucp_desktop",tier:"4"},baseSlotName:"top_boxad",calculateFloor:()=>.35},{targeting:{geo:"us",skin:"ucp_mobile",tier:"4"},baseSlotName:"top_boxad",calculateFloor:()=>.58},{targeting:{geo:"us",skin:"ucp_mobile",tier:"3"},baseSlotName:"incontent_boxad",calculateFloor:()=>.22},{targeting:{geo:"us",skin:"ucp_desktop",tier:"4"},baseSlotName:"incontent_leaderboard",calculateFloor:()=>.31},{targeting:{geo:"us",skin:"ucp_desktop",tier:"4"},baseSlotName:"bottom_leaderboard",calculateFloor:()=>.25},{targeting:{geo:"us",skin:"ucp_mobile",tier:"3"},baseSlotName:"bottom_leaderboard",calculateFloor:()=>.16},{targeting:{geo:"us",skin:"ucp_mobile",tier:"3"},baseSlotName:"top_boxad",calculateFloor:()=>.24},{targeting:{geo:"us",skin:"ucp_desktop",tier:"3"},baseSlotName:"top_leaderboard",calculateFloor:()=>.26},{targeting:{geo:"us",skin:"ucp_mobile",tier:"3"},baseSlotName:"top_leaderboard",calculateFloor:()=>.16},{targeting:{geo:"us",skin:"ucp_desktop",tier:"3"},baseSlotName:"top_boxad",calculateFloor:()=>.21},{targeting:{geo:"us",skin:"ucp_desktop",tier:"3"},baseSlotName:"incontent_leaderboard",calculateFloor:()=>.2},{targeting:{geo:"us",skin:"ucp_desktop",tier:"3"},baseSlotName:"mid_boxad",calculateFloor:()=>.19},{targeting:{geo:"us",skin:"ucp_mobile",tier:"3"},baseSlotName:"lightbox_leaderboard",calculateFloor:()=>.25},{targeting:{geo:"us",skin:"ucp_desktop",tier:"3"},baseSlotName:"bottom_leaderboard",calculateFloor:()=>.17},{targeting:{geo:"au",skin:"ucp_mobile",tier:"4"},baseSlotName:"floor_adhesion",calculateFloor:()=>.31},{targeting:{geo:"us",skin:"ucp_desktop",tier:"3"},baseSlotName:"lightbox_leaderboard",calculateFloor:()=>.31},{targeting:{geo:"au",skin:"ucp_desktop",tier:"4"},baseSlotName:"incontent_boxad",calculateFloor:()=>.19},{targeting:{geo:"au",skin:"ucp_mobile",tier:"3"},baseSlotName:"floor_adhesion",calculateFloor:()=>.26},{targeting:{geo:"au",skin:"ucp_desktop",tier:"3"},baseSlotName:"incontent_boxad",calculateFloor:()=>.16},{targeting:{geo:"au",skin:"ucp_desktop",tier:"4"},baseSlotName:"top_leaderboard",calculateFloor:()=>.24},{targeting:{geo:"au",skin:"ucp_desktop",tier:"4"},baseSlotName:"mid_boxad",calculateFloor:()=>.16},{targeting:{geo:"au",skin:"ucp_mobile",tier:"4"},baseSlotName:"incontent_boxad",calculateFloor:()=>.2},{targeting:{geo:"au",skin:"ucp_desktop",tier:"4"},baseSlotName:"top_boxad",calculateFloor:()=>.16},{targeting:{geo:"au",skin:"ucp_desktop",tier:"3"},baseSlotName:"top_leaderboard",calculateFloor:()=>.23},{targeting:{geo:"au",skin:"ucp_desktop",tier:"4"},baseSlotName:"incontent_leaderboard",calculateFloor:()=>.15},{targeting:{geo:"au",skin:"ucp_mobile",tier:"3"},baseSlotName:"incontent_boxad",calculateFloor:()=>.15},{targeting:{geo:"au",skin:"ucp_mobile",tier:"4"},baseSlotName:"top_boxad",calculateFloor:()=>.26},{targeting:{geo:"au",skin:"ucp_mobile",tier:"4"},baseSlotName:"bottom_leaderboard",calculateFloor:()=>.17},{targeting:{geo:"au",skin:"ucp_desktop",tier:"3"},baseSlotName:"incontent_leaderboard",calculateFloor:()=>.12},{targeting:{geo:"au",skin:"ucp_desktop",tier:"3"},baseSlotName:"top_boxad",calculateFloor:()=>.13},{targeting:{geo:"au",skin:"ucp_desktop",tier:"3"},baseSlotName:"mid_boxad",calculateFloor:()=>.13},{targeting:{geo:"au",skin:"ucp_mobile",tier:"4"},baseSlotName:"top_leaderboard",calculateFloor:()=>.15},{targeting:{geo:"au",skin:"ucp_mobile",tier:"3"},baseSlotName:"top_boxad",calculateFloor:()=>.19},{targeting:{geo:"au",skin:"ucp_desktop",tier:"4"},baseSlotName:"bottom_leaderboard",calculateFloor:()=>.13},{targeting:{geo:"au",skin:"ucp_desktop",tier:"3"},baseSlotName:"lightbox_leaderboard",calculateFloor:()=>.24},{targeting:{geo:"au",skin:"ucp_mobile",tier:"3"},baseSlotName:"bottom_leaderboard",calculateFloor:()=>.11},{targeting:{geo:"au",skin:"ucp_mobile",tier:"3"},baseSlotName:"lightbox_leaderboard",calculateFloor:()=>.17},{targeting:{geo:"au",skin:"ucp_mobile",tier:"3"},baseSlotName:"top_leaderboard",calculateFloor:()=>.11},{targeting:{geo:"au",skin:"ucp_desktop",tier:"3"},baseSlotName:"bottom_leaderboard",calculateFloor:()=>.11},{targeting:{geo:"us",skin:"ucp_mobile",tier:"4"},baseSlotName:"incontent_leaderboard",calculateFloor:()=>.33},{targeting:{geo:"us",skin:"ucp_mobile",tier:"4"},baseSlotName:"mid_boxad",calculateFloor:()=>.26},{targeting:{geo:"us",skin:"ucp_mobile",tier:"3"},baseSlotName:"incontent_leaderboard",calculateFloor:()=>.18},{targeting:{geo:"us",skin:"ucp_desktop",tier:"4"},baseSlotName:"floor_adhesion",calculateFloor:()=>.56},{targeting:{geo:"us",skin:"ucp_mobile",tier:"3"},baseSlotName:"mid_boxad",calculateFloor:()=>.17},{targeting:{geo:"us",skin:"ucp_desktop",tier:"3"},baseSlotName:"floor_adhesion",calculateFloor:()=>.35}];class md extends ye{getFloorConfigs(){return fd}}const fd=[{targeting:{geo:"us",skin:"ucp_mobile",tier:"4"},baseSlotName:"floor_adhesion",calculateFloor:()=>.46},{targeting:{geo:"us",skin:"ucp_desktop",tier:"4"},baseSlotName:"incontent_boxad",calculateFloor:()=>.27},{targeting:{geo:"us",skin:"ucp_mobile",tier:"4"},baseSlotName:"incontent_boxad",calculateFloor:()=>.35},{targeting:{geo:"us",skin:"ucp_mobile",tier:"3"},baseSlotName:"floor_adhesion",calculateFloor:()=>.25},{targeting:{geo:"us",skin:"ucp_desktop",tier:"4"},baseSlotName:"top_leaderboard",calculateFloor:()=>.3},{targeting:{geo:"us",skin:"ucp_mobile",tier:"4"},baseSlotName:"bottom_leaderboard",calculateFloor:()=>.22},{targeting:{geo:"us",skin:"ucp_desktop",tier:"4"},baseSlotName:"mid_boxad",calculateFloor:()=>.24},{targeting:{geo:"us",skin:"ucp_mobile",tier:"4"},baseSlotName:"top_leaderboard",calculateFloor:()=>.26},{targeting:{geo:"us",skin:"ucp_desktop",tier:"3"},baseSlotName:"incontent_boxad",calculateFloor:()=>.16},{targeting:{geo:"us",skin:"ucp_desktop",tier:"4"},baseSlotName:"top_boxad",calculateFloor:()=>.25},{targeting:{geo:"us",skin:"ucp_mobile",tier:"4"},baseSlotName:"top_boxad",calculateFloor:()=>.39},{targeting:{geo:"us",skin:"ucp_mobile",tier:"3"},baseSlotName:"incontent_boxad",calculateFloor:()=>.19},{targeting:{geo:"us",skin:"ucp_desktop",tier:"4"},baseSlotName:"incontent_leaderboard",calculateFloor:()=>.24},{targeting:{geo:"us",skin:"ucp_desktop",tier:"4"},baseSlotName:"bottom_leaderboard",calculateFloor:()=>.18},{targeting:{geo:"us",skin:"ucp_mobile",tier:"3"},baseSlotName:"bottom_leaderboard",calculateFloor:()=>.13},{targeting:{geo:"us",skin:"ucp_mobile",tier:"3"},baseSlotName:"top_boxad",calculateFloor:()=>.19},{targeting:{geo:"us",skin:"ucp_desktop",tier:"3"},baseSlotName:"top_leaderboard",calculateFloor:()=>.2},{targeting:{geo:"us",skin:"ucp_mobile",tier:"3"},baseSlotName:"top_leaderboard",calculateFloor:()=>.14},{targeting:{geo:"us",skin:"ucp_desktop",tier:"3"},baseSlotName:"top_boxad",calculateFloor:()=>.17},{targeting:{geo:"us",skin:"ucp_desktop",tier:"3"},baseSlotName:"incontent_leaderboard",calculateFloor:()=>.17},{targeting:{geo:"us",skin:"ucp_desktop",tier:"3"},baseSlotName:"mid_boxad",calculateFloor:()=>.16},{targeting:{geo:"us",skin:"ucp_mobile",tier:"3"},baseSlotName:"lightbox_leaderboard",calculateFloor:()=>.2},{targeting:{geo:"us",skin:"ucp_desktop",tier:"3"},baseSlotName:"bottom_leaderboard",calculateFloor:()=>.14},{targeting:{geo:"au",skin:"ucp_mobile",tier:"4"},baseSlotName:"floor_adhesion",calculateFloor:()=>.25},{targeting:{geo:"us",skin:"ucp_desktop",tier:"3"},baseSlotName:"lightbox_leaderboard",calculateFloor:()=>.24},{targeting:{geo:"au",skin:"ucp_desktop",tier:"4"},baseSlotName:"incontent_boxad",calculateFloor:()=>.14},{targeting:{geo:"au",skin:"ucp_mobile",tier:"3"},baseSlotName:"floor_adhesion",calculateFloor:()=>.21},{targeting:{geo:"au",skin:"ucp_desktop",tier:"3"},baseSlotName:"incontent_boxad",calculateFloor:()=>.13},{targeting:{geo:"au",skin:"ucp_desktop",tier:"4"},baseSlotName:"top_leaderboard",calculateFloor:()=>.17},{targeting:{geo:"au",skin:"ucp_desktop",tier:"4"},baseSlotName:"mid_boxad",calculateFloor:()=>.12},{targeting:{geo:"au",skin:"ucp_mobile",tier:"4"},baseSlotName:"incontent_boxad",calculateFloor:()=>.14},{targeting:{geo:"au",skin:"ucp_desktop",tier:"4"},baseSlotName:"top_boxad",calculateFloor:()=>.12},{targeting:{geo:"au",skin:"ucp_desktop",tier:"3"},baseSlotName:"top_leaderboard",calculateFloor:()=>.16},{targeting:{geo:"au",skin:"ucp_desktop",tier:"4"},baseSlotName:"incontent_leaderboard",calculateFloor:()=>.12},{targeting:{geo:"au",skin:"ucp_mobile",tier:"3"},baseSlotName:"incontent_boxad",calculateFloor:()=>.12},{targeting:{geo:"au",skin:"ucp_mobile",tier:"4"},baseSlotName:"top_boxad",calculateFloor:()=>.18},{targeting:{geo:"au",skin:"ucp_mobile",tier:"4"},baseSlotName:"bottom_leaderboard",calculateFloor:()=>.13},{targeting:{geo:"au",skin:"ucp_desktop",tier:"3"},baseSlotName:"incontent_leaderboard",calculateFloor:()=>.1},{targeting:{geo:"au",skin:"ucp_desktop",tier:"3"},baseSlotName:"top_boxad",calculateFloor:()=>.11},{targeting:{geo:"au",skin:"ucp_desktop",tier:"3"},baseSlotName:"mid_boxad",calculateFloor:()=>.11},{targeting:{geo:"au",skin:"ucp_mobile",tier:"4"},baseSlotName:"top_leaderboard",calculateFloor:()=>.11},{targeting:{geo:"au",skin:"ucp_mobile",tier:"3"},baseSlotName:"top_boxad",calculateFloor:()=>.14},{targeting:{geo:"au",skin:"ucp_desktop",tier:"4"},baseSlotName:"bottom_leaderboard",calculateFloor:()=>.1},{targeting:{geo:"au",skin:"ucp_desktop",tier:"3"},baseSlotName:"lightbox_leaderboard",calculateFloor:()=>.17},{targeting:{geo:"au",skin:"ucp_mobile",tier:"3"},baseSlotName:"bottom_leaderboard",calculateFloor:()=>.1},{targeting:{geo:"au",skin:"ucp_mobile",tier:"3"},baseSlotName:"lightbox_leaderboard",calculateFloor:()=>.13},{targeting:{geo:"au",skin:"ucp_mobile",tier:"3"},baseSlotName:"top_leaderboard",calculateFloor:()=>.1},{targeting:{geo:"au",skin:"ucp_desktop",tier:"3"},baseSlotName:"bottom_leaderboard",calculateFloor:()=>.1},{targeting:{geo:"us",skin:"ucp_mobile",tier:"4"},baseSlotName:"incontent_leaderboard",calculateFloor:()=>.23},{targeting:{geo:"us",skin:"ucp_mobile",tier:"4"},baseSlotName:"mid_boxad",calculateFloor:()=>.2},{targeting:{geo:"us",skin:"ucp_mobile",tier:"3"},baseSlotName:"incontent_leaderboard",calculateFloor:()=>.15},{targeting:{geo:"us",skin:"ucp_desktop",tier:"4"},baseSlotName:"floor_adhesion",calculateFloor:()=>.41},{targeting:{geo:"us",skin:"ucp_mobile",tier:"3"},baseSlotName:"mid_boxad",calculateFloor:()=>.14},{targeting:{geo:"us",skin:"ucp_desktop",tier:"3"},baseSlotName:"floor_adhesion",calculateFloor:()=>.25}];class bd{constructor(i){s(this,"eligible",!1);s(this,"strategy");this.adEngine=i}checkEligibleStrategy(){if(!Ci(this.targeting,this.adEngine)){this.eligible=!1;return}const i=this.instantiateStrategies(this.adEngine);if(!this.allVariantsEligible(Object.values(i))){this.eligible=!1;return}const e=this.selectRandomVariant();this.strategy=i[e],this.eligible=!0}allVariantsEligible(i){return!!i.every(t=>t.filteredFloorConfigs.length>0)}instantiateStrategies(i){return Object.fromEntries(Object.entries(this.possibleStrategies).map(([e,t])=>[e,new t({adEngine:i,testGroupName:this.testGroupName,floorStrategyName:e})]))}}const Sd={tlf_10perc_v01:hd,tlf_5perc_v01:md,tlf_control1:D};class Ed extends ye{getFloorConfigs(){return _d}}const _d=[{targeting:{geo:"us",skin:"ucp_mobile",tier:"4"},baseSlotName:"floor_adhesion",calculateFloor:()=>.32},{targeting:{geo:"us",skin:"ucp_desktop",tier:"4"},baseSlotName:"incontent_boxad",calculateFloor:()=>.21},{targeting:{geo:"us",skin:"ucp_mobile",tier:"4"},baseSlotName:"incontent_boxad",calculateFloor:()=>.24},{targeting:{geo:"us",skin:"ucp_mobile",tier:"3"},baseSlotName:"floor_adhesion",calculateFloor:()=>.18},{targeting:{geo:"us",skin:"ucp_desktop",tier:"4"},baseSlotName:"top_leaderboard",calculateFloor:()=>.22},{targeting:{geo:"us",skin:"ucp_mobile",tier:"4"},baseSlotName:"bottom_leaderboard",calculateFloor:()=>.17},{targeting:{geo:"us",skin:"ucp_desktop",tier:"4"},baseSlotName:"mid_boxad",calculateFloor:()=>.19},{targeting:{geo:"us",skin:"ucp_mobile",tier:"4"},baseSlotName:"top_leaderboard",calculateFloor:()=>.2},{targeting:{geo:"us",skin:"ucp_desktop",tier:"3"},baseSlotName:"incontent_boxad",calculateFloor:()=>.14},{targeting:{geo:"us",skin:"ucp_desktop",tier:"4"},baseSlotName:"top_boxad",calculateFloor:()=>.19},{targeting:{geo:"us",skin:"ucp_mobile",tier:"4"},baseSlotName:"top_boxad",calculateFloor:()=>.26},{targeting:{geo:"us",skin:"ucp_mobile",tier:"3"},baseSlotName:"incontent_boxad",calculateFloor:()=>.15},{targeting:{geo:"us",skin:"ucp_desktop",tier:"4"},baseSlotName:"incontent_leaderboard",calculateFloor:()=>.2},{targeting:{geo:"us",skin:"ucp_desktop",tier:"4"},baseSlotName:"bottom_leaderboard",calculateFloor:()=>.14},{targeting:{geo:"us",skin:"ucp_mobile",tier:"3"},baseSlotName:"bottom_leaderboard",calculateFloor:()=>.11},{targeting:{geo:"us",skin:"ucp_mobile",tier:"3"},baseSlotName:"top_boxad",calculateFloor:()=>.14},{targeting:{geo:"us",skin:"ucp_desktop",tier:"3"},baseSlotName:"top_leaderboard",calculateFloor:()=>.16},{targeting:{geo:"us",skin:"ucp_mobile",tier:"3"},baseSlotName:"top_leaderboard",calculateFloor:()=>.12},{targeting:{geo:"us",skin:"ucp_desktop",tier:"3"},baseSlotName:"top_boxad",calculateFloor:()=>.15},{targeting:{geo:"us",skin:"ucp_desktop",tier:"3"},baseSlotName:"incontent_leaderboard",calculateFloor:()=>.14},{targeting:{geo:"us",skin:"ucp_desktop",tier:"3"},baseSlotName:"mid_boxad",calculateFloor:()=>.14},{targeting:{geo:"us",skin:"ucp_mobile",tier:"3"},baseSlotName:"lightbox_leaderboard",calculateFloor:()=>.16},{targeting:{geo:"us",skin:"ucp_desktop",tier:"3"},baseSlotName:"bottom_leaderboard",calculateFloor:()=>.12},{targeting:{geo:"au",skin:"ucp_mobile",tier:"4"},baseSlotName:"floor_adhesion",calculateFloor:()=>.2},{targeting:{geo:"us",skin:"ucp_desktop",tier:"3"},baseSlotName:"lightbox_leaderboard",calculateFloor:()=>.18},{targeting:{geo:"au",skin:"ucp_desktop",tier:"4"},baseSlotName:"incontent_boxad",calculateFloor:()=>.11},{targeting:{geo:"au",skin:"ucp_mobile",tier:"3"},baseSlotName:"floor_adhesion",calculateFloor:()=>.17},{targeting:{geo:"au",skin:"ucp_desktop",tier:"3"},baseSlotName:"incontent_boxad",calculateFloor:()=>.1},{targeting:{geo:"au",skin:"ucp_desktop",tier:"4"},baseSlotName:"top_leaderboard",calculateFloor:()=>.12},{targeting:{geo:"au",skin:"ucp_desktop",tier:"4"},baseSlotName:"mid_boxad",calculateFloor:()=>.1},{targeting:{geo:"au",skin:"ucp_mobile",tier:"4"},baseSlotName:"incontent_boxad",calculateFloor:()=>.11},{targeting:{geo:"au",skin:"ucp_desktop",tier:"4"},baseSlotName:"top_boxad",calculateFloor:()=>.1},{targeting:{geo:"au",skin:"ucp_desktop",tier:"3"},baseSlotName:"top_leaderboard",calculateFloor:()=>.12},{targeting:{geo:"au",skin:"ucp_desktop",tier:"4"},baseSlotName:"incontent_leaderboard",calculateFloor:()=>.1},{targeting:{geo:"au",skin:"ucp_mobile",tier:"3"},baseSlotName:"incontent_boxad",calculateFloor:()=>.1},{targeting:{geo:"au",skin:"ucp_mobile",tier:"4"},baseSlotName:"top_boxad",calculateFloor:()=>.12},{targeting:{geo:"au",skin:"ucp_mobile",tier:"4"},baseSlotName:"bottom_leaderboard",calculateFloor:()=>.1},{targeting:{geo:"au",skin:"ucp_desktop",tier:"3"},baseSlotName:"incontent_leaderboard",calculateFloor:()=>.1},{targeting:{geo:"au",skin:"ucp_desktop",tier:"3"},baseSlotName:"top_boxad",calculateFloor:()=>.1},{targeting:{geo:"au",skin:"ucp_desktop",tier:"3"},baseSlotName:"mid_boxad",calculateFloor:()=>.1},{targeting:{geo:"au",skin:"ucp_mobile",tier:"4"},baseSlotName:"top_leaderboard",calculateFloor:()=>.1},{targeting:{geo:"au",skin:"ucp_mobile",tier:"3"},baseSlotName:"top_boxad",calculateFloor:()=>.11},{targeting:{geo:"au",skin:"ucp_desktop",tier:"4"},baseSlotName:"bottom_leaderboard",calculateFloor:()=>.1},{targeting:{geo:"au",skin:"ucp_desktop",tier:"3"},baseSlotName:"lightbox_leaderboard",calculateFloor:()=>.13},{targeting:{geo:"au",skin:"ucp_mobile",tier:"3"},baseSlotName:"bottom_leaderboard",calculateFloor:()=>.1},{targeting:{geo:"au",skin:"ucp_mobile",tier:"3"},baseSlotName:"lightbox_leaderboard",calculateFloor:()=>.11},{targeting:{geo:"au",skin:"ucp_mobile",tier:"3"},baseSlotName:"top_leaderboard",calculateFloor:()=>.1},{targeting:{geo:"au",skin:"ucp_desktop",tier:"3"},baseSlotName:"bottom_leaderboard",calculateFloor:()=>.1},{targeting:{geo:"us",skin:"ucp_mobile",tier:"4"},baseSlotName:"incontent_leaderboard",calculateFloor:()=>.18},{targeting:{geo:"us",skin:"ucp_mobile",tier:"4"},baseSlotName:"mid_boxad",calculateFloor:()=>.15},{targeting:{geo:"us",skin:"ucp_mobile",tier:"3"},baseSlotName:"incontent_leaderboard",calculateFloor:()=>.12},{targeting:{geo:"us",skin:"ucp_desktop",tier:"4"},baseSlotName:"floor_adhesion",calculateFloor:()=>.28},{targeting:{geo:"us",skin:"ucp_mobile",tier:"3"},baseSlotName:"mid_boxad",calculateFloor:()=>.11},{targeting:{geo:"us",skin:"ucp_desktop",tier:"3"},baseSlotName:"floor_adhesion",calculateFloor:()=>.18}];class ut extends ye{getFloorConfigs(){return Ad}}const Ad=[{targeting:{geo:"us",skin:"ucp_mobile",tier:"4"},baseSlotName:"floor_adhesion",calculateFloor:()=>.37},{targeting:{geo:"us",skin:"ucp_desktop",tier:"4"},baseSlotName:"incontent_boxad",calculateFloor:()=>.22},{targeting:{geo:"us",skin:"ucp_mobile",tier:"4"},baseSlotName:"incontent_boxad",calculateFloor:()=>.29},{targeting:{geo:"us",skin:"ucp_mobile",tier:"3"},baseSlotName:"floor_adhesion",calculateFloor:()=>.21},{targeting:{geo:"us",skin:"ucp_desktop",tier:"4"},baseSlotName:"top_leaderboard",calculateFloor:()=>.25},{targeting:{geo:"us",skin:"ucp_mobile",tier:"4"},baseSlotName:"bottom_leaderboard",calculateFloor:()=>.19},{targeting:{geo:"us",skin:"ucp_desktop",tier:"4"},baseSlotName:"mid_boxad",calculateFloor:()=>.21},{targeting:{geo:"us",skin:"ucp_mobile",tier:"4"},baseSlotName:"top_leaderboard",calculateFloor:()=>.22},{targeting:{geo:"us",skin:"ucp_desktop",tier:"3"},baseSlotName:"incontent_boxad",calculateFloor:()=>.15},{targeting:{geo:"us",skin:"ucp_desktop",tier:"4"},baseSlotName:"top_boxad",calculateFloor:()=>.21},{targeting:{geo:"us",skin:"ucp_mobile",tier:"4"},baseSlotName:"top_boxad",calculateFloor:()=>.31},{targeting:{geo:"us",skin:"ucp_mobile",tier:"3"},baseSlotName:"incontent_boxad",calculateFloor:()=>.17},{targeting:{geo:"us",skin:"ucp_desktop",tier:"4"},baseSlotName:"incontent_leaderboard",calculateFloor:()=>.21},{targeting:{geo:"us",skin:"ucp_desktop",tier:"4"},baseSlotName:"bottom_leaderboard",calculateFloor:()=>.15},{targeting:{geo:"us",skin:"ucp_mobile",tier:"3"},baseSlotName:"bottom_leaderboard",calculateFloor:()=>.11},{targeting:{geo:"us",skin:"ucp_mobile",tier:"3"},baseSlotName:"top_boxad",calculateFloor:()=>.16},{targeting:{geo:"us",skin:"ucp_desktop",tier:"3"},baseSlotName:"top_leaderboard",calculateFloor:()=>.17},{targeting:{geo:"us",skin:"ucp_mobile",tier:"3"},baseSlotName:"top_leaderboard",calculateFloor:()=>.12},{targeting:{geo:"us",skin:"ucp_desktop",tier:"3"},baseSlotName:"top_boxad",calculateFloor:()=>.16},{targeting:{geo:"us",skin:"ucp_desktop",tier:"3"},baseSlotName:"incontent_leaderboard",calculateFloor:()=>.15},{targeting:{geo:"us",skin:"ucp_desktop",tier:"3"},baseSlotName:"mid_boxad",calculateFloor:()=>.16},{targeting:{geo:"us",skin:"ucp_mobile",tier:"3"},baseSlotName:"lightbox_leaderboard",calculateFloor:()=>.18},{targeting:{geo:"us",skin:"ucp_desktop",tier:"3"},baseSlotName:"bottom_leaderboard",calculateFloor:()=>.12},{targeting:{geo:"au",skin:"ucp_mobile",tier:"4"},baseSlotName:"floor_adhesion",calculateFloor:()=>.22},{targeting:{geo:"us",skin:"ucp_desktop",tier:"3"},baseSlotName:"lightbox_leaderboard",calculateFloor:()=>.2},{targeting:{geo:"au",skin:"ucp_desktop",tier:"4"},baseSlotName:"incontent_boxad",calculateFloor:()=>.12},{targeting:{geo:"au",skin:"ucp_mobile",tier:"3"},baseSlotName:"floor_adhesion",calculateFloor:()=>.19},{targeting:{geo:"au",skin:"ucp_desktop",tier:"3"},baseSlotName:"incontent_boxad",calculateFloor:()=>.11},{targeting:{geo:"au",skin:"ucp_desktop",tier:"4"},baseSlotName:"top_leaderboard",calculateFloor:()=>.14},{targeting:{geo:"au",skin:"ucp_desktop",tier:"4"},baseSlotName:"mid_boxad",calculateFloor:()=>.11},{targeting:{geo:"au",skin:"ucp_mobile",tier:"4"},baseSlotName:"incontent_boxad",calculateFloor:()=>.12},{targeting:{geo:"au",skin:"ucp_desktop",tier:"4"},baseSlotName:"top_boxad",calculateFloor:()=>.11},{targeting:{geo:"au",skin:"ucp_desktop",tier:"3"},baseSlotName:"top_leaderboard",calculateFloor:()=>.13},{targeting:{geo:"au",skin:"ucp_desktop",tier:"4"},baseSlotName:"incontent_leaderboard",calculateFloor:()=>.11},{targeting:{geo:"au",skin:"ucp_mobile",tier:"3"},baseSlotName:"incontent_boxad",calculateFloor:()=>.11},{targeting:{geo:"au",skin:"ucp_mobile",tier:"4"},baseSlotName:"top_boxad",calculateFloor:()=>.14},{targeting:{geo:"au",skin:"ucp_mobile",tier:"4"},baseSlotName:"bottom_leaderboard",calculateFloor:()=>.11},{targeting:{geo:"au",skin:"ucp_desktop",tier:"3"},baseSlotName:"incontent_leaderboard",calculateFloor:()=>.1},{targeting:{geo:"au",skin:"ucp_desktop",tier:"3"},baseSlotName:"top_boxad",calculateFloor:()=>.1},{targeting:{geo:"au",skin:"ucp_desktop",tier:"3"},baseSlotName:"mid_boxad",calculateFloor:()=>.1},{targeting:{geo:"au",skin:"ucp_mobile",tier:"4"},baseSlotName:"top_leaderboard",calculateFloor:()=>.1},{targeting:{geo:"au",skin:"ucp_mobile",tier:"3"},baseSlotName:"top_boxad",calculateFloor:()=>.12},{targeting:{geo:"au",skin:"ucp_desktop",tier:"4"},baseSlotName:"bottom_leaderboard",calculateFloor:()=>.1},{targeting:{geo:"au",skin:"ucp_desktop",tier:"3"},baseSlotName:"lightbox_leaderboard",calculateFloor:()=>.14},{targeting:{geo:"au",skin:"ucp_mobile",tier:"3"},baseSlotName:"bottom_leaderboard",calculateFloor:()=>.1},{targeting:{geo:"au",skin:"ucp_mobile",tier:"3"},baseSlotName:"lightbox_leaderboard",calculateFloor:()=>.12},{targeting:{geo:"au",skin:"ucp_mobile",tier:"3"},baseSlotName:"top_leaderboard",calculateFloor:()=>.1},{targeting:{geo:"au",skin:"ucp_desktop",tier:"3"},baseSlotName:"bottom_leaderboard",calculateFloor:()=>.1},{targeting:{geo:"us",skin:"ucp_mobile",tier:"4"},baseSlotName:"incontent_leaderboard",calculateFloor:()=>.2},{targeting:{geo:"us",skin:"ucp_mobile",tier:"4"},baseSlotName:"mid_boxad",calculateFloor:()=>.17},{targeting:{geo:"us",skin:"ucp_mobile",tier:"3"},baseSlotName:"incontent_leaderboard",calculateFloor:()=>.13},{targeting:{geo:"us",skin:"ucp_desktop",tier:"4"},baseSlotName:"floor_adhesion",calculateFloor:()=>.33},{targeting:{geo:"us",skin:"ucp_mobile",tier:"3"},baseSlotName:"mid_boxad",calculateFloor:()=>.12},{targeting:{geo:"us",skin:"ucp_desktop",tier:"3"},baseSlotName:"floor_adhesion",calculateFloor:()=>.21}],Td={tlf_2perc_v01:Ed,tlf_3perc_v01:ut,tlf_control1:D,tlf_control2:D,tlf_nobucket:D};class yd extends ut{constructor(){super(...arguments);s(this,"setAyFloorHigherTempVar",!1)}}const Ri={tlf_3perc_v02:ut,tlf_control1:D,tlf_control2:D,tlf_3perc_v02_noAdX:yd,tlf_nobucket:D},Id=[{floorStrategy:"tlf_control1",buckets:["47","51","66"]},{floorStrategy:"tlf_control2",buckets:["49","53","68"]},{floorStrategy:"tlf_3perc_v02_noAdX",buckets:["48","52","67"]},{floorStrategy:"tlf_3perc_v02",buckets:["50","54","69"]}];class vd extends bd{constructor(){super(...arguments);s(this,"testGroupName","test4_5");s(this,"targeting",{geo:["us","au"]});s(this,"possibleStrategies",Ri)}selectRandomVariant(){const e=jt();if(e==="")return"tlf_nobucket";for(const t of Id)if(t.buckets.includes(e))return t.floorStrategy;return"tlf_nobucket"}}const Nd={...Sd,...Td,...Ri,fndm_0:D};function kd(n){const i=De("dyn_flr_src");if(!i)return!1;const e=Nd[i];return e?new e({floorStrategyName:i,testGroupName:"query_override",adEngine:n}):!1}const Cd=[vd];function Rd(n,i){try{const e=kd(n);if(e)return e;const r=Cd.map(a=>{const d=new a(n);return d.checkEligibleStrategy(),d}).filter(a=>i[a.testGroupName]===!0&&a.eligible);r.length>1&&g({message:"More than one possible test identified for this page",priority:c.P3,code:In});const o=r[0];return o&&o.strategy?o.strategy:new D({adEngine:n,testGroupName:"none",floorStrategyName:"fndm_0"})}catch(e){return g({message:"Failed to select page strategy; falling back to control",priority:c.P3,code:vn,error:e}),new D({adEngine:n,testGroupName:"none",floorStrategyName:"fndm_0"})}}class Pd extends h{constructor(e,t){super(e);s(this,"name","DynamicPriceFloorPlugin");s(this,"floorStrategy");s(this,"testGroup");s(this,"initialized",!1);s(this,"adEngine");s(this,"pageStrategy");s(this,"floorValues");s(this,"cohortHashResult");s(this,"icDynamicFloorStrategies");s(this,"tlbBidPrice");s(this,"targetingDebugStates",[]);s(this,"hooks",{onAdEngineInit:e=>{this.adEngine=e,this.pageStrategy=Rd(this.adEngine,this.icDynamicFloorStrategies),this.testGroup=this.pageStrategy.testGroupName,this.floorStrategy=this.pageStrategy.floorStrategyName,this.trackBidsReceived(),this.initialized=!0,this.setCohortHash(),this.calculateFloors(),this.setPrebidFloorConfig(),this.scheduleBeatPrebidTargeting(),e.gptWrapper.setTargeting({dyn_floor_src:this.floorStrategy,dyn_ads_test:this.testGroup}),this.setDynAdsRand()},onAdNodeCreated:e=>{this.updateVideoBidFloor(e)},onConsentUpdated:()=>{this.adEngine&&(this.setCohortHash(),this.calculateFloors(),this.setPrebidFloorConfig())},onBeforeAdsRequest:e=>{e.forEach(t=>{this.targetingDebugStates.push({slotName:t.getSlotName(),hb_pb:t.getTargeting("hb_pb")[0],ay_floor:t.getTargeting("ay_floor")[0],ay_floor_g:t.getTargeting("ay_floor_g")[0],f_hb_floor:t.getTargeting(we)[0]})})},onCreateBidderAdUnit:(e,t,r)=>{if(et("prebid",e,r))for(const o of r)this.resetFloorKeyValues(o);et("a9",e,r)&&this.setA9FloorOnAuction(r)}});this.icDynamicFloorStrategies={beatPrebid:!0,tlf:!1,...t.icDynamicFloorStrategies}}static isEnabled(e,t){return!!(t!=null&&t.icDynamicFloorEnabled)&&super.isEnabled(e,t)}getDebugState(){return{icDynamicFloorStrategies:{...this.icDynamicFloorStrategies},testGroup:this.testGroup,floorStrategy:this.floorStrategy,tlbBidPrice:this.tlbBidPrice,floorValues:{...this.floorValues},cohortHashResult:{...this.cohortHashResult},targetingDebugStates:this.targetingDebugStates,pageStrategy:this.pageStrategy}}calculateFloors(){var r;const e=((r=this.pageStrategy)==null?void 0:r.filteredFloorConfigs)??[],t=this.adEngine.adNodeManager.getAdNodes();this.floorValues=nd(e,t,this.tlbBidPrice)}setPrebidFloorConfig(){if(!this.floorValues){g({code:Be,message:"Expected floorValues to already be calculated",priority:c.P3});return}const e=this.usePlugin(I);e==null||e.addPrebidReadyCallback(t=>{t.setConfig({floors:{data:{...Te.data,schema:{fields:["adUnitCode"]},values:this.floorValues}}})})}setA9FloorOnAuction(e){if(!this.floorValues){g({code:Be,message:"Expected floorValues to already be calculated",priority:c.P3});return}e.slots.forEach(t=>{var o,a;let r=((o=this.floorValues)==null?void 0:o[t.slotID])??((a=this.floorValues)==null?void 0:a["*"])??void 0;r?r=Math.round(r*100):r=di,t.floor={currency:"USD",value:r}})}async updateVideoBidFloor(e){if(e.getSlotType()!=="video")return;const t=e.getElement();if(!t)return;const r=await t.getFeaturedMinimumBidFloor();if(r===null)return;const o=ct(r);e.setTargeting(U,o),e.setTargeting($,"getFloors")}trackBidsReceived(){var e;(e=this.usePlugin(I))==null||e.addPrebidReadyCallback(t=>{t.onEvent("auctionEnd",r=>{this.tlbBidPrice===void 0&&(r.bidsReceived.forEach(o=>{o.adUnitCode==="top_leaderboard"&&(this.tlbBidPrice=Math.max(this.tlbBidPrice??0,o.cpm))}),this.tlbBidPrice!==void 0&&(this.calculateFloors(),this.setPrebidFloorConfig()))})})}scheduleBeatPrebidTargeting(){var e;["ctrl"].includes(this.floorStrategy)||(e=this.usePlugin(I))==null||e.addPrebidReadyCallback(t=>{t.onEvent("setTargeting",r=>{Object.keys(r).forEach(o=>{const a=this.adEngine.adNodeManager.getAdNodeByName(o);a&&ad(a)})})})}resetFloorKeyValues(e){const t=this.adEngine.adNodeManager.getAdNodeByName(e.code);if(t&&t.getSlotType()!=="video"){if(!this.floorValues){g({code:Be,message:"Expected floorValues to already be calculated",priority:c.P3});return}t.clearTargeting(U),t.clearTargeting($),t.clearTargeting(we),dd(t,this.floorValues,this.pageStrategy.setAyFloorHigherTempVar)}}setCohortHash(){if(!this.adEngine){g({code:$i,priority:c.P3,message:"dyn_ads_cohort attempted to be set without this.adEngine"});return}this.cohortHashResult=cd(this.adEngine.gptWrapper.getAllTargeting({raw:!0})),this.adEngine.gptWrapper.setTargeting({dyn_ads_cohort:this.cohortHashResult.hash})}setDynAdsRand(){const e=Math.floor(Math.random()*100).toString().padStart(2,"0");this.adEngine.gptWrapper.setTargeting({dyn_ads_rand:e})}}const wd="f_hb_pb_avg",Fd="hb_pb";class Ld extends h{constructor(e){super(e);s(this,"name","AverageHbPricePlugin");s(this,"slotPrices",new Map);s(this,"firstCallAverage","0.00");s(this,"hasCalculated",!1);s(this,"slots");s(this,"hooks",{onAdEngineInit:e=>{const t=this.usePlugin(I);if(!t){b({code:$n,message:"AverageHbPricePlugin: PrebidPlugin not found, cannot calculate average hb_pb",priority:c.P3});return}t.addPrebidReadyCallback(r=>{r.onEvent("setTargeting",o=>{this.hasCalculated||Object.keys(o).forEach(a=>{var u;const d=a;if(!this.slots.has(d))return;const l=e.adNodeManager.getAdNodeByName(d);if(l){const f=(u=l.getTargeting(Fd))==null?void 0:u[0],A=parseFloat(f||"0"),k=Number.isNaN(A)?0:A;this.slotPrices.set(d,k)}})})})},onAdEngineReset:()=>{this.slotPrices.clear(),this.firstCallAverage="0.00",this.hasCalculated=!1},onBeforeFirstCallAdsRequest:e=>{const t=this.calculateAverage();this.firstCallAverage=t,this.hasCalculated=!0,e.setTargeting({[wd]:t})}});this.slots=new Set(e.slots??[])}static isEnabled(e,t){const r=e.slots&&Array.isArray(e.slots)&&e.slots.length>0;return!!(t!=null&&t.icAverageHbPriceEnabled)&&!!r&&super.isEnabled(e,t)}getDebugState(){return{slotPrices:Object.fromEntries(this.slotPrices),firstCallAverage:this.firstCallAverage}}calculateAverage(){return this.slots.size===0?"0.00":(Array.from(this.slotPrices.values()).reduce((r,o)=>r+o,0)/this.slots.size).toFixed(2)}}function Dd(n){return Se({A9Plugin:Ts,AudigentPlugin:Ba,BlockthroughReadershipLinkPlugin:tt,BrandMetricsPlugin:Pa,CaptifyPlugin:Ca,ConfiantPlugin:pa,DoubleVerifyPlugin:Ua,IasPublisherOptimizationPlugin:qa,IntentIqPlugin:Na,LiveConnectPlugin:Y,LiveRampATSPlugin:Ja,LotamePlugin:ha,NielsenPlugin:ja},n)}function Od(n){return Se({ConsentManagementPrebidPlugin:ys,PrebidPlugin:I,ServerToServerPlugin:Ks,PrebidIdSyncingPlugin:Ya,JWPlayerRTDPrebidPlugin:za},n)}function Bd(n){return Se({DynamicPriceFloorPlugin:Pd,AverageHbPricePlugin:Ld},n)}async function xd(){const{config:n,activeLabradorKeyValues:i}=await $e(),e=await to(n,i,pe()),t=Object.fromEntries(Se({InterstitialPlugin:Wa,FloorAdhesionPlugin:Ei,TopStrategyTunerPlugin:ua,SlotRefresherPlugin:be,VastUrlPlugin:Ze,LightboxLeaderboardPlugin:ga,InContentPlayerPlugin:Ti,InContentLeaderboardPlugin:Pe,PageLevelTargetingPlugin:Vs},e).map(u=>[u.name,u])),r=new Qa({},e),o=[...Object.values(t),...Se({TrackingPlugin:bi,AuctionCmpTrackingPlugin:it,HeavyAdsDetectionPlugin:mi,DynamicSlotPlugin:Rs,FandomTaxonomyPlugin:ui,PerformanceTestPlugin:Ws,AdLabelPlugin:Ka,RepeatableSlotsPlugin:Gs,DigitalServicesActPlugin:vs,OpenRtbPlugin:at,RegisteredUserPlugin:id},e),...Bd(e),...Od(e),...Dd(e),...r.getExperimentPlugins(),...await fr()],a=new Map(o.map(u=>[u.constructor,u]));o.forEach(u=>{u.setPlugins(a)}),performance.mark(N.AE_AFTER_INIT_PLUGINS);const d={flags:i};p(Yt.LABRADOR_KEYVALUES,d);const l=await Xr(e,o);return l.start(),{exposedPlugins:t,adEngine:l}}function Md(n,i,...e){const t=document.createElement(n);return i&&Object.keys(i).forEach(r=>{r.startsWith("on")?t.addEventListener(r.slice(2).toLowerCase(),i[r]):r==="ref"?i[r].current=t:t[r]=i[r]}),t.append(...e.filter(r=>!!r)),t}window.jsxRenderer=Md;ar();performance.mark(N.AE_FIRST_LINE_EXEC);xd().then(({exposedPlugins:n,adEngine:i})=>{var e;window.fandomAds=new gr(n,i,(e=window.fandomAds)==null?void 0:e.cmd)}).catch(n=>{g({code:mn,message:"Failed to load ad engine",priority:c.P1,error:n})});export{h as A,c as I,T as M,I as P,ei as U,Vd as V,P as _,j as a,$t as b,q as c,fe as d,Ns as e,Xs as f,De as g,Ge as h,E as i,Er as j,Gt as k,rt as m,g as r};
//# sourceMappingURL=main.js.map
