---
title: |
     The role of prey behaviour in predator expertise acquisition: insights from a virtual ecosystem \
     Appendix
    
output: 
  word_document:
    reference_docx: appendix-styles.docx
    fig_caption: yes
csl: chicago-author-date.csl
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

library(data.table)
library(brms)
library(flextable)
library(officer)
library(dplyr)
```

\newpage

```{r tableprep, include = FALSE}
# ===========================================================================
# 1. Extract the fixed effects from the MV model
# ===========================================================================

# Prepare the table ---------------------------------------------------------

# Model fit
fit <- readRDS(
  here::here("outputs", "outputs_models", "GLM-RandomSample.rds")
)

# Fixed effects table
results <- data.table(
  round(summary(fit, robust = TRUE, prob = 0.89)$fixed, digits = 2)[, 1:4],
  keep.rownames = TRUE
)
setnames(results, "rn", "parameter")



# Rename parameter values ---------------------------------------------------

# Rename
results[,
  parameter := 
      c("game duration",
        "cumulative experience",
        "prey rank",
        "group 1",
        "group 4",
        "group 2",
        "group 3")
]

# Reorder rows
results <- results[
  c(1,2,3,4,6,7,5)
]

# ===========================================================================
# ===========================================================================





# ===========================================================================
# 2. Compute the table using flextable
# ===========================================================================

# Prepare the table parameters ----------------------------------------------

# Custom header
my_header <- data.frame(
   col_keys = c("parameter",
                "Estimate",
                "l-89% CI",
                "u-89% CI"),
   line1 = c("Parameter",
             "Estimate",
             "lower 89% CI",
             "upper 89% CI"),
   stringsAsFactors = FALSE
)

# Custom theme
my_theme <- function(x, ...) {
   x <- colformat_double(x, big.mark = " ",
                         decimal.mark = ".",
                         digits = 2)
   x <- set_table_properties(x, layout = "autofit")
   x <- border_remove(x)
   std_border <- fp_border(width = 1, color = "black")
   x <- hline_top(x, part = "all", border = std_border)
   x <- hline_bottom(x, part = "all", border = std_border)
   x <- width(x, j = 1, width = 3.78, unit = "cm")
   x <- width(x, j = c(3:4), width = 3.3, unit = "cm")
}
```

```{r tableS1, ft.align = "left"}
# Create the table ----------------------------------------------------------

tabf <- results %>%
  flextable(col_keys = my_header$col_keys) %>%
  set_header_df(mapping = my_header, key = "col_keys") %>%
  my_theme() %>%
  merge_v(j = 1) %>%
  valign(j = 1, valign = "top", part = "body") %>%
  align(align = "left", part = "all", j = 1) %>%
  align(align = "center", part = "all", j = c(2:4)) %>%
  footnote(
    i = 1, j = 1,
    part = "header",
    value = as_paragraph(
      as_sup("a "),
      "Group 1: <50 matches, Group 2: between 50 and 99 matches, Group 3: between 100 and 299 matches, Group 4: > 299 (i.e. group in the main text)"
    ),
    ref_symbols = " "
  ) %>%
  set_caption(
    results,
    caption = "Table S1. Fixed effects table comparing the success of random groups of players with different amounts of matches played to the group presented in the main text.",
    style = "Table Caption"
  ) %>%
  fontsize(size = 10, part = "all") %>%
  fontsize(size = 12, part = "footer") %>%
  font(fontname = "Times New Roman", part = "all")

tabf

# ===========================================================================
# ===========================================================================
```

\newpage

```{r figS1, out.width = "100%", fig.cap = "**Figure S1**. Posterior distributions of the median hunting success per group of players. The values were back transformed to probability scale and can be interpreted as the probability of capturing the four prey. Group 1: <50 matches, Group 2: between 50 and 99 matches, Group 3: between 100 and 299 matches, Group 4: > 299 (i.e. group in the main text)."}

knitr::include_graphics(
  here::here(
    "outputs", "outputs_figures",
    "figureS1.png"
  )
)
```


\newpage

```{r figS2, out.width = "100%", fig.cap = "**Figure S2**. Median posterior predictions of the effects of prey features on the predator's hunting success. The predators' hunting success (i.e., the probability of consuming the four prey) is on the y-axis, and the prey's features are on the x-axis. Panel A shows the effect of prey speed on the predator's hunting success. Panel B shows the effect of the prey's space coverage on hunting success. Panel C shows the effect of the prey's rank. The predictions are from Model III."}

knitr::include_graphics(
  here::here(
    "outputs", "outputs_figures",
    "figureS2.png"
  )
)
```


\newpage

```{r figS3, out.width = "100%", fig.cap = "**Figure S3**. Median posterior predictions of the development of predator expertise, holding the mean rank of the prey group at different fixed values (mean Â± 2 SD). The predators' hunting success (i.e., the probability of consuming the four prey) is on the y-axis, and the cumulated experience is on the x-axis. Lower rank values indicate higher skill (rank 1 being the best rank). The predictions are from Model III."}

knitr::include_graphics(
  here::here(
    "outputs", "outputs_figures",
    "figureS3.png"
  )
)
```