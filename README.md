![](https://img.shields.io/badge/license-CC%20BY--NC%204.0-green?style=for-the-badge)

# Online repository

### Description

Online repository to reproduce the results presented in :

Prey movement shapes the acquisition of predator expertise in a virtual bi-trophic system. (2024). *BioRxiv*. https://doi.org/10.1101/2024.11.15.621573

---
### Reproducibility

#### 1. Preparing the project

- Open a terminal and clone the repository

```
git clone https://github.com/quantitative-ecologist/predator-expertise.git
```

- Install [`renv`](https://rstudio.github.io/renv/) globally

```
install.packages("renv")
```

- In the root folder of the `predator-expertise` project, open `R` and install the project libraries
from the `renv.lock` file to reproduce the environment. This will install the libraries inside the project.

```
renv::restore()
```

** **Note for Windows users:** refrain from putting the project inside OneDrive as it struggles with renv. Just put the project in a place that is not tracked by OneDrive.

#### 2. Download the model outputs

The model fitting cannot be reproduced on your personal computer as it requires important computing resources. The model output files (`.rds`) are hosted on this [OSF repository](https://osf.io/hdv38/).

To download the files locally: 
- Open a terminal
- Go to the root folder of the `predator-expertise` project
- Type the following command:

```
make download-models
```

If you don't have the make command in your computer, you can also simply run the script from your terminal:

```
Rscript download_models.R
```

This will create a subfolder called `outputs_models` within [outputs](./outputs) and download all the model output files (`.rds`) in it.

---
### General coding workflow

The subfolders in the [code folder](./code) are ordered to reflect the worflow. 

Here are the steps highlighting the process with a link to the code subfolders :

1. [Run models](./code/code_models) --> **Not needed, see 'Reproducibility' section above**
2. [Model validation](./code/code_model-validation)
3. [Model processing](./code/code_model-processing)
4. [Produce figures](./code/code_figures)

You will find the specific outputs generated by the R scripts in the [outputs](./outputs) folder.

---

### Workflow to run the models

This workflow is exclusively for `.R` files used to compute the Bayesian `GAMM`s with the `brms` package (see the [code_models](./code/code_models) folder). 

The `fit_LM-PreySpeed.R` and `fit_GLM-RandomSample` models do not require important resources and can be run locally.

| Generator              | Operating system | Programming language | Code               | Results                  |
| ---------------------- | ---------------- | -------------------- | ------------------ | ------------------------ |
| Digital Research Alliance of Canada / Cedar | CentOS Linux 7   | R                    | [code_models](./code/code_models/) folder | [outputs_models](./outputs) folder** |
---

- I ran all the `GAMM` models on [Cedar](https://docs.alliancecan.ca/wiki/Cedar), a computer cluster managed by the [Digital Research Alliance of Canada](https://www.alliancecan.ca/en). 

- To run the models on a cluster other than Cedar, simply use the job (`.sh`) files and adapt them to your needs. They are in the [code_models](./code/code_models) folders and have the same name as the `.R` model files.

** **Note:** the `outputs_models` folder has to be created manually if you want to compute the models yourself and transfer the files there, otherwise, you won't be able to continue working with the project (i.e., produce figures, tables, etc.).
